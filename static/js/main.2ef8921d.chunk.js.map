{"version":3,"sources":["data-api/Kmb.js","data-api/Nwfb.js","data-api/Ctb.js","data-api/index.js","AppContext.js","Header.js","components/RouteInputPad.js","components/RouteBoard.js","components/RouteEta.js","components/Settings.js","Footer.js","App.js","reportWebVitals.js","i18n.js","index.js"],"names":["KmbApi","co","fetchRouteList","fetch","then","response","json","data","reduce","routeList","element","route","service_type","bound","join","orig","en","orig_en","zh","orig_tc","dest","dest_en","dest_tc","stops","serviceType","generated_timestamp","forEach","push","stop","Object","entries","map","fetchStopList","stopList","name","name_en","nameEncodingHandling","name_tc","location","lat","long","fetchEtas","stopId","seq","cache","filter","e","dir","eta","Math","round","moment","diff","remark","rmk_tc","rmk_en","NwfbApi","acc","concat","fetchRouteStops","routeStops","Promise","all","console","log","rmk","CtbApi","a","routeSize","_etas","company_id","kmb","ctb","nwfb","sort","b","Number","isInteger","api","error","checkSameRoute","route1","route2","end","name_a","toUpperCase","name_b","includes","convertRouteObj","routeObj","ret","AppContext","React","createContext","AppContextProvider","props","useState","localStorage","getItem","schemaVersion","setSchemaVersion","JSON","parse","setRouteList","setStopList","parseInt","updateTime","setUpdateTime","searchRoute","setSearchRoute","selectedRoute","setSelectedRoute","geoPermission","setGeoPermission","possibleChar","setPossibleChar","renewDb","companyRoutes","i","j","routes","list","length","imported","_routeList","routeNo","updateRouteList","_stopList","updateStopList","_updateTime","Date","now","setItem","useEffect","process","text","_schemaVersion","needRenew","getPossibleChar","stringify","Provider","value","updateSearchRouteByButton","buttonValue","slice","updateGeoPermission","state","children","startsWith","c","isNaN","k","useStyles","makeStyles","theme","toolbar","color","textDecoration","display","justifyContent","zIndex","drawer","searchRouteInput","maxWidth","textAlign","LanguageTabs","withStyles","root","borderBottom","minHeight","indicator","backgroundColor","Tabs","LanguageTab","textTransform","minWidth","fontWeight","marginRight","spacing","fontSize","opacity","padding","selected","wrapper","borderRadius","Tab","disableRipple","Header","useContext","path","useRouteMatch","useTranslation","t","i18n","classes","useLocation","history","useHistory","Toolbar","className","to","pathname","language","Typography","variant","Input","type","placeholder","onChange","target","disabled","v","lang","replace","changeLanguage","label","KeyButton","handleClick","Button","size","button","onClick","RouteNumPad","Grid","container","split","item","xs","style","RouteAlphabetPad","RouteInputPad","Box","boxContainer","numPadContainer","alphabetPadContainer","flexDirection","height","width","overflowX","overflowY","RouteRow","memo","index","Card","square","CardActionArea","CardContent","cardContent","areEqual","createItemData","memorize","RouteList","targetRouteList","itemData","itemCount","itemSize","RouteBoard","RouteEta","useParams","id","panel","expanded","setExpanded","accordionRef","useRef","handleChange","event","newExpanded","company","fetchRouteStopsViaApi","objs","obj","prevRouteList","current","scrollIntoView","behavior","block","loadingContainer","CircularProgress","idx","TransitionProps","unmountOnExit","ref","el","TimeReport","etas","setEtas","fetchEtasViaApi","fetchData","fetchEtaInterval","setInterval","clearInterval","displayMsg","Accordion","border","boxShadow","margin","MuiAccordion","AccordionSummary","marginBottom","content","MuiAccordionSummary","AccordionDetails","MuiAccordionDetails","Settings","updating","setUpdating","Paper","List","ListItem","ListItemAvatar","Avatar","ListItemText","primary","secondary","format","navigator","geolocation","getCurrentPosition","position","Divider","component","href","Snackbar","anchorOrigin","vertical","horizontal","open","message","background","Footer","BottomNavigation","showLabels","BottomNavigationAction","Link","icon","PageSwitch","App","Container","disableGutters","loadingTextContainer","elevation","date","renderer","seconds","completed","align","Theme","exact","CssBaseline","createMuiTheme","typography","fontFamily","palette","default","alignItems","loadingText","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","DEFAULT_LANG","window","substr","use","initReactI18next","init","resources","whitelist","lowerCaseLng","lng","nsSeparator","keySeparator","debug","interpolation","escapeValue","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.2ef8921d.chunk.js","sourcesContent":["import moment from 'moment'\n\nconst KmbApi = {\n  co: 'kmb',\n  fetchRouteList: () => (\n    // fetch route data\n    fetch(\n      \"https://data.etabus.gov.hk/v1/transport/kmb/route/\"\n    ).then(\n      response => response.json()\n    ).then( ({data}) => \n      data.reduce( (routeList, element) => {\n        routeList[[element.route, element.service_type, element.bound].join('+')] = {\n          route: element.route,\n          co: 'kmb',\n          bound: element.bound,\n          orig: {\n            en: element.orig_en,\n            zh: element.orig_tc\n          },\n          dest: {\n            en: element.dest_en,\n            zh: element.dest_tc\n          },\n          stops: [],\n          serviceType: element.service_type\n        }\n        return routeList\n      }, {})\n    ).then( routeList => (\n      // fetch route stop data\n      fetch(\"https://data.etabus.gov.hk/v1/transport/kmb/route-stop/\").then(response => response.json())\n      .then(({data, generated_timestamp}) => {\n        data.forEach(element => {\n          routeList[[element.route, element.service_type, element.bound].join('+')].stops.push(\n            element.stop\n          )\n        })\n        return Object.entries(routeList).map(([id, obj]) => obj)\n      })\n    ))\n  ),\n  fetchStopList: () => {\n    return fetch(\"https://data.etabus.gov.hk/v1/transport/kmb/stop\").then(\n      response => response.json()\n    ).then(({data, generated_timestamp}) => {\n      let stopList = {}\n      data.forEach(element => {\n        stopList[element.stop] = {\n          name: {\n            en: element.name_en,\n            zh: nameEncodingHandling( element.name_tc )\n          },\n          location: {\n            lat: element.lat,\n            long: element.long\n          }\n        }\n      })\n      \n      return stopList\n    })\n  },\n  /*\n    @fetchEtas\n    return array of Object with props {\n      eta: (int) minute or null,\n      remark: {\n        zh: string\n        en: string\n      }\n    }\n  */\n  fetchEtas: ({stopId, route, seq, serviceType, bound}) => {\n    return fetch(\n      `https://data.etabus.gov.hk/v1/transport/kmb/eta/${stopId}/${route}/${serviceType}`,\n      { cache: \"no-store\" }\n    ).then( response => response.json() )\n    .then(({data}) => data.filter(e => e.dir === bound && e.seq === seq).map(e => ({\n        eta: e.eta ? Math.round(moment(e.eta).diff(moment()) / 60 / 1000) : e.eta,\n        remark: {\n          zh: e.rmk_tc,\n          en: e.rmk_en\n        },\n        co: 'kmb'\n      }))\n    )\n  }\n}\n\nexport default KmbApi\n\nconst nameEncodingHandling = (name) => {\n  if ( name === '瘝嗵眎�𧨾���' ) return '沙田坳道'\n  else if ( name === '暺�憭找�嗵��' ) return '黃大仙站'\n  else return name\n}","import moment from 'moment'\n\nconst NwfbApi = {\n  co: 'nwfb',\n  fetchRouteList: () => (\n    fetch(\"https://rt.data.gov.hk/v1/transport/citybus-nwfb/route/nwfb\")\n      .then(response => response.json())\n      .then(({data}) => (\n        data.reduce((acc, element) => (\n          acc.concat([ {\n            route: element.route,\n            bound: 'O',\n            orig: {\n              en: element.orig_en,\n              zh: element.orig_tc\n            },\n            dest: {\n              en: element.dest_en,\n              zh: element.dest_tc\n            },\n            co: 'nwfb',\n            stops: null,\n            serviceType: 1\n          },{\n            route: element.route,\n            bound: 'I',\n            orig: {\n              en: element.dest_en,\n              zh: element.dest_tc\n            },\n            dest: {\n              en: element.orig_en,\n              zh: element.orig_tc\n            },\n            co: 'nwfb',\n            stops: null,\n            serviceType: 1\n          }])\n        ), [])\n      ))\n  ),\n  fetchRouteStops: ({route, bound, routeList}) => {\n    const dir = bound === 'I' ? 'inbound' : 'outbound'\n    return fetch(\n      `https://rt.data.gov.hk/v1/transport/citybus-nwfb/route-stop/NWFB/${route}/${dir}`\n    ).then( response => \n      response.json()\n    ).then( ({data}) => \n      data.map(e => e.stop) \n    ).then( routeStops => {\n      // fetch each stop in parallel\n      return Promise.all(routeStops.map(stopId => \n          fetch(`https://rt.data.gov.hk/v1/transport/citybus-nwfb/stop/${stopId}`).then(\n            response => response.json()\n          ).then ( ({data}) => ({\n            stopId: stopId,\n            name: {\n              zh: data.name_tc,\n              en: data.name_en\n            },\n            location: {\n              lat: data.lat,\n              long: data.long\n            }\n          }))\n        )).then( stops => {\n          let stopList = {};\n          stops.forEach(stop => stopList[stop.stopId] = stop)\n          return {routeStops, stopList, co: 'nwfb'}\n        })\n    })\n  },\n  fetchEtas: ({stopId, route, bound }) => {\n    console.log(stopId, route, bound)\n    return fetch(`https://rt.data.gov.hk/v1/transport/batch/stop-eta/NWFB/${stopId}?lang=zh-hant`, { cache: \"no-store\" }).then(\n      response => response.json()\n    ).then(({data}) => data.filter(eta => eta.route === route && eta.dir === bound && eta.eta).map(e => ({\n        eta: e.eta ? Math.round(moment(e.eta).diff(moment()) / 60 / 1000) : e.eta,\n        remark: {\n          zh: e.rmk,\n          en: e.rmk\n        },\n        co: 'nwfb'\n      }))\n    )\n  }\n}\n\nexport default NwfbApi","import moment from 'moment'\n\nconst CtbApi = {\n  co: 'ctb',\n  fetchRouteList: () => (\n    fetch(\"https://rt.data.gov.hk/v1/transport/citybus-nwfb/route/ctb\")\n      .then(response => response.json())\n      .then(({data}) => (\n        data.reduce((acc, element) => (\n          acc.concat([ {\n            route: element.route,\n            bound: 'O',\n            orig: {\n              en: element.orig_en,\n              zh: element.orig_tc\n            },\n            dest: {\n              en: element.dest_en,\n              zh: element.dest_tc\n            },\n            co: 'ctb',\n            stops: null,\n            serviceType: 1\n          },{\n            route: element.route,\n            bound: 'I',\n            orig: {\n              en: element.dest_en,\n              zh: element.dest_tc\n            },\n            dest: {\n              en: element.orig_en,\n              zh: element.orig_tc\n            },\n            co: 'ctb',\n            stops: null,\n            serviceType: 1\n          }])\n        ), [])\n      ))\n  ),\n  fetchRouteStops: ({route, bound, routeList}) => {\n    const dir = bound === 'I' ? 'inbound' : 'outbound'\n    return fetch(\n      `https://rt.data.gov.hk/v1/transport/citybus-nwfb/route-stop/CTB/${route}/${dir}`\n    ).then( response => \n      response.json()\n    ).then( ({data}) => \n      data.map(e => e.stop) \n    ).then( routeStops => {\n      // fetch each stop in parallel\n      return Promise.all(routeStops.map(stopId => \n          fetch(`https://rt.data.gov.hk/v1/transport/citybus-nwfb/stop/${stopId}`).then(\n            response => response.json()\n          ).then ( ({data}) => ({\n            stopId: stopId,\n            name: {\n              zh: data.name_tc,\n              en: data.name_en\n            },\n            location: {\n              lat: data.lat,\n              long: data.long\n            }\n          }))\n        )).then( stops => {\n          let stopList = {};\n          stops.forEach(stop => stopList[stop.stopId] = stop)\n          console.log(stopList)\n          return {routeStops, stopList, co: 'ctb'}\n        })\n    })\n  },\n  fetchEtas: ({stopId, route, bound }) => {\n    return fetch(`https://rt.data.gov.hk/v1/transport/batch/stop-eta/CTB/${stopId}?lang=zh-hant`, { cache: \"no-store\" }).then(\n      response => response.json()\n    ).then(({data}) => data.filter(eta => eta.route === route && eta.dir === bound).map(e => ({\n        eta: e.eta ? Math.round(moment(e.eta).diff(moment()) / 60 / 1000) : e.eta,\n        remark: {\n          zh: e.rmk,\n          en: e.rmk\n        },\n        co: 'ctb'\n      }))\n    )\n  }\n}\n\nexport default CtbApi","import KmbApi from './Kmb'\nimport NwfbApi from './Nwfb'\nimport CtbApi from './Ctb'\n\nconst fetchEtas = async ( {route, routeStops, bound, seq, serviceType, co, routeSize}) => {\n  let _etas = []\n  for ( const company_id of co ) {\n    if (company_id === 'kmb' && routeStops.kmb ){\n      _etas = _etas.concat( await KmbApi.fetchEtas({\n        route,\n        stopId: routeStops.kmb[seq-1], \n        seq: (seq === routeSize ? 1000 : seq), \n        serviceType, bound: bound[company_id]}) \n      )\n    }\n    else if ( company_id === 'ctb' && routeStops.ctb ) {\n      _etas = _etas.concat( await CtbApi.fetchEtas({stopId: routeStops.ctb[seq-1], route, bound: bound[company_id] }))\n    }\n    else if ( company_id === 'nwfb' && routeStops.nwfb ) {\n      _etas = _etas.concat( await NwfbApi.fetchEtas({stopId: routeStops.nwfb[seq-1], route, bound: bound[company_id] }))\n    }\n  }\n  return _etas.sort((a,b) => a.eta < b.eta ? -1 : 1).filter(e => !Number.isInteger(e.eta) || e.eta > 1 )\n}\n\nconst fetchRouteStops = async ( {route, serviceType, bound, co} ) => {\n  let api\n  if (co === 'kmb') api = KmbApi\n  else if (co === 'nwfb') api = NwfbApi\n  else if (co === 'ctb') api = CtbApi\n  else {\n    console.error(co+' is not a valid company id')\n    return null\n  }\n  return await api.fetchRouteStops({route, serviceType, bound})\n}\n\nconst checkSameRoute = (route1, route2) => (\n  route1.route === route2.route && route1.co !== route2.co && ['orig', 'dest'].map ( end => {\n    // check if either orig or dest name is the same\n    const name_a = route1[end].en.toUpperCase()\n    const name_b = route2[end].en.toUpperCase()\n    return name_a.includes(name_b) || name_b.includes(name_a)\n  }).includes(true)\n)\n\nconst convertRouteObj = (routeObj) => {\n  let ret = {\n    route: routeObj.route,\n    co: [routeObj.co],\n    bound: {},\n    orig: {\n      en: routeObj.orig.en,\n      zh: routeObj.orig.zh\n    },\n    dest: {\n      en: routeObj.dest.en,\n      zh: routeObj.dest.zh\n    },\n    stops: {},\n    serviceType: routeObj.serviceType\n  }\n  ret.stops[routeObj.co] = routeObj.stops\n  ret.bound[routeObj.co] = routeObj.bound\n  return ret\n}\n\nconst fetchRouteList = () => (\n  Promise.all([KmbApi, NwfbApi, CtbApi].map(api => api.fetchRouteList()))\n  .then( companyRoutes => {\n    let routeList = {}\n    const routes = companyRoutes.reduce((acc, list) => acc.concat(list)).sort((a, b) => {\n      return a.route < b.route ? -1 : 0\n    })\n    let i, j\n    for ( i = 0; i < routes.length; ++i ){\n      // ignore imported routes\n      if ( routes[i].imported ) continue\n      let routeObj = convertRouteObj(routes[i])\n      for ( j = i + 1; j < routes.length; ++j ) {\n        if ( routes[i].route !== routes[j].route ) break\n        if ( routes[j].route.imported ) continue\n        if ( checkSameRoute(routes[i], routes[j]) ) {\n          routeObj.co.push(routes[j].co)\n          routeObj.stops[routes[j].co] = routes[j].stops\n          routeObj.bound[routes[j].co] = routes[j].bound\n          // mark imported\n          routes[j].imported = true\n        }\n      }\n      \n      routeList[`${routeObj.route}+${routeObj.serviceType}+${routeObj.orig.en}+${routeObj.dest.en}`] = routeObj\n    }\n    \n    // sort the routeList by route no.\n    let _routeList = routeList\n    routeList = {}\n    Object.entries(_routeList).sort((a,b) => (a[0] < b[0] ? -1 : 1)).forEach(([routeNo, route]) => {\n      routeList[routeNo] = route\n    })\n\n    return routeList\n  })\n)\n\nexport { KmbApi, NwfbApi, CtbApi, fetchEtas, fetchRouteStops, fetchRouteList }","import React, { useEffect, useState } from 'react'\nimport { KmbApi, fetchRouteList } from './data-api'\n\nconst AppContext = React.createContext()\n\nexport const AppContextProvider = ( props ) => {\n  const [schemaVersion, setSchemaVersion] = useState(localStorage.getItem('schemaVersion'))\n  // route list & stop list & route-stop list\n  const [routeList, setRouteList] = useState(JSON.parse(localStorage.getItem('routeList')))\n  const [stopList, setStopList] = useState(JSON.parse(localStorage.getItem('stopList')))\n  const [updateTime, setUpdateTime] = useState(parseInt(localStorage.getItem('updateTime')))\n  // search route\n  const [searchRoute, setSearchRoute] = useState(\"\")\n  // selected route for bottom navigation shortcut\n  const [selectedRoute, setSelectedRoute] = useState(\"1+1+I\")\n  // Geo Permission for UX\n  const [ geoPermission, setGeoPermission ] = useState( localStorage.getItem('geoPermission') ) \n\n  // possible Char for RouteInputPad\n  const [possibleChar, setPossibleChar] = useState([])\n  \n  const renewDb = () => {\n    fetchRouteList().then( _routeList => updateRouteList(_routeList) ).then(() =>\n      // fetch only KMB stop list as the api return is succinct enough\n      // on-the-fly fetching for other service providers' stops\n      KmbApi.fetchStopList().then( _stopList => {\n        updateStopList(_stopList)\n        const _updateTime = Date.now()\n        setUpdateTime ( _updateTime )\n        localStorage.setItem('updateTime', _updateTime)\n      } )\n    )\n  }\n\n  useEffect(() => {\n    // check app version and flush localstorage if outdated\n    fetch( process.env.PUBLIC_URL + '/schema-version.txt').then(\n      response => response.text()\n    ).then( _schemaVersion => {\n      let needRenew = false\n      if ( schemaVersion !== _schemaVersion ) {\n        setSchemaVersion(_schemaVersion)\n        localStorage.setItem('schemaVersion', _schemaVersion)\n        needRenew = true\n      }\n      needRenew = needRenew || routeList == null || stopList == null || updateTime == null || updateTime < Date.now() - 7 * 24 * 60 * 60 * 1000\n      if (needRenew) {\n        renewDb()\n      }\n    })\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  useEffect(() => {\n    setPossibleChar(getPossibleChar(searchRoute, routeList))\n  }, [searchRoute, routeList])\n\n  const updateStopList = (_stopList) => {\n    // caching localStorage\n    localStorage.setItem('stopList', JSON.stringify(_stopList))\n    setStopList(_stopList)\n  }\n\n  const updateRouteList = (_routeList) => {\n    if ( typeof(_routeList) === 'function' ) {\n      _routeList = _routeList(routeList)\n    }\n    // caching localStorage\n    localStorage.setItem('routeList', JSON.stringify(_routeList))\n    setRouteList(_routeList)\n  }\n\n  const updateSearchRouteByButton = (buttonValue) => {\n    switch (buttonValue) {\n      case 'b': \n        setSearchRoute(searchRoute.slice(0,-1))\n        break\n      case '-':\n        setSearchRoute('')\n        break\n      default: \n        setSearchRoute(searchRoute+buttonValue)\n    }\n  }\n\n\n  const updateGeoPermission = ( state ) => {\n    setGeoPermission(state)\n    localStorage.setItem('geoPermission', state)\n  }\n\n  return (\n    <AppContext.Provider value={{\n        routeList, updateRouteList, stopList, updateStopList,\n        searchRoute, setSearchRoute, updateSearchRouteByButton,\n        selectedRoute, setSelectedRoute,\n        possibleChar,\n        // settings\n        renewDb, schemaVersion, updateTime,\n        geoPermission, updateGeoPermission \n      }}\n    >\n      {props.children}\n    </AppContext.Provider>\n  )\n}\n\nexport default AppContext\n\nconst getPossibleChar = ( searchRoute, routeList ) => {\n  if ( routeList == null ) return []\n  let possibleChar = {}\n  Object.entries(routeList).forEach(route => {\n    if ( route[0].startsWith(searchRoute.toUpperCase()) ) {\n      let c = route[0].slice(searchRoute.length, searchRoute.length+1)\n      possibleChar[c] = isNaN(possibleChar[c]) ? 1 : ( possibleChar[c] + 1)\n    }\n  })\n  return Object.entries(possibleChar).map(k => k[0]).filter(k => k !== '+')\n}","import React, { useContext } from \"react\"\nimport {\n  Input,\n  Tabs,\n  Tab,\n  Toolbar,\n  Typography\n} from \"@material-ui/core\"\nimport { withStyles, makeStyles } from '@material-ui/core/styles'\nimport { useLocation, useHistory, Link } from 'react-router-dom'\nimport { useTranslation } from 'react-i18next'\nimport { useRouteMatch } from 'react-router-dom'\nimport AppContext from './AppContext'\n\nconst Header = (props) => {\n  const { searchRoute, setSearchRoute } = useContext( AppContext )\n  \n  const { path } = useRouteMatch()\n  const { t, i18n } = useTranslation()\n  const classes = useStyles()\n  let location = useLocation()\n  const history = useHistory()\n\n  const handleLanguageChange = lang => {\n    history.replace( location.pathname.replace('/'+i18n.language+'/', '/'+lang+'/') )\n    i18n.changeLanguage(lang)\n  }\n\n  return (\n    <Toolbar\n      className={classes.toolbar}\n    >\n      <Link\n        to={{\n          pathname: `/${i18n.language}/search`\n        }}\n      >\n        <Typography variant=\"h6\">香港</Typography>\n        <Typography variant='subtitle2'>獨立巴士預報</Typography>\n      </Link> \n      <Input \n        className={classes.searchRouteInput}\n        type=\"text\"\n        value={searchRoute}\n        placeholder={t('巴士線')}\n        onChange={e => setSearchRoute(e.target.value)}\n        disabled={path.includes('route')}\n      />\n      <LanguageTabs\n          value={i18n.language}\n          onChange={(e, v) => handleLanguageChange(v)}\n        >\n        <LanguageTab value=\"en\" label=\"En\" />\n        <LanguageTab value=\"zh\" label=\"繁\" />\n      </LanguageTabs>\n    </Toolbar>\n  );\n}\n\nconst useStyles = makeStyles(theme => ({\n  toolbar: {\n    '& a': {\n      color: 'black',\n      textDecoration: 'none',\n    },\n    display: 'flex',\n    justifyContent: 'space-between',\n    zIndex: theme.zIndex.drawer * 2\n  },\n  searchRouteInput: {\n    maxWidth: '50px',\n    \"& input\": {\n      textAlign: 'center'\n    }\n  }\n}))\n\nconst LanguageTabs = withStyles({\n  root: {\n    borderBottom: 'none',\n    minHeight: 24\n  },\n  indicator: {\n    backgroundColor: 'transparent'\n  }\n})(Tabs);\n\nconst LanguageTab = withStyles((theme) => ({\n  root: {\n    textTransform: 'none',\n    minWidth: 36,\n    fontWeight: 900,\n    marginRight: theme.spacing(0),\n    fontSize: '15px',\n    opacity: 1,\n    padding: '6px 6px'\n  },\n  selected:{\n    '& > .MuiTab-wrapper':{\n      color: '#3B3C45',\n      backgroundColor: '#FEFBFA'\n    }\n  },\n  wrapper: {\n    color: '#3B3C45',\n    borderRadius: '30px',\n    padding: '2px 10px 0px 10px'\n  }\n}))((props) => <Tab disableRipple {...props} />);\n\nexport default Header;","import React, { useContext } from 'react'\nimport { \n  Box,\n  Button,\n  Grid\n} from '@material-ui/core'\nimport {\n  makeStyles\n} from '@material-ui/styles'\nimport BackspaceOutlinedIcon from '@material-ui/icons/BackspaceOutlined';\n\nimport AppContext from '../AppContext'\nimport { useTranslation } from 'react-i18next';\n\nconst KeyButton = ({k, handleClick, disabled = false}) => {\n  const classes = useStyles()\n  const { t } = useTranslation()\n  return (\n    <Button \n      size=\"large\"\n      variant=\"contained\" \n      className={classes.button}\n      onClick={() => handleClick(k)}\n      disabled={disabled}\n    >\n      {k === 'b' ? <BackspaceOutlinedIcon/> : \n        k === '-' ? t('取消') : k}\n    </Button>\n  )\n}\n\nconst RouteNumPad = () => {\n  const { searchRoute, updateSearchRouteByButton, possibleChar } = useContext( AppContext )\n\n  return (\n    <Grid container spacing={0}>\n    {\n      '789456123-0b'.split('').map( k => (\n        <Grid item xs={4} key={'input-'+k}>\n          <KeyButton\n            k={k}\n            handleClick={updateSearchRouteByButton}\n            style={{fontSize: '0.6rem'}}\n            disabled={\n              (k === 'b' && searchRoute === '') \n              || ( !'b-'.includes(k) && !possibleChar.includes(k))\n              || ( k === '-' && searchRoute === '' )\n            }\n          />\n        </Grid>\n      ))\n    }\n    </Grid>\n  )\n}\n\nconst RouteAlphabetPad = () => {\n  const { updateSearchRouteByButton, possibleChar } = useContext( AppContext )\n  \n  return (\n    <Grid container spacing={1}>\n      {\n        possibleChar.filter(k => isNaN(k)).map(k => (\n          <Grid item xs={12} key={'input-'+k}>\n            <KeyButton\n              k={k}\n              handleClick={updateSearchRouteByButton}\n            />\n          </Grid>\n        )) \n      }\n    </Grid>\n  )\n}\n\nconst RouteInputPad = () => {\n\n  const classes = useStyles()\n  const padding = 0\n\n  return (\n    <Box className={classes.boxContainer} padding={padding}>\n      <Box className={classes.numPadContainer} padding={padding}>\n        <RouteNumPad />\n      </Box>\n      <Box className={classes.alphabetPadContainer} padding={padding}>\n        <RouteAlphabetPad />\n      </Box>\n    </Box>\n  )\n}\n\nexport default RouteInputPad\n\nconst useStyles = makeStyles(theme => ({\n  boxContainer: {\n    display: 'flex',\n    flexDirection: 'row',\n    height: '180px',\n    justifyContent: 'space-around'\n  },\n  numPadContainer: {\n    width: '60%',\n  },\n  alphabetPadContainer: {\n    width: '20%',\n    height: '100%',\n    overflowX: 'hidden',\n    overflowY: 'scroll'\n  },\n  button: {\n    width: '100%',\n    height: 42,\n    borderRadius: 'unset'\n  }\n}))","import React, { useContext } from 'react'\nimport {\n  Card,\n  CardActionArea,\n  CardContent,\n  Typography\n} from '@material-ui/core'\nimport { makeStyles } from '@material-ui/core/styles'\nimport AppContext from '../AppContext'\nimport { useTranslation } from 'react-i18next'\nimport { FixedSizeList as List, areEqual } from 'react-window'\nimport memorize from 'memoize-one'\nimport RouteInputPad from './RouteInputPad'\nimport { Link } from  'react-router-dom'\n\nconst RouteRow = React.memo(( {data, index, style} ) => {\n  const { t, i18n } = useTranslation()\n  const { routeList } = data\n  const route = routeList[index]\n  const [routeNo, service_type] = route[0].split('+').slice(0,2)\n  const classes = useStyles()\n\n  return (\n    <Link to={'/'+i18n.language+'/route/'+route[0]}>\n      <Card variant=\"outlined\" key={route[0]} style={style} square>\n        <CardActionArea>\n          <CardContent className={classes.cardContent}>\n            <Typography variant=\"h5\" display=\"inline\">{routeNo}</Typography>\n            <Typography variant=\"caption\"> - {route[1].co.map(co => t(co)).join('+')}</Typography>\n            <br/>\n            <Typography variant=\"subtitle2\" display=\"inline\">{t('往')} {route[1].dest[i18n.language]}  </Typography>\n            <Typography variant=\"caption\">{service_type >= '2' ? t('特別班次') : '　'}</Typography>\n          </CardContent>\n        </CardActionArea>\n      </Card>\n    </Link>\n  )\n}, areEqual)\n\nconst createItemData = memorize((routeList) => ({routeList}))\n\nconst RouteList = () => {\n  const { routeList, searchRoute } = useContext(AppContext)\n  const targetRouteList = Object.entries(routeList).filter(\n    element => element[0].startsWith(searchRoute.toUpperCase())\n  ) \n\n  const itemData = createItemData(targetRouteList)\n  return (\n    <List\n      height={358}\n      itemCount={targetRouteList.length}\n      itemSize={69}\n      width=\"100%\"\n      itemData={itemData}\n    >\n        {RouteRow}\n    </List>\n  )\n}\n\nconst RouteBoard = () => {\n  return (\n    <>\n      <RouteList />\n      <hr/>\n      <RouteInputPad />\n    </>\n  )\n}\n\nexport default RouteBoard\n\nconst useStyles = makeStyles (theme => ({\n  cardContent: {\n    padding: '8px 16px',\n  }\n}))","import React, { useState, useEffect, useContext, useRef } from 'react'\nimport { useParams, useHistory } from 'react-router-dom'\nimport MuiAccordion from'@material-ui/core/Accordion'\nimport MuiAccordionSummary from'@material-ui/core/AccordionSummary'\nimport MuiAccordionDetails from'@material-ui/core/AccordionDetails'\nimport {\n  Box, CircularProgress, Typography\n} from '@material-ui/core'\nimport { makeStyles, withStyles } from '@material-ui/core/styles'\nimport AppContext from '../AppContext'\nimport { useTranslation } from 'react-i18next'\nimport { \n  fetchRouteStops as fetchRouteStopsViaApi,\n  fetchEtas as fetchEtasViaApi \n} from '../data-api'\n\nconst RouteEta = () => {\n  const { id, panel } = useParams()\n  const [ expanded, setExpanded ] = useState(false)\n  const { routeList, stopList, updateRouteList, updateStopList, setSelectedRoute } = useContext ( AppContext )\n  const { route, serviceType, bound, stops, co } = routeList[id]\n  const { i18n } = useTranslation()\n  const history = useHistory()\n  const accordionRef = useRef([])\n\n  const handleChange = ( panel ) => (event, newExpanded) => {\n    setExpanded(newExpanded ? panel : false)\n    if ( newExpanded ) {\n      history.replace(`/${i18n.language}/route/${id}/${panel}`)\n      setSelectedRoute(`${id}/${panel}`)\n      return\n    }\n  }\n\n  useEffect(() => {\n    setSelectedRoute(`${id}`)\n    // check if stops not fetched\n    if ( co.filter(company => stops[company] == null).length ) {\n      // fetch in parallel\n      Promise.all(\n        co.map(company => {\n          if ( stops[company] !== null ) return null;\n          return fetchRouteStopsViaApi({\n            route, serviceType, bound: bound[company], co: company\n          })\n        }).filter(v => v)\n      ).then(objs => {\n        // set stop list\n        let _stopList = {}\n        objs.forEach( obj => {\n          _stopList = {..._stopList, ...obj.stopList}\n        } )\n        updateStopList({...stopList, ..._stopList})\n\n        // set route list\n        updateRouteList(prevRouteList => {\n          let _routeList = JSON.parse(JSON.stringify(prevRouteList))\n          objs.forEach(obj => _routeList[id].stops[obj.co] = obj.routeStops)\n          return _routeList\n        })\n      })\n    }\n\n    if ( parseInt(panel) && accordionRef.current[parseInt(panel)] ) {\n      setExpanded(parseInt(panel))\n      accordionRef.current[parseInt(panel)].scrollIntoView({behavior: 'smooth', block: 'nearest'})\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  const classes = useStyles()\n\n  if ( stops[co[0]] == null ) {\n    return (\n      <Box className={classes.loadingContainer}>\n        <CircularProgress size={30} />\n      </Box>\n    )\n  }\n\n  return (\n    <Box className={classes.boxContainer}>\n      {\n        stops[co[0]].map((stop, idx) => (\n          <Accordion \n            key={'stop-'+idx} \n            expanded={expanded === idx}\n            onChange={handleChange(idx)}\n            TransitionProps={{unmountOnExit: true}}\n            ref={el => {accordionRef.current[idx] = el}}\n          >\n            <AccordionSummary>{stopList[stop].name[i18n.language]}</AccordionSummary>\n            <AccordionDetails>\n              <TimeReport \n                route={route}\n                seq={idx + 1}\n                routeStops={stops}\n                serviceType={serviceType}\n                bound={bound}\n                co={co}\n                routeSize={stops[co[0]].length}\n              />\n            </AccordionDetails>\n          </Accordion>\n        ))\n      }\n    </Box>\n  )\n}\n\nexport default RouteEta\n\nconst TimeReport = ( { route, routeStops, seq, bound, serviceType, co, routeSize } ) => {\n  const { t, i18n } = useTranslation()\n  const [ etas, setEtas ] = useState(null)\n\n  const fetchEtas = () => {\n    const fetchData = async () => {\n      setEtas( await fetchEtasViaApi({route, routeStops, seq, bound, serviceType, co, routeSize}) )\n    }\n    fetchData()\n  }\n\n  useEffect( () => {\n    fetchEtas()\n    const fetchEtaInterval = setInterval(() => {\n      fetchEtas()\n    }, 30000)\n\n    return () => clearInterval(fetchEtaInterval)\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  if ( etas == null ) {\n    return (\n      <CircularProgress size={20} style={{}} />\n    )\n  }\n\n  const displayMsg = (eta) => {\n    let ret = ''\n    switch (eta) {\n      case null: \n        break\n      case 0: \n        ret = '- '+t('分鐘')\n        break\n      default:\n        ret = eta + \" \" + t('分鐘')\n        break\n    }\n    return ret\n  }\n  \n  return (\n    <div>\n      {\n        etas.length === 0 ? t('暫無班次') : (\n          etas.map((eta, idx) => (\n            <Typography variant=\"subtitle1\" key={`route-${idx}`}>\n              {displayMsg(eta.eta)} {eta.remark[i18n.language] ? ' - ' + eta.remark[i18n.language] : '' } {t(eta.co)}\n            </Typography>\n          ))\n        )\n      }\n    </div>\n  )\n}\n\nconst Accordion = withStyles({\n  root: {\n    border: '1px solid rgba(0, 0, 0, .125)',\n    boxShadow: 'none',\n    '&:not(:last-child)': {\n      borderBottom: 0,\n    },\n    '&:before': {\n      display: 'none',\n    },\n    '&$expanded': {\n      margin: 'auto',\n    },\n  },\n  expanded: {},\n})(MuiAccordion)\n\nconst AccordionSummary = withStyles({\n  root: {\n    backgroundColor: 'rgba(0, 0, 0, .03)',\n    borderBottom: '1px solid rgba(0, 0, 0, .125)',\n    marginBottom: -1,\n    minHeight: 56,\n    '&$expanded': {\n      minHeight: 56,\n    },\n  },\n  content: {\n    '&$expanded': {\n      margin: '12px 0',\n    },\n  },\n  expanded: {},\n})(MuiAccordionSummary);\n\nconst AccordionDetails = withStyles((theme) => ({\n  root: {\n    padding: theme.spacing(2),\n  },\n}))(MuiAccordionDetails);\n\nconst useStyles = makeStyles(theme => ({\n  boxContainer: {\n    overflowY: 'scroll'\n  },\n  loadingContainer: {\n    display: 'flex',\n    justifyContent: 'center'\n  }\n}))","import React, { useContext, useEffect, useState } from 'react'\nimport AppContext from '../AppContext'\nimport {\n  Avatar,\n  Divider,\n  List,\n  ListItem,\n  ListItemAvatar,\n  ListItemText,\n  Paper,\n  Snackbar\n} from '@material-ui/core'\nimport { makeStyles } from '@material-ui/core/styles'\nimport BuildIcon from '@material-ui/icons/Build'\nimport LocationOnIcon from '@material-ui/icons/LocationOn'\nimport LocationOffIcon from '@material-ui/icons/LocationOff'\nimport { useTranslation } from 'react-i18next'\nimport MonetizationOnIcon from '@material-ui/icons/MonetizationOn'\nimport DataUsageIcon from '@material-ui/icons/DataUsage'\nimport moment from 'moment'\n\nconst Settings = () => {\n  const { schemaVersion, updateTime, geoPermission, updateGeoPermission, renewDb } = useContext ( AppContext )\n  const [ updating, setUpdating ] = useState(false)\n\n  const { t, i18n } = useTranslation()\n  const classes = useStyles()\n\n  useEffect(() => {\n    setUpdating(false)\n  }, [updateTime])\n\n  return (\n    <Paper className={classes.root}>\n      <List>\n        <ListItem\n          button\n          onClick={() => {setUpdating(true);renewDb()}}\n        >\n          <ListItemAvatar>\n            <Avatar><BuildIcon /></Avatar>\n          </ListItemAvatar>\n          <ListItemText \n            primary={t(\"架構版本\")+\": \"+schemaVersion} \n            secondary={t('更新時間：') + \" \" + moment(updateTime).format('YYYY-MM-DD HH:mm:ss')} \n          />\n        </ListItem>\n        <ListItem\n          button\n          onClick={() => {\n            if ( geoPermission === 'granted' ) {\n              updateGeoPermission('closed')\n            } else {\n              navigator.geolocation.getCurrentPosition(position => {\n                updateGeoPermission('granted')\n              })\n            }\n          }}\n        >\n          <ListItemAvatar>\n            <Avatar>{geoPermission === 'granted' ? <LocationOnIcon /> : <LocationOffIcon />}</Avatar>\n          </ListItemAvatar>\n          <ListItemText \n            primary={t(\"地理位置定位功能\")} \n            secondary={t(geoPermission === 'granted' ? '開啟' : '關閉') } \n          />\n        </ListItem>\n        <Divider />\n        <ListItem\n          button\n          component='a'\n          href={`https://donate.612fund.hk/${i18n.language}/`}\n          target=\"_blank\"\n        >\n          <ListItemAvatar>\n            <Avatar><MonetizationOnIcon /></Avatar>\n          </ListItemAvatar>\n          <ListItemText \n            primary={t(\"捐款支持\")} \n            secondary={t('請捐款到 612 人道支援基金') } \n          />\n        </ListItem>\n        <Divider />\n        <ListItem>\n          <ListItemAvatar>\n            <Avatar><DataUsageIcon /></Avatar>\n          </ListItemAvatar>\n          <ListItemText \n            primary={t(\"資料來源\")} \n            secondary={t('資料一線通') + \"  https://data.gov.hk\" } \n          />\n        </ListItem>\n      </List>\n      <Snackbar\n        anchorOrigin={{vertical: 'bottom', horizontal: 'center'}}\n        open={updating}\n        message={t('資料更新中...')}\n      />\n    </Paper>\n  )\n}\n\nexport default Settings\n\nconst useStyles = makeStyles ( theme => ({\n  root: {\n    background: 'white',\n    height: 'calc(100vh - 120px)'\n  }\n}))","import React, { useContext } from 'react'\nimport {\n  BottomNavigation,\n  BottomNavigationAction\n} from '@material-ui/core'\nimport SearchIcon from '@material-ui/icons/Search'\nimport TimerIcon from '@material-ui/icons/Timer'\nimport SettingsIcon from '@material-ui/icons/Settings';\nimport { Link, useLocation } from 'react-router-dom'\nimport { useTranslation } from 'react-i18next'\nimport AppContext from './AppContext'\n\nconst Footer = () => {\n  const { t, i18n } = useTranslation()\n  const location = useLocation()\n  const { selectedRoute } = useContext ( AppContext ) \n  \n  return (\n    <BottomNavigation\n      value={location.pathname}\n      showLabels={true}\n    >\n      <BottomNavigationAction \n        label={t(\"搜尋\")}\n        component={Link}\n        to={`/${i18n.language}/search`}\n        value={`/${i18n.language}/search`}\n        icon={<SearchIcon />} \n      />\n      <BottomNavigationAction\n       label={selectedRoute.split('+')[0]}\n       component={Link}\n       to={`/${i18n.language}/route/${selectedRoute}`}\n       value={`/${i18n.language}/route/${selectedRoute}`}\n       icon={<TimerIcon />} \n      />\n      <BottomNavigationAction\n       label={t(\"設定\")}\n       component={Link}\n       to={`/${i18n.language}/settings`}\n       value={`/${i18n.language}/settings`}\n       icon={<SettingsIcon />} \n      />\n    </BottomNavigation>\n  )\n}\n\nexport default Footer","import './App.css'\nimport { MuiThemeProvider, createMuiTheme } from '@material-ui/core/styles'\nimport React, { useContext } from 'react'\nimport {\n  HashRouter as Router,\n  Redirect,\n  Switch,\n  Route,\n  useRouteMatch\n} from \"react-router-dom\";\nimport {\n  CircularProgress,\n  Container,\n  CssBaseline,\n  Paper,\n  Typography\n} from '@material-ui/core'\nimport {\n  makeStyles\n} from '@material-ui/core/styles'\nimport Header from './Header'\nimport RouteBoard from './components/RouteBoard'\nimport RouteEta from './components/RouteEta'\nimport Settings from './components/Settings'\nimport AppContext from './AppContext'\nimport Footer from './Footer'\nimport Countdown from 'react-countdown'\n\nconst PageSwitch = () => {\n  const { path } = useRouteMatch()\n  return (\n    <Switch>\n      <Route path={`${path}/route/:id/:panel?`}>\n        <RouteEta />\n      </Route>\n      <Route path={`${path}/settings`}>\n        <Settings />\n      </Route>      \n      <Route path={`${path}/search`}>\n        <RouteBoard />\n      </Route>\n    </Switch>\n  )\n}\n\nconst App = () => {\n  /*\n  navigator.geolocation.getCurrentPosition(position => {\n    console.log(position.coords.latitude, position.coords.longitude)\n  })\n  */\n  \n  const classes = useStyles()\n  const { routeList, stopList } = useContext( AppContext )\n  if ( routeList == null || stopList == null ) {\n    return (\n      <Container maxWidth='xs' disableGutters className={classes.loadingContainer}>\n        <CircularProgress size={40} />\n        <br />\n        <br />\n        <Paper className={classes.loadingTextContainer} elevation={0}>\n          <Countdown \n            date={Date.now() + 20000}\n            renderer={({seconds, completed}) => {\n              if ( completed ) {\n                return <Typography variant=\"subtitle2\" align=\"center\">介面開啟中...</Typography>\n              } else {\n                return (\n                  <>\n                    <Typography variant=\"subtitle2\" align=\"center\">初始設定...</Typography>\n                    <Typography variant=\"subtitle2\" align=\"center\">正在更新巴士路線資料...</Typography>\n                    <Typography variant=\"subtitle2\" align=\"center\">約需{seconds}秒</Typography>\n                  </>\n                )\n              }\n            }}\n          />\n            \n        </Paper>\n      </Container>\n    )\n  } \n\n  return (\n    <MuiThemeProvider theme={Theme}>\n      <Container maxWidth='xs' disableGutters className={classes.container}>\n        <Router>\n          <Route exact path=\"/\">\n            <Redirect to=\"/zh/search\" />\n          </Route>\n          <Route path=\"/:lang\">\n            <CssBaseline />\n            <Header />\n            <PageSwitch />\n            <Footer />\n          </Route>\n        </Router>\n      </Container>\n    </MuiThemeProvider>\n  );\n}\n\nexport default App;\n\nconst Theme = createMuiTheme({\n  typography: {\n    fontFamily: \"Noto Sans TC, Chivo, sans-serif\"\n  },\n  palette: {\n    background: {\n      default: \"#ffff00\" // yellow\n    }\n  }\n})\n\nconst useStyles = makeStyles( theme => ({\n  container: {\n    display: 'flex',\n    flexDirection: 'column',\n    justifyContent: 'space-between',\n    height: '100vh'\n  },\n  loadingContainer: {\n    display: 'flex',\n    flexDirection: 'column',\n    justifyContent: 'center',\n    alignItems: 'center',\n    height: '100vh'\n  },\n  loadingText: {\n\n  }\n}))\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import i18n from \"i18next\";\nimport { initReactI18next } from \"react-i18next\";\nimport resources from \"./i18n/translation.json\";\n\nconst DEFAULT_LANG = window.location.pathname.substr(1,2) === 'en' ? 'en' : 'zh'\n\ni18n\n  .use(initReactI18next)\n  .init({\n    resources,\n    whitelist: ['en', 'zh'],\n    lowerCaseLng: true,\n    lng: DEFAULT_LANG,\n    nsSeparator: false,\n    keySeparator: false,\n    debug: false,\n\n    interpolation:{\n      escapeValue: false\n    }\n  });\n\nexport default i18n;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\nimport { AppContextProvider } from './AppContext'\nimport './i18n'\n\nReactDOM.render(\n  //<React.StrictMode>\n    <AppContextProvider>\n      <App />\n    </AppContextProvider>\n  //</React.StrictMode>,\n  ,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}