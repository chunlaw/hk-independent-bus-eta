{"version":3,"sources":["data-api/Kmb.js","data-api/Nwfb.js","data-api/Ctb.js","data-api/index.js","AppContext.js","components/layout/Header.js","utils.js","components/home/SuccinctTimeReport.js","components/Home.js","components/route-board/RouteInputPad.js","components/route-board/RouteRow.js","components/RouteBoard.js","components/route-eta/RouteMap.js","components/route-eta/TimeReport.js","components/RouteEta.js","components/Settings.js","components/layout/Footer.js","App.js","reportWebVitals.js","i18n.js","index.js"],"names":["KmbApi","co","fetchRouteList","fetch","then","response","json","data","reduce","routeList","element","route","service_type","bound","join","orig","en","orig_en","replace","zh","orig_tc","dest","dest_en","dest_tc","stops","serviceType","parseInt","generated_timestamp","forEach","push","stop","Object","entries","map","fetchStopList","stopList","name","name_en","nameEncodingHandling","name_tc","location","lat","parseFloat","lng","long","fetchRouteStops","fetchEtas","stopId","seq","cache","filter","e","dir","eta","Math","round","moment","diff","remark","rmk_tc","rmk_en","fetchStopEtas","rmk","NwfbApi","acc","concat","routeStops","Promise","all","CtbApi","a","_etas","company_id","kmb","length","ctb","nwfb","sort","b","Number","isInteger","api","v","checkSameName","name_a","toUpperCase","name_b","includes","checkSameRoute","route1","route2","end","convertRouteObj","routeObj","ret","AppContext","React","createContext","AppContextProvider","props","useState","localStorage","getItem","schemaVersion","setSchemaVersion","JSON","parse","setRouteList","setStopList","updateTime","setUpdateTime","searchRoute","setSearchRoute","selectedRoute","setSelectedRoute","geoPermission","setGeoPermission","geolocation","setGeoLocation","geoWatcherId","setGeoWatcherId","hotRoute","setHotRoute","savedEtas","setSavedEtas","possibleChar","setPossibleChar","renewDb","companyRoutes","i","j","routes","list","imported","_routeList","routeNo","_stopList","_updateTime","Date","now","setItem","useEffect","process","text","_schemaVersion","needRenew","_geoWatcherId","navigator","watchPosition","coords","latitude","longitude","clearWatch","getPossibleChar","stringify","Provider","value","updateNewlyFetchedRouteStops","routeId","objs","obj","prevRouteList","updateSearchRouteByButton","buttonValue","slice","updateSelectedRoute","prevHotRoute","updateSavedEtas","key","prevSavedEtas","k","resetUsageRecord","updateGeoPermission","state","children","startsWith","c","isNaN","useStyles","makeStyles","theme","toolbar","color","textDecoration","display","justifyContent","zIndex","drawer","searchRouteInput","maxWidth","textAlign","LanguageTabs","withStyles","root","borderBottom","minHeight","indicator","backgroundColor","Tabs","LanguageTab","textTransform","minWidth","fontWeight","marginRight","spacing","fontSize","opacity","padding","selected","wrapper","borderRadius","Tab","disableRipple","Header","useContext","path","useRouteMatch","useTranslation","t","i18n","classes","useLocation","history","useHistory","Toolbar","className","to","pathname","language","Typography","variant","Input","type","placeholder","onChange","target","disabled","lang","changeLanguage","label","getDistance","φ1","PI","φ2","Δφ","Δλ","aa","sin","cos","atan2","sqrt","SuccinctTimeReport","split","routeKey","etas","setEtas","isMounted","fetchData","fetchEtasViaApi","fetchEtaInterval","setInterval","clearInterval","getEtaString","ListItem","button","component","Link","listItem","ListItemText","primary","secondary","routeDest","CircularProgress","size","routeEta","Divider","width","Home","index","self","indexOf","selectedRoutes","arr","apply","fetchStopRoutesViaApi","routeLinks","routeLink","fetchRouteStopsViaApi","stopDetails","isUpdated","routeStopInfo","prevSelectedRoutes","s","Paper","List","background","height","overflowY","KeyButton","handleClick","Button","onClick","RouteNumPad","Grid","container","item","xs","style","RouteAlphabetPad","RouteInputPad","Box","boxContainer","numPadContainer","alphabetPadContainer","flexDirection","overflowX","RouteRow","memo","Card","square","CardActionArea","CardContent","cardContent","areEqual","createItemData","memorize","RouteList","targetRouteList","itemData","itemCount","itemSize","RouteBoard","ChangeMapCenter","center","zoom","useMap","flyTo","checkPosition","CenterControl","centerControlContainer","centerControl","RouteMap","stopIdx","onMarkerClick","setCenter","mapContainer","MapContainer","scrollWheelZoom","TileLayer","attribution","url","idx","Marker","position","eventHandlers","click","Polyline","positions","getPoint","Circle","radius","isFinite","marginBottom","TimeReport","displayMsg","RouteEta","useParams","id","panel","expanded","setExpanded","accordionRef","useRef","handleChange","event","newExpanded","isFromMap","current","scrollIntoView","behavior","block","autoSetPanel","nearbyStop","loadingContainer","align","TransitionProps","unmountOnExit","ref","el","IconButton","aria-label","Accordion","border","boxShadow","margin","MuiAccordion","AccordionSummary","content","MuiAccordionSummary","AccordionDetails","MuiAccordionDetails","Settings","updating","setUpdating","ListItemAvatar","Avatar","format","getCurrentPosition","href","Snackbar","anchorOrigin","vertical","horizontal","open","message","Footer","BottomNavigation","showLabels","BottomNavigationAction","icon","PageSwitch","App","Container","disableGutters","loadingTextContainer","elevation","date","renderer","seconds","completed","Theme","exact","CssBaseline","createMuiTheme","typography","fontFamily","palette","default","alignItems","loadingText","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","DEFAULT_LANG","window","substr","use","initReactI18next","init","resources","whitelist","lowerCaseLng","nsSeparator","keySeparator","debug","interpolation","escapeValue","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.ee2e264d.chunk.js","sourcesContent":["import moment from 'moment'\n\nconst KmbApi = {\n  co: 'kmb',\n  fetchRouteList: () => (\n    // fetch route data\n    fetch(\n      \"https://data.etabus.gov.hk/v1/transport/kmb/route/\"\n    ).then(\n      response => response.json()\n    ).then( ({data}) => \n      data.reduce( (routeList, element) => {\n        routeList[[element.route, element.service_type, element.bound].join('+')] = {\n          route: element.route,\n          co: 'kmb',\n          bound: element.bound,\n          orig: {\n            en: element.orig_en.replace('/','／'),\n            zh: element.orig_tc.replace('/','／')\n          },\n          dest: {\n            en: element.dest_en.replace('/','／'),\n            zh: element.dest_tc.replace('/','／')\n          },\n          stops: [],\n          serviceType: parseInt(element.service_type)\n        }\n        return routeList\n      }, {})\n    ).then( routeList => (\n      // fetch route stop data\n      fetch(\"https://data.etabus.gov.hk/v1/transport/kmb/route-stop/\").then(response => response.json())\n      .then(({data, generated_timestamp}) => {\n        data.forEach(element => {\n          routeList[[element.route, element.service_type, element.bound].join('+')].stops.push(\n            element.stop\n          )\n        })\n        return Object.entries(routeList).map(([id, obj]) => obj)\n      })\n    ))\n  ),\n  fetchStopList: () => {\n    return fetch(\"https://data.etabus.gov.hk/v1/transport/kmb/stop\").then(\n      response => response.json()\n    ).then(({data, generated_timestamp}) => {\n      let stopList = {}\n      data.forEach(element => {\n        stopList[element.stop] = {\n          name: {\n            en: element.name_en.replace('/','／'),\n            zh: nameEncodingHandling( element.name_tc ).replace('/','／')\n          },\n          location: {\n            lat: parseFloat(element.lat),\n            lng: parseFloat(element.long)\n          }\n        }\n      })\n      \n      return stopList\n    })\n  },\n  fetchRouteStops: ({route, bound, serviceType}) => {\n    // already fetched in the app start\n    return null\n  },\n  /*\n    @fetchEtas\n    return array of Object with props {\n      eta: (int) minute or null,\n      remark: {\n        zh: string\n        en: string\n      }\n    }\n  */\n  fetchEtas: ({stopId, route, seq, serviceType, bound}) => {\n    return fetch(\n      `https://data.etabus.gov.hk/v1/transport/kmb/eta/${stopId}/${route}/${serviceType}`,\n      { cache: \"no-store\" }\n    ).then( response => response.json() )\n    .then(({data}) => data.filter(e => e.dir === bound && e.seq === seq).map(e => ({\n        eta: e.eta ? Math.round(moment(e.eta).diff(moment()) / 60 / 1000) : e.eta,\n        remark: {\n          zh: e.rmk_tc,\n          en: e.rmk_en\n        },\n        co: 'kmb'\n      }))\n    )\n  },\n  fetchStopEtas: ( stopId ) => (\n    fetch(`https://data.etabus.gov.hk/v1/transport/kmb/stop-eta/${stopId}`, { cache: \"no-store\" })\n    .then(response => response.json())\n    .then(({data}) => data.map( e => ({\n      route: e.route,\n      bound: e.dir,\n      seq: e.seq,\n      eta: e.eta ? Math.round(moment(e.eta).diff(moment()) / 60 / 1000) : e.eta,\n      dest: {\n        zh: e.dest_tc,\n        en: e.dest_en\n      },\n      remark: {\n        zh: e.rmk,\n        en: e.rmk\n      },\n      serviceType: e.service_type,\n      co: 'kmb'\n    })))\n  )\n}\n\nexport default KmbApi\n\nconst nameEncodingHandling = (name) => {\n  if ( name === '瘝嗵眎�𧨾���' ) return '沙田坳道'\n  else if ( name === '暺�憭找�嗵��' ) return '黃大仙站'\n  else return name\n}","import moment from 'moment'\n\nconst NwfbApi = {\n  co: 'nwfb',\n  fetchRouteList: () => (\n    fetch(\"https://rt.data.gov.hk/v1/transport/citybus-nwfb/route/nwfb\")\n      .then(response => response.json())\n      .then(({data}) => (\n        data.reduce((acc, element) => (\n          acc.concat([ {\n            route: element.route,\n            bound: 'O',\n            orig: {\n              en: element.orig_en.replace('/','／'),\n              zh: element.orig_tc.replace('/','／')\n            },\n            dest: {\n              en: element.dest_en.replace('/','／'),\n              zh: element.dest_tc.replace('/','／')\n            },\n            co: 'nwfb',\n            stops: null,\n            serviceType: 1\n          },{\n            route: element.route,\n            bound: 'I',\n            orig: {\n              en: element.dest_en.replace('/','／'),\n              zh: element.dest_tc.replace('/','／')\n            },\n            dest: {\n              en: element.orig_en.replace('/','／'),\n              zh: element.orig_tc.replace('/','／')\n            },\n            co: 'nwfb',\n            stops: null,\n            serviceType: 1\n          }])\n        ), [])\n      ))\n  ),\n  fetchRouteStops: ({route, bound}) => {\n    if ( !bound ) return null // route not exist in this company\n    const dir = bound === 'I' ? 'inbound' : 'outbound'\n    return fetch(\n      `https://rt.data.gov.hk/v1/transport/citybus-nwfb/route-stop/NWFB/${route}/${dir}`\n    ).then( response => \n      response.json()\n    ).then( ({data}) => \n      data.map(e => e.stop) \n    ).then( routeStops => {\n      // fetch each stop in parallel\n      return Promise.all(routeStops.map(stopId => \n          fetch(`https://rt.data.gov.hk/v1/transport/citybus-nwfb/stop/${stopId}`).then(\n            response => response.json()\n          ).then ( ({data}) => ({\n            stopId: stopId,\n            name: {\n              zh: data.name_tc.replace('/','／'),\n              en: data.name_en.replace('/','／')\n            },\n            location: {\n              lat: parseFloat(data.lat),\n              lng: parseFloat(data.long)\n            }\n          }))\n        )).then( stops => {\n          let stopList = {};\n          stops.forEach(stop => stopList[stop.stopId] = stop)\n          return {routeStops, stopList, co: 'nwfb'}\n        })\n    })\n  },\n  fetchEtas: ({stopId, route, bound }) => (\n    fetch(`https://rt.data.gov.hk/v1/transport/batch/stop-eta/NWFB/${stopId}?lang=zh-hant`, { cache: \"no-store\" }).then(\n      response => response.json()\n    ).then(({data}) => data.filter(eta => eta.eta && eta.route === route && eta.dir === bound && eta.eta).map(e => ({\n        eta: e.eta ? Math.round(moment(e.eta).diff(moment()) / 60 / 1000) : e.eta,\n        remark: {\n          zh: e.rmk,\n          en: e.rmk\n        },\n        co: 'nwfb'\n      }))\n    )\n  ),\n  fetchStopEtas: ( stopId ) => (\n    fetch(`https://rt.data.gov.hk/v1/transport/batch/stop-eta/NWFB/${stopId}`, { cache: \"no-store\" }).then(\n      response => response.json()\n    ).then(({data}) => data.map( e => ({\n      route: e.route,\n      bound: e.dir,\n      seq: e.seq,\n      eta: e.eta ? Math.round(moment(e.eta).diff(moment()) / 60 / 1000) : e.eta,\n      dest: {\n        en: e.dest.replace('/','／')\n      },\n      remark: {\n        en: e.rmk\n      },\n      serviceType: 1,\n      co: 'nwfb'\n    })))\n  )\n}\n\nexport default NwfbApi","import moment from 'moment'\n\nconst CtbApi = {\n  co: 'ctb',\n  fetchRouteList: () => (\n    fetch(\"https://rt.data.gov.hk/v1/transport/citybus-nwfb/route/ctb\")\n      .then(response => response.json())\n      .then(({data}) => (\n        data.reduce((acc, element) => (\n          acc.concat([ {\n            route: element.route,\n            bound: 'O',\n            orig: {\n              en: element.orig_en.replace('/','／'),\n              zh: element.orig_tc.replace('/','／')\n            },\n            dest: {\n              en: element.dest_en.replace('/','／'),\n              zh: element.dest_tc.replace('/','／')\n            },\n            co: 'ctb',\n            stops: null,\n            serviceType: 1\n          },{\n            route: element.route,\n            bound: 'I',\n            orig: {\n              en: element.dest_en.replace('/','／'),\n              zh: element.dest_tc.replace('/','／')\n            },\n            dest: {\n              en: element.orig_en.replace('/','／'),\n              zh: element.orig_tc.replace('/','／')\n            },\n            co: 'ctb',\n            stops: null,\n            serviceType: 1\n          }])\n        ), [])\n      ))\n  ),\n  fetchRouteStops: ({route, bound}) => {\n    if ( !bound ) return null // route not exist in this company\n    const dir = bound === 'I' ? 'inbound' : 'outbound'\n    return fetch(\n      `https://rt.data.gov.hk/v1/transport/citybus-nwfb/route-stop/CTB/${route}/${dir}`\n    ).then( response => \n      response.json()\n    ).then( ({data}) => \n      data.map(e => e.stop) \n    ).then( routeStops => {\n      // fetch each stop in parallel\n      return Promise.all(routeStops.map(stopId => \n          fetch(`https://rt.data.gov.hk/v1/transport/citybus-nwfb/stop/${stopId}`).then(\n            response => response.json()\n          ).then ( ({data}) => ({\n            stopId: stopId,\n            name: {\n              zh: data.name_tc.replace('/','／'),\n              en: data.name_en.replace('/','／')\n            },\n            location: {\n              lat: parseFloat(data.lat),\n              lng: parseFloat(data.long)\n            }\n          }))\n        )).then( stops => {\n          let stopList = {};\n          stops.forEach(stop => stopList[stop.stopId] = stop)\n          return {routeStops, stopList, co: 'ctb'}\n        })\n    })\n  },\n  fetchEtas: ({stopId, route, bound }) => {\n    return fetch(`https://rt.data.gov.hk/v1/transport/batch/stop-eta/CTB/${stopId}?lang=zh-hant`, { cache: \"no-store\" }).then(\n      response => response.json()\n    ).then(({data}) => data.filter(eta => eta.eta && eta.route === route && eta.dir === bound).map(e => ({\n        eta: e.eta ? Math.round(moment(e.eta).diff(moment()) / 60 / 1000) : e.eta,\n        remark: {\n          zh: e.rmk,\n          en: e.rmk\n        },\n        co: 'ctb'\n      }))\n    )\n  },\n  fetchStopEtas: ( stopId ) => (\n    fetch(`https://rt.data.gov.hk/v1/transport/batch/stop-eta/CTB/${stopId}`, { cache: \"no-store\" }).then(\n      response => response.json()\n    ).then(({data}) => data.map( e => ({\n      route: e.route,\n      bound: e.dir,\n      seq: e.seq,\n      eta: e.eta ? Math.round(moment(e.eta).diff(moment()) / 60 / 1000) : e.eta,\n      dest: {\n        en: e.dest.replace('/','／')\n      },\n      remark: {\n        en: e.rmk\n      },\n      serviceType: 1,\n      co: 'ctb'\n    })))\n  )\n}\n\nexport default CtbApi","import KmbApi from './Kmb'\nimport NwfbApi from './Nwfb'\nimport CtbApi from './Ctb'\n\nconst fetchEtas = async ( {route, routeStops, bound, seq, serviceType, co }) => {\n  let _etas = []\n  for ( const company_id of co ) {\n    if (company_id === 'kmb' && routeStops.kmb ){\n      _etas = _etas.concat( await KmbApi.fetchEtas({\n        route,\n        stopId: routeStops.kmb[seq-1], \n        seq: (seq === routeStops.kmb.length ? 1000 : seq), \n        serviceType, bound: bound[company_id]}) \n      )\n    }\n    else if ( company_id === 'ctb' && routeStops.ctb ) {\n      _etas = _etas.concat( await CtbApi.fetchEtas({stopId: routeStops.ctb[seq-1], route, bound: bound[company_id] }))\n    }\n    else if ( company_id === 'nwfb' && routeStops.nwfb ) {\n      _etas = _etas.concat( await NwfbApi.fetchEtas({stopId: routeStops.nwfb[seq-1], route, bound: bound[company_id] }))\n    }\n  }\n\n  return _etas.sort((a,b) => { \n    if ( !a.eta ) return 1\n    else if (!b.eta) return -1\n    return a.eta < b.eta ? -1 : 1\n  }).filter(e => !Number.isInteger(e.eta) || e.eta > 1 )\n}\n\nconst fetchRouteStops = ( {route, bound, stops} ) => (\n  Promise.all([KmbApi, NwfbApi, CtbApi].map(api => \n    !stops[api.co] ? api.fetchRouteStops( { route, bound: bound[api.co] } ) : null\n  ).filter(v => v))\n)\n\nconst checkSameName = ( a, b ) => {\n  const name_a = a.toUpperCase()\n  const name_b = b.toUpperCase()\n  return name_a.includes(name_b) || name_b.includes(name_a)\n}\n\nconst checkSameRoute = (route1, route2) => (\n  route1.route === route2.route && route1.co !== route2.co && ['orig', 'dest'].map ( end => {\n    // check if either orig or dest name is the same\n    return checkSameName(route1[end].en, route2[end].en)\n  }).includes(true)\n)\n\nconst convertRouteObj = (routeObj) => {\n  let ret = {\n    route: routeObj.route,\n    co: [routeObj.co],\n    bound: {},\n    orig: {\n      en: routeObj.orig.en,\n      zh: routeObj.orig.zh\n    },\n    dest: {\n      en: routeObj.dest.en,\n      zh: routeObj.dest.zh\n    },\n    stops: {},\n    serviceType: routeObj.serviceType\n  }\n  ret.stops[routeObj.co] = routeObj.stops\n  ret.bound[routeObj.co] = routeObj.bound\n  return ret\n}\n\nconst fetchRouteList = () => (\n  Promise.all([KmbApi, NwfbApi, CtbApi].map(api => api.fetchRouteList()))\n  .then( companyRoutes => {\n    let routeList = {}\n    const routes = companyRoutes.reduce((acc, list) => acc.concat(list)).sort((a, b) => {\n      return a.route < b.route ? -1 : 0\n    })\n    let i, j\n    for ( i = 0; i < routes.length; ++i ){\n      // ignore imported routes\n      if ( routes[i].imported ) continue\n      let routeObj = convertRouteObj(routes[i])\n      for ( j = i + 1; j < routes.length; ++j ) {\n        if ( routes[i].route !== routes[j].route ) break\n        if ( routes[j].imported ) continue\n        if ( checkSameRoute(routes[i], routes[j]) ) {\n          routeObj.co.push(routes[j].co)\n          routeObj.stops[routes[j].co] = routes[j].stops\n          routeObj.bound[routes[j].co] = routes[j].bound\n          // mark imported\n          routes[j].imported = true\n        }\n      }\n      \n      routeList[`${routeObj.route}+${routeObj.serviceType}+${routeObj.orig.en}+${routeObj.dest.en}`] = routeObj\n    }\n    \n    // sort the routeList by route no.\n    let _routeList = routeList\n    routeList = {}\n    Object.entries(_routeList).sort((a,b) => (a[0] < b[0] ? -1 : 1)).forEach(([routeNo, route]) => {\n      routeList[routeNo] = route\n    })\n\n    return routeList\n  })\n)\n\nconst fetchStopRoutes = ( stopId, routeList ) => (\n  Promise.all([KmbApi, NwfbApi, CtbApi].map( api => \n  //Promise.all([NwfbApi].map( api => \n    api.fetchStopEtas(stopId)\n  )).then(arr => [].concat.apply([], arr))\n  .then(etas => (\n    Object.entries(routeList)\n    .map( ([routeId, routeObj]) => {\n      for ( const eta of etas) {\n        if (routeObj.route === eta.route\n          && routeObj.serviceType === eta.serviceType\n          && routeObj.bound[eta.co] === eta.bound\n          && checkSameName(routeObj.dest.en, eta.dest.en)\n        ) {\n          return `${routeId}/${eta.seq-1}`\n        } \n      }\n      return null\n    }).filter(routeId => routeId) \n  ))\n)\n\nexport { KmbApi, NwfbApi, CtbApi, fetchEtas, fetchRouteStops, fetchRouteList, fetchStopRoutes }","import React, { useEffect, useState } from 'react'\nimport { KmbApi, fetchRouteList } from './data-api'\n\nconst AppContext = React.createContext()\n\nexport const AppContextProvider = ( props ) => {\n  const [schemaVersion, setSchemaVersion] = useState(localStorage.getItem('schemaVersion'))\n  // route list & stop list & route-stop list\n  const [routeList, setRouteList] = useState(JSON.parse(localStorage.getItem('routeList')))\n  const [stopList, setStopList] = useState(JSON.parse(localStorage.getItem('stopList')))\n  const [updateTime, setUpdateTime] = useState(parseInt(localStorage.getItem('updateTime')))\n  // search route\n  const [searchRoute, setSearchRoute] = useState(\"\")\n  // selected route for bottom navigation shortcut\n  const [selectedRoute, setSelectedRoute] = useState('1+1+CHUK YUEN ESTATE+STAR FERRY')\n  // Geo Permission for UX\n  const [ geoPermission, setGeoPermission ] = useState( localStorage.getItem('geoPermission') ) \n  const [ geolocation, setGeoLocation ] = useState (JSON.parse(localStorage.getItem('geolocation')) || {lat: 22.302711, lng: 114.177216})\n  const [ geoWatcherId, setGeoWatcherId ] = useState ( null )\n\n  // hot query count\n  const [ hotRoute, setHotRoute ] = useState( JSON.parse(localStorage.getItem('hotRoute')) || {} )\n  const [ savedEtas, setSavedEtas ] = useState ( JSON.parse(localStorage.getItem('savedEtas')) || [] )\n\n  // possible Char for RouteInputPad\n  const [possibleChar, setPossibleChar] = useState([])\n  \n  const renewDb = () => {\n    fetchRouteList().then( _routeList => setRouteList(_routeList) ).then(() =>\n      // fetch only KMB stop list as the api return is succinct enough\n      // on-the-fly fetching for other service providers' stops\n      KmbApi.fetchStopList().then( _stopList => {\n        setStopList(_stopList)\n        const _updateTime = Date.now()\n        setUpdateTime ( _updateTime )\n        localStorage.setItem('updateTime', _updateTime)\n      } )\n    )\n  }\n\n  useEffect(() => {\n    // check app version and flush localstorage if outdated\n    fetch( process.env.PUBLIC_URL + '/schema-version.txt').then(\n      response => response.text()\n    ).then( _schemaVersion => {\n      let needRenew = false\n      if ( schemaVersion !== _schemaVersion ) {\n        setSchemaVersion(_schemaVersion)\n        localStorage.setItem('schemaVersion', _schemaVersion)\n        needRenew = true\n      }\n      needRenew = needRenew || routeList == null || stopList == null || updateTime == null || updateTime < Date.now() - 7 * 24 * 60 * 60 * 1000\n      if (needRenew) {\n        renewDb()\n      }\n    })\n\n    if ( geoPermission === 'granted' ) {\n      const _geoWatcherId = navigator.geolocation.watchPosition(({coords: {latitude, longitude}}) => {\n        setGeoLocation({lat: latitude, lng: longitude})\n      })\n      setGeoWatcherId ( _geoWatcherId )\n    }\n    return () => {\n      if ( geoWatcherId ) navigator.geolocation.clearWatch(geoWatcherId)\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  useEffect(() => {\n    if ( geoPermission === 'granted' ) {\n      const _geoWatcherId = navigator.geolocation.watchPosition(({coords: {latitude, longitude}}) => {\n        setGeoLocation({lat: latitude, lng: longitude})\n      })\n      setGeoWatcherId ( _geoWatcherId )\n    } else if ( geoWatcherId ) {\n      navigator.geolocation.clearWatch(geoWatcherId)\n      setGeoWatcherId(null)\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [geoPermission])\n\n  useEffect(() => {\n    setPossibleChar(getPossibleChar(searchRoute, routeList))\n  }, [searchRoute, routeList])\n\n  useEffect(() => {\n    localStorage.setItem('savedEtas', JSON.stringify(savedEtas))\n  }, [savedEtas])\n\n  useEffect(() => {\n    localStorage.setItem('stopList', JSON.stringify(stopList))\n  }, [stopList])\n\n  useEffect(() => {\n    localStorage.setItem('routeList', JSON.stringify(routeList))\n  }, [routeList])\n\n  useEffect(() => {\n    localStorage.setItem('geolocation', JSON.stringify(geolocation))\n  }, [geolocation])\n\n  useEffect(() => {\n    localStorage.setItem('geoPermission', geoPermission)\n  }, [geoPermission])\n\n  const updateNewlyFetchedRouteStops = ( routeId, objs ) => {\n    if ( objs.length === 0 ) return\n    // set stop list\n    let _stopList = {}\n    objs.forEach( obj => {\n      _stopList = {..._stopList, ...obj.stopList}\n    } )\n    setStopList({...stopList, ..._stopList})\n\n    // set route list\n    setRouteList(prevRouteList => {\n      let _routeList = JSON.parse(JSON.stringify(prevRouteList))\n      objs.forEach(obj => _routeList[routeId].stops[obj.co] = obj.routeStops)\n      return _routeList\n    })\n  }\n\n  const updateSearchRouteByButton = (buttonValue) => {\n    switch (buttonValue) {\n      case 'b': \n        setSearchRoute(searchRoute.slice(0,-1))\n        break\n      case '-':\n        setSearchRoute('')\n        break\n      default: \n        setSearchRoute(searchRoute+buttonValue)\n    }\n  }\n\n  const updateGeoPermission = ( state ) => {\n    setGeoPermission(state)\n  }\n\n  const updateSelectedRoute = ( route, seq = '' ) => {\n    setSelectedRoute ( `${route}/${seq}` )\n    if ( seq ) {\n      setHotRoute( prevHotRoute => {\n        prevHotRoute[route+'/'+seq] = hotRoute[route+'/'+seq] ? hotRoute[route+'/'+seq] + 1 : 1\n        localStorage.setItem('hotRoute', JSON.stringify(prevHotRoute))\n        return prevHotRoute\n      })\n    }\n  }\n\n  const updateSavedEtas = ( key ) => {\n    setSavedEtas ( prevSavedEtas => {\n      if ( prevSavedEtas.includes(key) ) return prevSavedEtas.filter(k => k !== key)\n      else return prevSavedEtas.concat(key)\n    })\n  }\n\n  const resetUsageRecord = () => {\n    setHotRoute({})\n    setGeoLocation(null)\n    setSavedEtas([])\n  }\n\n  return (\n    <AppContext.Provider value={{\n        routeList, stopList, \n        setRouteList, setStopList,\n        updateNewlyFetchedRouteStops,\n        searchRoute, setSearchRoute, updateSearchRouteByButton,\n        selectedRoute, updateSelectedRoute,\n        possibleChar,\n        // UX\n        hotRoute, geolocation,\n        savedEtas, updateSavedEtas,\n        resetUsageRecord,\n        // settings\n        renewDb, schemaVersion, updateTime,\n        geoPermission, updateGeoPermission \n      }}\n    >\n      {props.children}\n    </AppContext.Provider>\n  )\n}\n\nexport default AppContext\n\nconst getPossibleChar = ( searchRoute, routeList ) => {\n  if ( routeList == null ) return []\n  let possibleChar = {}\n  Object.entries(routeList).forEach(route => {\n    if ( route[0].startsWith(searchRoute.toUpperCase()) ) {\n      let c = route[0].slice(searchRoute.length, searchRoute.length+1)\n      possibleChar[c] = isNaN(possibleChar[c]) ? 1 : ( possibleChar[c] + 1)\n    }\n  })\n  return Object.entries(possibleChar).map(k => k[0]).filter(k => k !== '+')\n}","import React, { useContext } from \"react\"\nimport {\n  Input,\n  Tabs,\n  Tab,\n  Toolbar,\n  Typography\n} from \"@material-ui/core\"\nimport { withStyles, makeStyles } from '@material-ui/core/styles'\nimport { useLocation, useHistory, Link } from 'react-router-dom'\nimport { useTranslation } from 'react-i18next'\nimport { useRouteMatch } from 'react-router-dom'\nimport AppContext from '../../AppContext'\n\nconst Header = (props) => {\n  const { searchRoute, setSearchRoute } = useContext( AppContext )\n  \n  const { path } = useRouteMatch()\n  const { t, i18n } = useTranslation()\n  const classes = useStyles()\n  let location = useLocation()\n  const history = useHistory()\n\n  const handleLanguageChange = lang => {\n    history.replace( location.pathname.replace('/'+i18n.language+'/', '/'+lang+'/') )\n    i18n.changeLanguage(lang)\n  }\n\n  return (\n    <Toolbar\n      className={classes.toolbar}\n    >\n      <Link\n        to={{\n          pathname: `/${i18n.language}/search`\n        }}\n      >\n        <Typography variant=\"h6\">香港</Typography>\n        <Typography variant='subtitle2'>獨立巴士預報</Typography>\n      </Link> \n      <Input \n        className={classes.searchRouteInput}\n        type=\"text\"\n        value={searchRoute}\n        placeholder={t('巴士線')}\n        onChange={e => setSearchRoute(e.target.value)}\n        disabled={path.includes('route')}\n      />\n      <LanguageTabs\n          value={i18n.language}\n          onChange={(e, v) => handleLanguageChange(v)}\n        >\n        <LanguageTab value=\"en\" label=\"En\" />\n        <LanguageTab value=\"zh\" label=\"繁\" />\n      </LanguageTabs>\n    </Toolbar>\n  );\n}\n\nconst useStyles = makeStyles(theme => ({\n  toolbar: {\n    '& a': {\n      color: 'black',\n      textDecoration: 'none',\n    },\n    display: 'flex',\n    justifyContent: 'space-between',\n    zIndex: theme.zIndex.drawer * 2\n  },\n  searchRouteInput: {\n    maxWidth: '50px',\n    \"& input\": {\n      textAlign: 'center'\n    }\n  }\n}))\n\nconst LanguageTabs = withStyles({\n  root: {\n    borderBottom: 'none',\n    minHeight: 24\n  },\n  indicator: {\n    backgroundColor: 'transparent'\n  }\n})(Tabs);\n\nconst LanguageTab = withStyles((theme) => ({\n  root: {\n    textTransform: 'none',\n    minWidth: 36,\n    fontWeight: 900,\n    marginRight: theme.spacing(0),\n    fontSize: '15px',\n    opacity: 1,\n    padding: '6px 6px'\n  },\n  selected:{\n    '& > .MuiTab-wrapper':{\n      color: '#3B3C45',\n      backgroundColor: '#FEFBFA'\n    }\n  },\n  wrapper: {\n    color: '#3B3C45',\n    borderRadius: '30px',\n    padding: '2px 10px 0px 10px'\n  }\n}))((props) => <Tab disableRipple {...props} />);\n\nexport default Header;","export const getDistance = (a, b) => {\n  const R = 6371e3; // metres\n  const φ1 = a.lat * Math.PI/180; // φ, λ in radians\n  const φ2 = b.lat * Math.PI/180;\n  const Δφ = (b.lat-a.lat) * Math.PI/180;\n  const Δλ = (b.lng-a.lng) * Math.PI/180;\n\n  const aa = Math.sin(Δφ/2) * Math.sin(Δφ/2) +\n            Math.cos(φ1) * Math.cos(φ2) *\n            Math.sin(Δλ/2) * Math.sin(Δλ/2);\n  const c = 2 * Math.atan2(Math.sqrt(aa), Math.sqrt(1-aa));\n  return R * c; // in metres\n}","import React, { useContext, useEffect, useState } from 'react'\nimport {\n  CircularProgress,\n  Divider,\n  ListItem,\n  ListItemText\n} from '@material-ui/core'\nimport { Link } from 'react-router-dom'\nimport { makeStyles } from '@material-ui/core/styles'\nimport AppContext from '../../AppContext'\nimport { useTranslation } from 'react-i18next'\nimport { \n  fetchEtas as fetchEtasViaApi\n} from '../../data-api'\n\nconst SuccinctTimeReport = ({routeId} ) => {\n  const { t, i18n } = useTranslation()\n  const { routeList, stopList } = useContext ( AppContext )\n  const [ routeNo, serviceType ] = routeId.split('+')\n  const [ routeKey, seq ] = routeId.split('/')\n  const { co, stops, dest, bound } = routeList[routeKey]\n  const stop = stopList[stops[co[0]] ? stops[co[0]][seq] : null]\n  const [ etas, setEtas ] = useState(null)\n  const classes = useStyles()\n\n  useEffect(() => {\n    let isMounted = true\n    \n    const fetchData = () => (\n      fetchEtasViaApi({\n        route: routeNo, routeStops: stops, seq: parseInt(seq) + 1, bound, serviceType, co\n      }).then ( _etas => {\n        if (isMounted) setEtas(_etas)\n      })\n    )\n    \n    const fetchEtaInterval = setInterval(() => {\n      fetchData()\n    }, 30000)\n\n    fetchData()\n\n    return () => {\n      isMounted = false\n      clearInterval(fetchEtaInterval)\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  const getEtaString = (eta) => {\n    if ( !eta ) return ''\n    let ret = ''\n    switch (eta.eta) {\n      case null: \n        ret = eta.remark[i18n.language]\n        break\n      case 0: \n        ret = '- '+t('分鐘')\n        break\n      default:\n        ret = eta.eta + \" \" + t('分鐘')\n        break\n    }\n    return ret\n  }\n  \n  return (\n    <>\n    <ListItem\n      button\n      component={Link}\n      to={`/${i18n.language}/route/${routeId}`}\n      className={classes.listItem}\n    >\n      <ListItemText \n        primary={routeNo} \n        className={classes.route}\n      />\n      {\n        stop ? <ListItemText \n          primary={t('往')+' '+dest[i18n.language]}\n          secondary={stop.name[i18n.language]} \n          className={classes.routeDest}\n        /> : <CircularProgress size={15} />\n      }\n      <ListItemText\n        primary={etas ? getEtaString(etas[0]) : ''}\n        secondary={etas ? getEtaString(etas[1]) : ''}\n        className={classes.routeEta}\n      />\n    </ListItem>\n    <Divider />\n    </>\n  )\n}\n\nexport default SuccinctTimeReport\n\nconst useStyles = makeStyles(theme => ({\n  listItem: {\n    padding: '4px 16px'\n  },\n  route: {\n    width: '15%'\n  },\n  routeDest: {\n    width: '65%'\n  },\n  routeEta: {\n    width: '20%'\n  }\n}))","import React, { useContext, useEffect, useState } from 'react'\nimport {\n  List,\n  Paper\n} from '@material-ui/core'\nimport { makeStyles } from '@material-ui/core/styles'\nimport AppContext from '../AppContext'\nimport { \n  fetchRouteStops as fetchRouteStopsViaApi,\n  fetchStopRoutes as fetchStopRoutesViaApi\n} from '../data-api'\nimport { getDistance } from '../utils'\nimport SuccinctTimeReport from './home/SuccinctTimeReport'\n\nconst Home = () => {\n  const { \n    hotRoute, savedEtas, geoPermission, geolocation, routeList, stopList,\n    setStopList, setRouteList\n  } = useContext ( AppContext )\n\n  const [selectedRoutes, setSelectedRoute] = useState(\n    savedEtas.concat(\n      Object.entries(hotRoute).filter(([route, count]) => count > 5)\n      .sort((a,b) => b[1] - a[1])\n      .map(([routeId]) => routeId)\n    ).filter((routeId, index, self) => self.indexOf(routeId) === index)\n    .slice(0,20)\n  )\n\n  useEffect (() => {\n    let isMounted = true\n    if ( geoPermission === 'granted') {\n      Object.entries(stopList).map(stop => \n        // potentially could be optimized by other distance function\n        stop.concat(getDistance(stop[1].location, geolocation))\n      ).filter(stop => \n        // keep only nearby 200m stops\n        stop[2] < 1000\n      ).sort((a, b) => \n        a[2] - b[2]\n      ).slice(0, 5).forEach(([stopId]) => {\n        // keep only max. 5 stops\n        // fetch route stops if not in database\n        fetchStopRoutesViaApi(stopId, routeList).then(routeLinks => \n          Promise.all(\n            routeLinks.map(routeLink => routeLink.split('/')).map(([routeId, seq]) => (\n              fetchRouteStopsViaApi(routeList[routeId]).then(stopDetails => [routeId, seq, stopDetails])\n            ))\n          ).then( arr => {\n            let _routeList = JSON.parse(JSON.stringify(routeList))\n            let _stopList = JSON.parse(JSON.stringify(stopList))\n            let isUpdated = false\n            arr.forEach(([routeId, seq, stopDetails]) => {\n              stopDetails.forEach( routeStopInfo => {\n                _routeList[routeId].stops[routeStopInfo.co] = routeStopInfo.routeStops\n                _stopList = {..._stopList, ...routeStopInfo.stopList}\n              })\n              isUpdated = true\n            })\n            if ( isUpdated ) {\n              setStopList(_stopList)\n              setRouteList(_routeList)\n            }\n            \n            // add nearby routes to display\n            if ( isMounted ) {\n              setSelectedRoute(prevSelectedRoutes => \n                prevSelectedRoutes.concat(routeLinks).filter( (v, i, s) => s.indexOf(v) === i ).slice(0,20)\n              )\n            }\n          })\n        )\n      })\n    }\n    return () => {\n      isMounted = false\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [geolocation])\n\n  const classes = useStyles()\n  return (\n    <Paper className={classes.root}>\n      <List className={classes.list}>\n      {\n        selectedRoutes.map( selectedRoute => (\n          <SuccinctTimeReport key={selectedRoute} routeId={selectedRoute} />\n         ) )\n      }\n      </List>\n    </Paper>\n  )\n}\n\nexport default Home\n\nconst useStyles = makeStyles ( theme => ({\n  root: {\n    background: 'white',\n    height: 'calc(100vh - 120px)',\n    overflowY: 'scroll'\n  }\n}))\n\n","import React, { useContext } from 'react'\nimport { \n  Box,\n  Button,\n  Grid\n} from '@material-ui/core'\nimport {\n  makeStyles\n} from '@material-ui/styles'\nimport BackspaceOutlinedIcon from '@material-ui/icons/BackspaceOutlined';\nimport AppContext from '../../AppContext'\nimport { useTranslation } from 'react-i18next';\n\nconst KeyButton = ({k, handleClick, disabled = false}) => {\n  const classes = useStyles()\n  const { t } = useTranslation()\n  return (\n    <Button \n      size=\"large\"\n      variant=\"contained\" \n      className={classes.button}\n      onClick={() => handleClick(k)}\n      disabled={disabled}\n    >\n      {k === 'b' ? <BackspaceOutlinedIcon/> : \n        k === '-' ? t('取消') : k}\n    </Button>\n  )\n}\n\nconst RouteNumPad = () => {\n  const { searchRoute, updateSearchRouteByButton, possibleChar } = useContext( AppContext )\n\n  return (\n    <Grid container spacing={0}>\n    {\n      '789456123-0b'.split('').map( k => (\n        <Grid item xs={4} key={'input-'+k}>\n          <KeyButton\n            k={k}\n            handleClick={updateSearchRouteByButton}\n            style={{fontSize: '0.6rem'}}\n            disabled={\n              (k === 'b' && searchRoute === '') \n              || ( !'b-'.includes(k) && !possibleChar.includes(k))\n              || ( k === '-' && searchRoute === '' )\n            }\n          />\n        </Grid>\n      ))\n    }\n    </Grid>\n  )\n}\n\nconst RouteAlphabetPad = () => {\n  const { updateSearchRouteByButton, possibleChar } = useContext( AppContext )\n  \n  return (\n    <Grid container spacing={1}>\n      {\n        possibleChar.filter(k => isNaN(k)).map(k => (\n          <Grid item xs={12} key={'input-'+k}>\n            <KeyButton\n              k={k}\n              handleClick={updateSearchRouteByButton}\n            />\n          </Grid>\n        )) \n      }\n    </Grid>\n  )\n}\n\nconst RouteInputPad = () => {\n\n  const classes = useStyles()\n  const padding = 0\n\n  return (\n    <Box className={classes.boxContainer} padding={padding}>\n      <Box className={classes.numPadContainer} padding={padding}>\n        <RouteNumPad />\n      </Box>\n      <Box className={classes.alphabetPadContainer} padding={padding}>\n        <RouteAlphabetPad />\n      </Box>\n    </Box>\n  )\n}\n\nexport default RouteInputPad\n\nconst useStyles = makeStyles(theme => ({\n  boxContainer: {\n    display: 'flex',\n    flexDirection: 'row',\n    height: '180px',\n    justifyContent: 'space-around'\n  },\n  numPadContainer: {\n    width: '60%',\n  },\n  alphabetPadContainer: {\n    width: '20%',\n    height: '100%',\n    overflowX: 'hidden',\n    overflowY: 'scroll'\n  },\n  button: {\n    width: '100%',\n    height: 42,\n    borderRadius: 'unset'\n  }\n}))","import React from 'react'\nimport {\n  Card,\n  CardActionArea,\n  CardContent,\n  Typography\n} from '@material-ui/core'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { useTranslation } from 'react-i18next'\nimport { areEqual } from 'react-window'\nimport { Link } from  'react-router-dom'\n\nconst RouteRow = React.memo(( {data, index, style} ) => {\n  const { t, i18n } = useTranslation()\n  const { routeList } = data\n  const route = routeList[index]\n  const [routeNo, service_type] = route[0].split('+').slice(0,2)\n  const classes = useStyles()\n\n  return (\n    <Link to={'/'+i18n.language+'/route/'+route[0]}>\n      <Card variant=\"outlined\" key={route[0]} style={style} square>\n        <CardActionArea>\n          <CardContent className={classes.cardContent}>\n            <Typography variant=\"h5\" display=\"inline\">{routeNo}</Typography>\n            <Typography variant=\"caption\"> - {route[1].co.map(co => t(co)).join('+')}</Typography>\n            <br/>\n            <Typography variant=\"subtitle2\" display=\"inline\">{t('往')} {route[1].dest[i18n.language]}  </Typography>\n            <Typography variant=\"caption\">{service_type >= 2 ? t('特別班次') : '　'}</Typography>\n          </CardContent>\n        </CardActionArea>\n      </Card>\n    </Link>\n  )\n}, areEqual)\n\nexport default RouteRow\n\nconst useStyles = makeStyles (theme => ({\n  cardContent: {\n    padding: '8px 16px',\n  }\n}))","import React, { useContext } from 'react'\nimport AppContext from '../AppContext'\nimport { FixedSizeList } from 'react-window'\nimport memorize from 'memoize-one'\nimport RouteInputPad from './route-board/RouteInputPad'\nimport RouteRow from './route-board/RouteRow'\n\nconst createItemData = memorize((routeList) => ({routeList}))\n\nconst RouteList = () => {\n  const { routeList, searchRoute } = useContext(AppContext)\n  const targetRouteList = Object.entries(routeList).filter(\n    element => element[0].startsWith(searchRoute.toUpperCase())\n  ) \n\n  const itemData = createItemData(targetRouteList)\n  return (\n    <FixedSizeList\n      height={330}\n      itemCount={targetRouteList.length}\n      itemSize={69}\n      width=\"100%\"\n      itemData={itemData}\n    >\n        {RouteRow}\n    </FixedSizeList>\n  )\n}\n\nconst RouteBoard = () => {\n  return (\n    <>\n      <RouteList />\n      <hr/>\n      <RouteInputPad />\n    </>\n  )\n}\n\nexport default RouteBoard","import { useContext, useEffect, useState } from 'react'\nimport { MapContainer, TileLayer, Marker, Polyline, Circle, useMap } from 'react-leaflet'\nimport { Box } from '@material-ui/core'\nimport { makeStyles } from '@material-ui/core/styles'\nimport AppContext from '../../AppContext'\nimport MyLocationIcon from '@material-ui/icons/MyLocation';\n\nconst ChangeMapCenter = ( {center, zoom} ) => {\n  const map = useMap()\n  map.flyTo(checkPosition(center))\n  return <></>\n}\n\nconst CenterControl = ( {onClick}) => {\n  const classes = useStyles()\n  return (\n    <div className='leaflet-bottom leaflet-right'>\n      <div \n        className={`${classes.centerControlContainer} leaflet-control leaflet-bar`}\n        onClick={onClick}\n      >\n        <MyLocationIcon className={classes.centerControl} />\n      </div>\n    </div>\n  )\n}\n\nconst RouteMap = ({stops, stopList, stopIdx, onMarkerClick}) => {\n  const { geolocation, geoPermission } = useContext ( AppContext )\n  const classes = useStyles()\n  const [center, setCenter] = useState(stopList[stops[stopIdx]] ? stopList[stops[stopIdx]].location : {})\n  \n  useEffect ( () => {\n    setCenter(stopList[stops[stopIdx]] ? stopList[stops[stopIdx]].location : {})\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [stopIdx])\n\n  return (\n    <Box className={`${classes.mapContainer}`}>\n      <MapContainer center={checkPosition(center)} zoom={16} scrollWheelZoom={false} className={classes.mapContainer}>\n        <ChangeMapCenter center={checkPosition(center)} zoom={16} />\n        <TileLayer\n          attribution='&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors &copy; <a href=\"https://carto.com/attributions\">CARTO</a>'\n          url=\"https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png\"\n        />\n        {\n          // plot stops\n          stops.map((stopId, idx, self) => \n              <Marker \n                key={stopId} \n                position={stopList[stopId].location} \n                eventHandlers={{\n                  click: (e) => {onMarkerClick(idx)(e, true, true)}\n                }}\n              />\n          )\n        }\n        {\n          // plot line\n          stops.slice(1).map((stopId, idx) => \n            <Polyline \n              key={`${stopId}-line`}\n              positions={[\n                getPoint(stopList[stops[idx]].location),\n                getPoint(stopList[stopId].location)\n              ]}\n              color={'#e55074'}\n            />\n          )\n        }\n        { geoPermission !== 'granted' ? <></>:<Circle \n          center={checkPosition(geolocation)}\n          radius={25}\n        />}\n        <CenterControl \n          onClick={() => setCenter(geolocation)}\n        />\n      </MapContainer>\n    </Box>\n  )\n}\n\nexport default RouteMap\n\n// HK location if no valid value\nconst checkPosition = (position) => {\n  if ( position \n    && typeof position.lat === 'number' && isFinite(position.lat)\n    && typeof position.lng === 'number' && isFinite(position.lng) \n  )\n    return position\n  return {lat: 22.302711, lng: 114.177216}\n}\n\nconst getPoint = ({lat, lng}) => [lat, lng]\n\nconst useStyles = makeStyles ( theme => ({\n  mapContainer: {\n    height: '30vh',\n    '& .leaflet-marker-pane': {\n      filter: 'hue-rotate(130deg)' // tricky color change to marker\n    }\n  },\n  centerControl: {\n    padding: '5px',\n  },\n  centerControlContainer: {\n    background: 'white',\n    height: '28px',\n    marginBottom: '20px !important',\n    marginRight: '5px !important'\n  }\n}) )","import React, { useState, useEffect } from 'react'\nimport {\n  CircularProgress,\n  Typography\n} from '@material-ui/core'\nimport { useTranslation } from 'react-i18next'\nimport { \n  fetchEtas as fetchEtasViaApi \n} from '../../data-api'\n\nconst TimeReport = ( { route, routeStops, seq, bound, serviceType, co } ) => {\n  const { t, i18n } = useTranslation()\n  const [ etas, setEtas ] = useState(null)\n\n  useEffect( () => {\n    let isMounted = true\n    const fetchData = () => {\n      fetchEtasViaApi({route, routeStops, seq, bound, serviceType, co}).then(_etas => {\n        if (isMounted) setEtas(_etas)\n      })\n    }\n    fetchData()\n    const fetchEtaInterval = setInterval(() => {\n      fetchData()\n    }, 30000)\n\n    return () => {\n      isMounted = false\n      clearInterval(fetchEtaInterval)\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  if ( etas == null ) {\n    return (\n      <CircularProgress size={20} style={{}} />\n    )\n  }\n\n  const displayMsg = (eta) => {\n    let ret = ''\n    switch (eta) {\n      case null: \n        break\n      case 0: \n        ret = '- '+t('分鐘')\n        break\n      default:\n        ret = eta + \" \" + t('分鐘')\n        break\n    }\n    return ret\n  }\n  \n  return (\n    <div>\n      {\n        etas.length === 0 ? t('暫無班次') : (\n          etas.map((eta, idx) => (\n            <Typography variant=\"subtitle1\" key={`route-${idx}`}>\n              {displayMsg(eta.eta)} - { eta.remark[i18n.language] ? eta.remark[i18n.language] : '' } {t(eta.co)}\n            </Typography>\n          ))\n        )\n      }\n    </div>\n  )\n}\n\nexport default TimeReport","import React, { useState, useEffect, useContext, useRef } from 'react'\nimport { useParams, useHistory } from 'react-router-dom'\nimport RouteMap from './route-eta/RouteMap'\nimport {\n  Accordion as MuiAccordion,\n  AccordionSummary as MuiAccordionSummary, \n  AccordionDetails as MuiAccordionDetails,\n  Box, \n  CircularProgress,\n  IconButton, \n  Typography\n} from '@material-ui/core'\nimport StarIcon from '@material-ui/icons/Star';\nimport StarBorderIcon from '@material-ui/icons/StarBorder';\nimport { makeStyles, withStyles } from '@material-ui/core/styles'\nimport AppContext from '../AppContext'\nimport { useTranslation } from 'react-i18next'\nimport { \n  fetchRouteStops as fetchRouteStopsViaApi\n} from '../data-api'\nimport { getDistance } from '../utils'\nimport TimeReport from './route-eta/TimeReport'\n\nconst RouteEta = () => {\n  const { id, panel } = useParams()\n  const [ expanded, setExpanded ] = useState(parseInt(panel))\n  const { \n    routeList, stopList, savedEtas, geoPermission, geolocation,\n    updateNewlyFetchedRouteStops, updateSelectedRoute, updateSavedEtas\n  } = useContext ( AppContext )\n\n  const { route, serviceType, bound, stops, co, dest } = routeList[id]\n  const { t, i18n } = useTranslation()\n  const history = useHistory()\n  const accordionRef = useRef([])\n\n  const handleChange = ( panel ) => (event, newExpanded, isFromMap) => {\n    setExpanded(newExpanded ? panel : false)\n    if ( newExpanded ) {\n      history.replace(`/${i18n.language}/route/${id}/${panel}`)\n      updateSelectedRoute( id, panel )\n      if ( isFromMap ) {\n        accordionRef.current[parseInt(panel)].scrollIntoView({behavior: 'smooth', block: 'start'})\n      }\n      return\n    }\n  }\n\n  const autoSetPanel = () => {\n    if ( parseInt(panel) && accordionRef.current[parseInt(panel)] ) {\n      setExpanded(parseInt(panel))\n      accordionRef.current[parseInt(panel)].scrollIntoView({behavior: 'smooth', block: 'start'})\n    } else if ( geoPermission && stops[co[0]] ) {\n      const nearbyStop = stops[co[0]]\n        .map((stopId, idx) => [stopId, idx, getDistance(geolocation, stopList[stopId].location)])\n        .filter( ([stopId, idx, dist]) => dist < 1000 )\n        .sort((a,b) => a[2] - b[2])[0]\n      if ( nearbyStop ) {\n        const idx = nearbyStop[1]\n        setExpanded(idx) \n        accordionRef.current[idx].scrollIntoView({behavior: 'smooth', block: 'start'})\n      }\n    }\n  }\n\n  useEffect(() => {\n    autoSetPanel()\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [routeList])\n\n  useEffect(() => {\n    updateSelectedRoute( id )\n\n    // fetch stops\n    fetchRouteStopsViaApi({route, bound, stops}).then( objs => \n      updateNewlyFetchedRouteStops(id, objs)\n    )\n\n    autoSetPanel()\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  const classes = useStyles()\n\n  if ( stops[co[0]] == null ) {\n    return (\n      <Box className={classes.loadingContainer}>\n        <CircularProgress size={30} />\n      </Box>\n    )\n  }\n\n  const toggleSavedRoute = (key) => updateSavedEtas(key)\n\n  return (\n    <>\n      <Typography variant=\"subtitle1\" align='center'>\n        {route}\n      </Typography>\n      <Typography variant=\"caption\" align='center'>\n        {t('往')} {dest[i18n.language]}\n      </Typography>\n      <RouteMap \n        stops={stops[co[0]]}\n        stopList={stopList}\n        stopIdx={expanded}\n        onMarkerClick={handleChange}\n      />\n      <Box className={classes.boxContainer}>\n        {\n          stops[co[0]].map((stop, idx) => (\n            <Accordion \n              key={'stop-'+idx} \n              expanded={expanded === idx}\n              onChange={handleChange(idx)}\n              TransitionProps={{unmountOnExit: true}}\n              ref={el => {accordionRef.current[idx] = el}}\n            >\n              <AccordionSummary>{stopList[stop].name[i18n.language]}</AccordionSummary>\n              <AccordionDetails>\n                <TimeReport \n                  route={route}\n                  seq={idx + 1}\n                  routeStops={stops}\n                  serviceType={serviceType}\n                  bound={bound}\n                  co={co}\n                />\n                <IconButton aria-label=\"favourite\" onClick={() => toggleSavedRoute(`${id}/${panel}`)}>\n                  {savedEtas.includes(`${id}/${panel}`) ? <StarIcon/> : <StarBorderIcon />}\n                </IconButton>\n              </AccordionDetails>\n            </Accordion>\n          ))\n        }\n      </Box>\n    </>\n  )\n}\n\nexport default RouteEta\n\nconst Accordion = withStyles({\n  root: {\n    border: '1px solid rgba(0, 0, 0, .125)',\n    boxShadow: 'none',\n    '&:not(:last-child)': {\n      borderBottom: 0,\n    },\n    '&:before': {\n      display: 'none',\n    },\n    '&$expanded': {\n      margin: 'auto',\n    },\n  },\n  expanded: {},\n})(MuiAccordion)\n\nconst AccordionSummary = withStyles({\n  root: {\n    backgroundColor: 'rgba(0, 0, 0, .03)',\n    borderBottom: '1px solid rgba(0, 0, 0, .125)',\n    marginBottom: -1,\n    minHeight: 56,\n    '&$expanded': {\n      minHeight: 56,\n    },\n  },\n  content: {\n    '&$expanded': {\n      margin: '12px 0',\n    },\n  },\n  expanded: {},\n})(MuiAccordionSummary);\n\nconst AccordionDetails = withStyles((theme) => ({\n  root: {\n    padding: theme.spacing(2),\n    justifyContent: 'space-between'\n  },\n}))(MuiAccordionDetails);\n\nconst useStyles = makeStyles(theme => ({\n  boxContainer: {\n    overflowY: 'scroll'\n  },\n  loadingContainer: {\n    display: 'flex',\n    justifyContent: 'center'\n  }\n}))","import React, { useContext, useEffect, useState } from 'react'\nimport AppContext from '../AppContext'\nimport {\n  Avatar,\n  Divider,\n  List,\n  ListItem,\n  ListItemAvatar,\n  ListItemText,\n  Paper,\n  Snackbar\n} from '@material-ui/core'\nimport { makeStyles } from '@material-ui/core/styles'\nimport BuildIcon from '@material-ui/icons/Build'\nimport LocationOnIcon from '@material-ui/icons/LocationOn'\nimport LocationOffIcon from '@material-ui/icons/LocationOff'\nimport { useTranslation } from 'react-i18next'\nimport MonetizationOnIcon from '@material-ui/icons/MonetizationOn'\nimport DataUsageIcon from '@material-ui/icons/DataUsage'\nimport DeleteIcon from '@material-ui/icons/Delete';\nimport moment from 'moment'\n\nconst Settings = () => {\n  const { \n    schemaVersion, updateTime, geoPermission, \n    updateGeoPermission, renewDb, resetUsageRecord\n  } = useContext ( AppContext )\n  const [ updating, setUpdating ] = useState(false)\n\n  const { t, i18n } = useTranslation()\n  const classes = useStyles()\n\n  useEffect(() => {\n    setUpdating(false)\n  }, [updateTime])\n\n  return (\n    <Paper className={classes.root}>\n      <List>\n        <ListItem\n          button\n          onClick={() => {setUpdating(true);renewDb()}}\n        >\n          <ListItemAvatar>\n            <Avatar><BuildIcon /></Avatar>\n          </ListItemAvatar>\n          <ListItemText \n            primary={t(\"架構版本\")+\": \"+schemaVersion} \n            secondary={t('更新時間：') + \" \" + moment(updateTime).format('YYYY-MM-DD HH:mm:ss')} \n          />\n        </ListItem>\n        <ListItem\n          button\n          onClick={() => {\n            if ( geoPermission === 'granted' ) {\n              updateGeoPermission('closed')\n            } else {\n              navigator.geolocation.getCurrentPosition(position => {\n                updateGeoPermission('granted')\n              })\n            }\n          }}\n        >\n          <ListItemAvatar>\n            <Avatar>{geoPermission === 'granted' ? <LocationOnIcon /> : <LocationOffIcon />}</Avatar>\n          </ListItemAvatar>\n          <ListItemText \n            primary={t(\"地理位置定位功能\")} \n            secondary={t(geoPermission === 'granted' ? '開啟' : '關閉') } \n          />\n        </ListItem>\n        <ListItem\n          button\n          onClick={() => {resetUsageRecord()}}\n        >\n          <ListItemAvatar>\n            <Avatar><DeleteIcon /></Avatar>\n          </ListItemAvatar>\n          <ListItemText \n            primary={t(\"一鍵清空用戶紀錄\")} \n            secondary={t(\"包括鎖定和常用報時\")}\n          />\n        </ListItem>\n        <Divider />\n        <ListItem\n          button\n          component='a'\n          href={`https://donate.612fund.hk/${i18n.language}/`}\n          target=\"_blank\"\n        >\n          <ListItemAvatar>\n            <Avatar><MonetizationOnIcon /></Avatar>\n          </ListItemAvatar>\n          <ListItemText \n            primary={t(\"捐款支持\")} \n            secondary={t('請捐款到 612 人道支援基金') } \n          />\n        </ListItem>\n        <Divider />\n        <ListItem>\n          <ListItemAvatar>\n            <Avatar><DataUsageIcon /></Avatar>\n          </ListItemAvatar>\n          <ListItemText \n            primary={t(\"資料來源\")} \n            secondary={t('資料一線通') + \"  https://data.gov.hk\" } \n          />\n        </ListItem>\n      </List>\n      <Snackbar\n        anchorOrigin={{vertical: 'bottom', horizontal: 'center'}}\n        open={updating}\n        message={t('資料更新中')+'...'}\n      />\n    </Paper>\n  )\n}\n\nexport default Settings\n\nconst useStyles = makeStyles ( theme => ({\n  root: {\n    background: 'white',\n    height: 'calc(100vh - 120px)'\n  }\n}))","import React, { useContext } from 'react'\nimport {\n  BottomNavigation,\n  BottomNavigationAction\n} from '@material-ui/core'\nimport HomeIcon from '@material-ui/icons/Home'\nimport SearchIcon from '@material-ui/icons/Search'\nimport TimerIcon from '@material-ui/icons/Timer'\nimport SettingsIcon from '@material-ui/icons/Settings';\nimport { Link, useLocation } from 'react-router-dom'\nimport { useTranslation } from 'react-i18next'\nimport AppContext from '../../AppContext'\n\nconst Footer = () => {\n  const { t, i18n } = useTranslation()\n  const location = useLocation()\n  const { selectedRoute } = useContext ( AppContext ) \n  \n  return (\n    <BottomNavigation\n      value={location.pathname}\n      showLabels={true}\n    >\n      <BottomNavigationAction\n        label={t(\"常用\")}\n        component={Link}\n        to={`/${i18n.language}`}\n        value={`/${i18n.language}`}\n        icon={<HomeIcon />}\n      />\n      <BottomNavigationAction \n        label={t(\"搜尋\")}\n        component={Link}\n        to={`/${i18n.language}/search`}\n        value={`/${i18n.language}/search`}\n        icon={<SearchIcon />} \n      />\n      <BottomNavigationAction\n       label={selectedRoute.split('+')[0]}\n       component={Link}\n       to={`/${i18n.language}/route/${selectedRoute}`}\n       value={`/${i18n.language}/route/${selectedRoute}`}\n       icon={<TimerIcon />} \n      />\n      <BottomNavigationAction\n       label={t(\"設定\")}\n       component={Link}\n       to={`/${i18n.language}/settings`}\n       value={`/${i18n.language}/settings`}\n       icon={<SettingsIcon />} \n      />\n    </BottomNavigation>\n  )\n}\n\nexport default Footer","import './App.css'\nimport { MuiThemeProvider, createMuiTheme } from '@material-ui/core/styles'\nimport React, { useContext } from 'react'\nimport {\n  HashRouter as Router,\n  Redirect,\n  Switch,\n  Route,\n  useRouteMatch\n} from \"react-router-dom\";\nimport {\n  CircularProgress,\n  Container,\n  CssBaseline,\n  Paper,\n  Typography\n} from '@material-ui/core'\nimport {\n  makeStyles\n} from '@material-ui/core/styles'\nimport { useTranslation } from 'react-i18next'\nimport Header from './components/layout/Header'\nimport Home from './components/Home'\nimport RouteBoard from './components/RouteBoard'\nimport RouteEta from './components/RouteEta'\nimport Settings from './components/Settings'\nimport AppContext from './AppContext'\nimport Footer from './components/layout/Footer'\nimport Countdown from 'react-countdown'\n\nconst PageSwitch = () => {\n  const { path } = useRouteMatch()\n  return (\n    <Switch>\n      <Route path={`${path}/route/:id/:panel?`}>\n        <RouteEta />\n      </Route>\n      <Route path={`${path}/settings`}>\n        <Settings />\n      </Route>      \n      <Route path={`${path}/search`}>\n        <RouteBoard />\n      </Route>\n      <Route path={`${path}`}>\n        <Home />\n      </Route>\n    </Switch>\n  )\n}\n\nconst App = () => { \n  const { routeList, stopList } = useContext( AppContext )\n  const { t } = useTranslation()\n  const classes = useStyles()\n\n  if ( routeList == null || stopList == null ) {\n    return (\n      <Container maxWidth='xs' disableGutters className={classes.loadingContainer}>\n        <CircularProgress size={40} />\n        <br />\n        <br />\n        <Paper className={classes.loadingTextContainer} elevation={0}>\n          <Countdown \n            date={Date.now() + 20000}\n            renderer={({seconds, completed}) => {\n              if ( completed ) {\n                return <Typography variant=\"subtitle2\" align=\"center\">{t('介面開啟中')}...</Typography>\n              } else {\n                return (\n                  <>\n                    <Typography variant=\"subtitle2\" align=\"center\">{t('初始設定')}...</Typography>\n                    <Typography variant=\"subtitle2\" align=\"center\">{t('正在更新巴士路線資料')}...</Typography>\n                    <Typography variant=\"subtitle2\" align=\"center\">{t('約需')}{seconds}{t('秒')}</Typography>\n                  </>\n                )\n              }\n            }}\n          />\n            \n        </Paper>\n      </Container>\n    )\n  } \n\n  return (\n    <MuiThemeProvider theme={Theme}>\n      <Container maxWidth='xs' disableGutters className={classes.container}>\n        <Router>\n          <Route exact path=\"/\">\n            <Redirect to=\"/zh/\" />\n          </Route>\n          <Route path=\"/:lang\">\n            <CssBaseline />\n            <Header />\n            <PageSwitch />\n            <Footer />\n          </Route>\n        </Router>\n      </Container>\n    </MuiThemeProvider>\n  );\n}\n\nexport default App;\n\nconst Theme = createMuiTheme({\n  typography: {\n    fontFamily: \"Noto Sans TC, Chivo, sans-serif\"\n  },\n  palette: {\n    background: {\n      default: \"#ffff00\" // yellow\n    }\n  }\n})\n\nconst useStyles = makeStyles( theme => ({\n  container: {\n    display: 'flex',\n    flexDirection: 'column',\n    justifyContent: 'space-between',\n    height: '100vh'\n  },\n  loadingContainer: {\n    display: 'flex',\n    flexDirection: 'column',\n    justifyContent: 'center',\n    alignItems: 'center',\n    height: '100vh'\n  },\n  loadingText: {\n\n  }\n}))\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import i18n from \"i18next\";\nimport { initReactI18next } from \"react-i18next\";\nimport resources from \"./i18n/translation.json\";\n\nconst DEFAULT_LANG = window.location.pathname.substr(1,2) === 'en' ? 'en' : 'zh'\n\ni18n\n  .use(initReactI18next)\n  .init({\n    resources,\n    whitelist: ['en', 'zh'],\n    lowerCaseLng: true,\n    lng: DEFAULT_LANG,\n    nsSeparator: false,\n    keySeparator: false,\n    debug: false,\n\n    interpolation:{\n      escapeValue: false\n    }\n  });\n\nexport default i18n;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\nimport { AppContextProvider } from './AppContext'\nimport './i18n'\n\nReactDOM.render(\n  //<React.StrictMode>\n    <AppContextProvider>\n      <App />\n    </AppContextProvider>\n  //</React.StrictMode>,\n  ,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}