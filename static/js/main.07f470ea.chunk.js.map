{"version":3,"sources":["data-api/Kmb.js","data-api/Nwfb.js","data-api/Ctb.js","data-api/index.js","AppContext.js","components/Header.js","components/RouteInputPad.js","components/RouteBoard.js","components/RouteEta.js","Footer.js","App.js","reportWebVitals.js","i18n.js","index.js"],"names":["KmbApi","co","fetchRouteList","fetch","then","response","json","data","routeList","forEach","element","route","service_type","bound","join","orig","en","orig_en","zh","orig_tc","dest","dest_en","dest_tc","stops","kmb","generated_timestamp","push","stop","fetchStopList","stopList","name","name_en","name_tc","location","lat","long","fetchEtas","stopId","seq","serviceType","cache","filter","e","dir","map","eta","Math","round","moment","diff","remark","rmk_tc","rmk_en","NwfbApi","nwfb","fetchRouteStops","routeStops","Promise","all","rmk","CtbApi","ctb","console","log","a","routeSize","_etas","company_id","concat","sort","b","Number","isInteger","api","error","AppContext","React","createContext","AppContextProvider","props","useState","localStorage","getItem","version","setVersion","setRouteList","setStopList","searchRoute","setSearchRoute","selectedRoute","setSelectedRoute","possibleChar","setPossibleChar","useEffect","sha","clear","setItem","_routeList","JSON","parse","getPossibleChar","_stopList","Provider","value","updateSearchRouteByButton","buttonValue","slice","children","subtract","format","_generated_timestamp","Object","entries","toUpperCase","includes","stringify","startsWith","length","k","useStyles","makeStyles","theme","tabsContainer","display","breakpoints","down","flexDirection","toolbar","justifyContent","zIndex","drawer","LanguageTabs","withStyles","root","borderBottom","minHeight","indicator","backgroundColor","Tabs","LanguageTab","textTransform","minWidth","fontWeight","marginRight","spacing","fontSize","opacity","padding","selected","color","wrapper","borderRadius","Tab","disableRipple","Header","useContext","path","useRouteMatch","useTranslation","t","i18n","classes","useLocation","history","useHistory","Toolbar","className","Typography","variant","Input","type","placeholder","onChange","target","disabled","language","v","lang","replace","pathname","changeLanguage","label","KeyButton","handleClick","Button","size","button","onClick","RouteNumPad","Grid","container","split","item","xs","RouteAlphabetPad","isNaN","RouteInputPad","Box","boxContainer","numPadContainer","alphabetPadContainer","height","width","overflowX","overflowY","RouteRow","memo","index","style","routeNo","to","Card","square","CardActionArea","CardContent","cardContent","areEqual","createItemData","memorize","RouteList","targetRouteList","itemData","itemCount","itemSize","RouteBoard","RouteEta","useParams","id","panel","expanded","setExpanded","accordionRef","useRef","routeObj","handleChange","event","newExpanded","fetchRouteStopsViaApi","objs","obj","prevRouteList","parseInt","current","scrollIntoView","behavior","block","loadingContainer","CircularProgress","idx","TransitionProps","unmountOnExit","ref","el","TimeReport","etas","setEtas","fetchEtasViaApi","fetchData","fetchEtaInterval","setInterval","clearInterval","displayMsg","ret","Accordion","border","boxShadow","margin","MuiAccordion","AccordionSummary","marginBottom","content","MuiAccordionSummary","AccordionDetails","MuiAccordionDetails","Footer","BottomNavigation","showLabels","BottomNavigationAction","component","Link","icon","PageSwitch","App","Container","maxWidth","disableGutters","Paper","loadingTextContainer","elevation","date","Date","now","renderer","seconds","completed","align","Theme","exact","CssBaseline","createMuiTheme","typography","fontFamily","palette","background","default","alignItems","loadingText","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","DEFAULT_LANG","window","substr","use","initReactI18next","init","resources","whitelist","lowerCaseLng","lng","nsSeparator","keySeparator","debug","interpolation","escapeValue","ReactDOM","render","document","getElementById"],"mappings":"qcAwFeA,EAtFA,CACbC,GAAI,MACJC,eAAgB,kBAEdC,MACE,sDACAC,MAAK,SAAAC,GAAQ,OAAIA,EAASC,UAC3BF,MAAM,YAAa,IAAXG,EAAU,EAAVA,KACHC,EAAY,GAiBhB,OAhBAD,EAAKE,SAAQ,SAAAC,GACXF,EAAU,CAACE,EAAQC,MAAOD,EAAQE,aAAcF,EAAQG,OAAOC,KAAK,MAAQ,CAC1Eb,GAAI,CAAC,OACLc,KAAM,CACJC,GAAIN,EAAQO,QACZC,GAAIR,EAAQS,SAEdC,KAAM,CACJJ,GAAIN,EAAQW,QACZH,GAAIR,EAAQY,SAEdC,MAAO,CACLC,IAAK,QAIJhB,KACNJ,MAAM,SAAAI,GAAS,OAEhBL,MAAM,2DAA2DC,MAAK,SAAAC,GAAQ,OAAIA,EAASC,UAC1FF,MAAK,YAAkC,IAAhCG,EAA+B,EAA/BA,KAAMkB,EAAyB,EAAzBA,oBAMZ,OALAlB,EAAKE,SAAQ,SAAAC,GACXF,EAAU,CAACE,EAAQC,MAAOD,EAAQE,aAAcF,EAAQG,OAAOC,KAAK,MAAMS,MAAMC,IAAIE,KAClFhB,EAAQiB,SAGL,CAACnB,EAAWiB,UAIzBG,cAAe,WACb,OAAOzB,MAAM,oDAAoDC,MAC/D,SAAAC,GAAQ,OAAIA,EAASC,UACrBF,MAAK,YAAkC,IAAhCG,EAA+B,EAA/BA,KAAMkB,EAAyB,EAAzBA,oBACTI,EAAW,GAaf,OAZAtB,EAAKE,SAAQ,SAAAC,GACXmB,EAASnB,EAAQiB,MAAQ,CACvBG,KAAM,CACJd,GAAIN,EAAQqB,QACZb,GAAIR,EAAQsB,SAEdC,SAAU,CACRC,IAAKxB,EAAQwB,IACbC,KAAMzB,EAAQyB,UAIb,CAACN,EAAUJ,OAatBW,UAAW,YAA+C,IAA7CC,EAA4C,EAA5CA,OAAQ1B,EAAoC,EAApCA,MAAO2B,EAA6B,EAA7BA,IAAKC,EAAwB,EAAxBA,YAAa1B,EAAW,EAAXA,MAC5C,OAAOV,MAAM,mDAAD,OACyCkC,EADzC,YACmD1B,EADnD,YAC4D4B,GACtE,CAAEC,MAAO,aACTpC,MAAM,SAAAC,GAAQ,OAAIA,EAASC,UAC5BF,MAAK,qBAAEG,KAAekC,QAAO,SAAAC,GAAC,OAAIA,EAAEC,MAAQ9B,GAAS6B,EAAEJ,MAAQA,KAAKM,KAAI,SAAAF,GAAC,MAAK,CAC3EG,IAAKH,EAAEG,IAAMC,KAAKC,MAAMC,IAAON,EAAEG,KAAKI,KAAKD,OAAY,GAAK,KAAQN,EAAEG,IACtEK,OAAQ,CACNhC,GAAIwB,EAAES,OACNnC,GAAI0B,EAAEU,QAERnD,GAAI,eCUGoD,EA1FC,CACdpD,GAAI,OACJC,eAAgB,kBACdC,MAAM,+DACHC,MAAK,SAAAC,GAAQ,OAAIA,EAASC,UAC1BF,MAAK,YAAkC,IAAhCG,EAA+B,EAA/BA,KAAMkB,EAAyB,EAAzBA,oBACRjB,EAAY,GAgChB,OA/BAD,EAAKE,SAAQ,SAAAC,GAEXF,EAAU,CAACE,EAAQC,MAAM,IAAI,KAAKG,KAAK,MAAQ,CAC7CC,KAAM,CACJC,GAAIN,EAAQO,QACZC,GAAIR,EAAQS,SAEdC,KAAM,CACJJ,GAAIN,EAAQW,QACZH,GAAIR,EAAQY,SAEdrB,GAAI,CAAC,QACLsB,MAAO,CACL+B,KAAM,OAGV9C,EAAU,CAACE,EAAQC,MAAM,IAAI,KAAKG,KAAK,MAAQ,CAC7CM,KAAM,CACJJ,GAAIN,EAAQO,QACZC,GAAIR,EAAQS,SAEdJ,KAAM,CACJC,GAAIN,EAAQW,QACZH,GAAIR,EAAQY,SAEdrB,GAAI,CAAC,QACLsB,MAAO,CACL+B,KAAM,UAIL,CAAC9C,EAAWiB,OAGzB8B,gBAAiB,YAAgC,IAA9B5C,EAA6B,EAA7BA,MAAOE,EAAsB,EAAtBA,MAGlB8B,GAHwC,EAAfnC,UAGT,MAAVK,EAAgB,WAAa,WACzC,OAAOV,MAAM,oEAAD,OAC0DQ,EAD1D,YACmEgC,IAC7EvC,MAAM,SAAAC,GAAQ,OACdA,EAASC,UACTF,MAAM,qBAAEG,KACHqC,KAAI,SAAAF,GAAC,OAAIA,EAAEf,WAChBvB,MAAM,SAAAoD,GAEN,OAAOC,QAAQC,IAAIF,EAAWZ,KAAI,SAAAP,GAAM,OACpClC,MAAM,yDAAD,OAA0DkC,IAAUjC,MACvE,SAAAC,GAAQ,OAAIA,EAASC,UACrBF,MAAO,gBAAEG,EAAF,EAAEA,KAAF,MAAa,CACpB8B,OAAQA,EACRP,KAAM,CACJZ,GAAIX,EAAKyB,QACThB,GAAIT,EAAKwB,SAEXE,SAAU,CACRC,IAAK3B,EAAK2B,IACVC,KAAM5B,EAAK4B,cAGd/B,MAAM,SAAAmB,GACP,IAAIM,EAAW,GAEf,OADAN,EAAMd,SAAQ,SAAAkB,GAAI,OAAIE,EAASF,EAAKU,QAAUV,KACvC,CAAC6B,aAAY3B,WAAU5B,GAAI,eAI1CmC,UAAW,YAA8B,IAA5BC,EAA2B,EAA3BA,OAAQ1B,EAAmB,EAAnBA,MAAOE,EAAY,EAAZA,MAE1B,OAAOV,MAAM,2DAAD,OAA4DkC,EAA5D,iBAAmF,CAAEG,MAAO,aAAcpC,MACpH,SAAAC,GAAQ,OAAIA,EAASC,UACrBF,MAAK,qBAAEG,KAAekC,QAAO,SAAAI,GAAG,OAAIA,EAAIlC,QAAUA,GAASkC,EAAIF,MAAQ9B,GAASgC,EAAIA,OAAKD,KAAI,SAAAF,GAAC,MAAK,CACjGG,IAAKH,EAAEG,IAAMC,KAAKC,MAAMC,IAAON,EAAEG,KAAKI,KAAKD,OAAY,GAAK,KAAQN,EAAEG,IACtEK,OAAQ,CACNhC,GAAIwB,EAAEiB,IACN3C,GAAI0B,EAAEiB,KAER1D,GAAI,gBCOG2D,EA3FA,CACb3D,GAAI,MACJC,eAAgB,kBACdC,MAAM,8DACHC,MAAK,SAAAC,GAAQ,OAAIA,EAASC,UAC1BF,MAAK,YAAkC,IAAhCG,EAA+B,EAA/BA,KAAMkB,EAAyB,EAAzBA,oBACRjB,EAAY,GAgChB,OA/BAD,EAAKE,SAAQ,SAAAC,GAEXF,EAAU,CAACE,EAAQC,MAAM,IAAI,KAAKG,KAAK,MAAQ,CAC7CC,KAAM,CACJC,GAAIN,EAAQO,QACZC,GAAIR,EAAQS,SAEdC,KAAM,CACJJ,GAAIN,EAAQW,QACZH,GAAIR,EAAQY,SAEdrB,GAAI,CAAC,OACLsB,MAAO,CACLsC,IAAK,OAGTrD,EAAU,CAACE,EAAQC,MAAM,IAAI,KAAKG,KAAK,MAAQ,CAC7CM,KAAM,CACJJ,GAAIN,EAAQO,QACZC,GAAIR,EAAQS,SAEdJ,KAAM,CACJC,GAAIN,EAAQW,QACZH,GAAIR,EAAQY,SAEdrB,GAAI,CAAC,OACLsB,MAAO,CACLsC,IAAK,UAIJ,CAACrD,EAAWiB,OAGzB8B,gBAAiB,YAAgC,IAA9B5C,EAA6B,EAA7BA,MAAOE,EAAsB,EAAtBA,MAGlB8B,GAHwC,EAAfnC,UAGT,MAAVK,EAAgB,WAAa,WACzC,OAAOV,MAAM,mEAAD,OACyDQ,EADzD,YACkEgC,IAC5EvC,MAAM,SAAAC,GAAQ,OACdA,EAASC,UACTF,MAAM,qBAAEG,KACHqC,KAAI,SAAAF,GAAC,OAAIA,EAAEf,WAChBvB,MAAM,SAAAoD,GAEN,OAAOC,QAAQC,IAAIF,EAAWZ,KAAI,SAAAP,GAAM,OACpClC,MAAM,yDAAD,OAA0DkC,IAAUjC,MACvE,SAAAC,GAAQ,OAAIA,EAASC,UACrBF,MAAO,gBAAEG,EAAF,EAAEA,KAAF,MAAa,CACpB8B,OAAQA,EACRP,KAAM,CACJZ,GAAIX,EAAKyB,QACThB,GAAIT,EAAKwB,SAEXE,SAAU,CACRC,IAAK3B,EAAK2B,IACVC,KAAM5B,EAAK4B,cAGd/B,MAAM,SAAAmB,GACP,IAAIM,EAAW,GAGf,OAFAN,EAAMd,SAAQ,SAAAkB,GAAI,OAAIE,EAASF,EAAKU,QAAUV,KAC9CmC,QAAQC,IAAIlC,GACL,CAAC2B,aAAY3B,WAAU5B,GAAI,cAK1CmC,UAAW,YAA8B,IAA5BC,EAA2B,EAA3BA,OAAQ1B,EAAmB,EAAnBA,MAAOE,EAAY,EAAZA,MAC1B,OAAOV,MAAM,0DAAD,OAA2DkC,EAA3D,iBAAkF,CAAEG,MAAO,aAAcpC,MACnH,SAAAC,GAAQ,OAAIA,EAASC,UACrBF,MAAK,qBAAEG,KAAekC,QAAO,SAAAI,GAAG,OAAIA,EAAIlC,QAAUA,GAASkC,EAAIF,MAAQ9B,KAAO+B,KAAI,SAAAF,GAAC,MAAK,CACtFG,IAAKH,EAAEG,IAAMC,KAAKC,MAAMC,IAAON,EAAEG,KAAKI,KAAKD,OAAY,GAAK,KAAQN,EAAEG,IACtEK,OAAQ,CACNhC,GAAIwB,EAAEiB,IACN3C,GAAI0B,EAAEiB,KAER1D,GAAI,eCnFNmC,EAAS,uCAAG,iDAAA4B,EAAA,sDAASrD,EAAT,EAASA,MAAO6C,EAAhB,EAAgBA,WAAY3C,EAA5B,EAA4BA,MAAOyB,EAAnC,EAAmCA,IAAKC,EAAxC,EAAwCA,YAAatC,EAArD,EAAqDA,GAAIgE,EAAzD,EAAyDA,UACrEC,EAAQ,GADI,cAEUjE,GAFV,4DAGK,SADTkE,EAFI,WAGcX,EAAWhC,IAHzB,6BAIJ0C,EAJI,UAIgBlE,EAAOoC,UAAU,CAC3CzB,QACA0B,OAAQmB,EAAWhC,IAAIc,EAAI,GAC3BA,IAAMA,IAAQ2B,EAAY,IAAO3B,EACjCC,cAAa1B,UARH,oBAIZqD,EAJY,KAIEE,OAJF,2CAWW,QAAfD,IAAwBX,EAAWK,IAX/B,6BAYJK,EAZI,UAYgBN,EAAOxB,UAAU,CAACC,OAAQmB,EAAWK,IAAIvB,EAAI,GAAI3B,QAAOE,UAZxE,oBAYZqD,EAZY,KAYEE,OAZF,2CAcW,SAAfD,IAAyBX,EAAWF,KAdhC,6BAeJY,EAfI,UAegBb,EAAQjB,UAAU,CAACC,OAAQmB,EAAWF,KAAKhB,EAAI,GAAI3B,QAAOE,UAf1E,oBAeZqD,EAfY,KAeEE,OAfF,wLAkBTF,EAAMG,MAAK,SAACL,EAAEM,GAAH,OAASN,EAAEnB,IAAMyB,EAAEzB,KAAO,EAAI,KAAGJ,QAAO,SAAAC,GAAC,OAAK6B,OAAOC,UAAU9B,EAAEG,MAAQH,EAAEG,IAAM,MAlBnF,gEAAH,sDAqBTU,EAAe,uCAAG,qCAAAS,EAAA,yDAASrD,EAAT,EAASA,MAAO4B,EAAhB,EAAgBA,YAAa1B,EAA7B,EAA6BA,MAExC,SAF+CZ,EAApC,EAAoCA,IAApC,gBAEJwE,EAAMzE,EAFF,0BAGN,SAAPC,EAHa,gBAGEwE,EAAMpB,EAHR,0BAIN,QAAPpD,EAJa,iBAICwE,EAAMb,EAJP,+BAMpBE,QAAQY,MAAMzE,EAAG,8BANG,kBAOb,MAPa,yBASTwE,EAAIlB,gBAAgB,CAAC5C,QAAO4B,cAAa1B,UAThC,qFAAH,sD,OCrBf8D,EAAaC,IAAMC,gBAEZC,EAAqB,SAAEC,GAAY,IAAD,EACfC,mBAASC,aAAaC,QAAQ,YADf,mBACtCC,EADsC,KAC7BC,EAD6B,OAGXJ,mBAAS,MAHE,mBAGtCxE,EAHsC,KAG3B6E,EAH2B,OAIbL,mBAAS,MAJI,mBAItCnD,EAJsC,KAI5ByD,EAJ4B,OAMPN,mBAAS,IANF,mBAMtCO,EANsC,KAMzBC,EANyB,OAQHR,mBAAS,SARN,mBAQtCS,EARsC,KAQvBC,EARuB,OAWLV,mBAAS,IAXJ,mBAWtCW,EAXsC,KAWxBC,EAXwB,KAyB7CC,qBAAU,WAER1F,MACE,gFACAC,MACA,SAAAC,GAAQ,OAAIA,EAASC,UACrBF,MAAK,YAAY,IAAV0F,EAAS,EAATA,IACFX,IAAYW,IACfb,aAAac,QACbX,EAAWU,GACXb,aAAae,QAAQ,UAAWF,OArBpC5F,IAAiBE,MAAK,WACpB,IAAI6F,EAAaC,KAAKC,MAAMlB,aAAaC,QAAQ,cACjDG,EAAaY,GACbL,EAAgBQ,EAAgB,GAAIH,OAEtCrE,IAAgBxB,MAAK,WACnB,IAAIiG,EAAYH,KAAKC,MAAMlB,aAAaC,QAAQ,aAChDI,EAAYe,QAmBb,IAEHR,qBAAU,WACRD,EAAgBQ,EAAgBb,EAAa/E,MAC5C,CAAC+E,EAAa/E,IAejB,OACE,cAACmE,EAAW2B,SAAZ,CAAqBC,MAAO,CACxB/F,YAAW6E,eAAcxD,WAAUyD,cACnCC,cAAaC,iBAAgBgB,0BAhBD,SAACC,GACjC,OAAQA,GACN,IAAK,IACHjB,EAAeD,EAAYmB,MAAM,GAAG,IACpC,MACF,IAAK,IACHlB,EAAe,IACf,MACF,QACEA,EAAeD,EAAYkB,KAQ3BhB,gBAAeC,mBACfC,gBAJJ,SAMGZ,EAAM4B,YAKEhC,IAITzE,EAAc,uCAAG,oDAAA8D,EAAA,2DACqB,MAArCiB,aAAaC,QAAQ,cACxBD,aAAaC,QAAQ,mBAAqBlC,MAAS4D,SAAS,EAAG,QAAQC,OAAO,0BAF3D,iBAIfrG,EAAY,GACZiB,EAAsB,OALP,MAMA,CAACzB,EAAQqD,EAASO,GANlB,gDAMPa,EANO,cAOgCA,EAAIvE,iBAPpC,OASf,IATe,4BAOV+F,EAPU,KAOEa,EAPF,KASf,MAAqBC,OAAOC,QAAQf,GAApC,gBAAYtF,EAAsC,MACrC,KAAMH,GAZMwD,EAaQrD,EAAM,GAAGI,KAAKC,GAAGiG,cAbtB3C,EAaqC9D,EAAUG,EAAM,IAAII,KAAKC,GAAGiG,cAb3DjD,EAAEkD,SAAS5C,IAAMA,EAAE4C,SAASlD,IAexDxD,EAAUG,EAAM,IAAIV,GAAGyB,KAAK+C,EAAIxE,IAChCO,EAAUG,EAAM,IAAIY,MAAMkD,EAAIxE,IAAMU,EAAM,GAAGY,MAAMkD,EAAIxE,KAGvDO,EAAUG,EAAM,GAAG,IAAI8D,EAAIxE,IAAMU,EAAM,IAIzCH,EAAUG,EAAM,IAAMA,EAAM,GAGhCc,EAAsBqF,EAAuBrF,EAAsBqF,EAAuBrF,EAxB3E,mCA2BfwE,EAAazF,EACjBA,EAAY,GACZuG,OAAOC,QAAQf,GAAY5B,MAAK,SAACL,EAAEM,GAAH,OAAUN,EAAE,GAAKM,EAAE,IAAM,EAAI,KAAI7D,SAAQ,SAAAE,GACvEH,EAAUG,EAAM,IAAMA,EAAM,MAI9BsE,aAAae,QAAQ,YAAaE,KAAKiB,UAAU3G,IACjDyE,aAAae,QAAQ,kBAAmBvE,GAnCrB,kCAFS,IAACuC,EAAGM,IAEb,OAAH,qDAuCd1C,EAAa,uCAAG,kCAAAoC,EAAA,2DACqB,MAApCiB,aAAaC,QAAQ,aACxBD,aAAaC,QAAQ,cAAgBlC,MAAS4D,SAAS,EAAG,QAAQC,OAAO,0BAFvD,gCAK0B7G,EAAO4B,gBALjC,mCAKbC,EALa,KAKHJ,EALG,KAMlBwD,aAAae,QAAQ,WAAYE,KAAKiB,UAAUtF,IAChDoD,aAAae,QAAQ,aAAcvE,GAPjB,2CAAH,qDAWb2E,EAAkB,SAAEb,EAAa/E,GACrC,GAAkB,MAAbA,EAAoB,MAAO,GAChC,IAAImF,EAAe,GAMnB,OALAoB,OAAOC,QAAQxG,GAAWC,SAAQ,SAAAE,GAC3BA,EAAM,GAAGyG,WAAW7B,EAAY0B,iBACnCtB,EAAahF,EAAM,GAAG+F,MAAMnB,EAAY8B,OAAQ9B,EAAY8B,OAAO,KAAM,MAGtEN,OAAOC,QAAQrB,GAAc/C,KAAI,SAAA0E,GAAC,OAAIA,EAAE,MAAI7E,QAAO,SAAA6E,GAAC,MAAU,MAANA,MCjF3DC,EAAYC,aAAW,SAAAC,GAAK,MAAK,CACrCC,cAAc,aACZC,QAAS,QACRF,EAAMG,YAAYC,KAAK,MAAO,CAC7BC,cAAe,gBAGnBC,QAAS,CACPJ,QAAS,OACTK,eAAgB,gBAChBC,OAA8B,EAAtBR,EAAMQ,OAAOC,YAInBC,EAAeC,YAAW,CAC9BC,KAAM,CACJC,aAAc,OACdC,UAAW,IAEbC,UAAW,CACTC,gBAAiB,gBANAL,CAQlBM,KAEGC,EAAcP,aAAW,SAACX,GAAD,MAAY,CACzCY,KAAM,CACJO,cAAe,OACfC,SAAU,GACVC,WAAY,IACZC,YAAatB,EAAMuB,QAAQ,GAC3BC,SAAU,OACVC,QAAS,EACTC,QAAS,WAEXC,SAAS,CACP,sBAAsB,CACpBC,MAAO,UACPZ,gBAAiB,YAGrBa,QAAS,CACPD,MAAO,UACPE,aAAc,OACdJ,QAAS,wBAnBOf,EAqBhB,SAACrD,GAAD,OAAW,cAACyE,EAAA,EAAD,aAAKC,eAAa,GAAK1E,OAEvB2E,EA3FA,SAAC3E,GAAW,IAAD,EACgB4E,qBAAYhF,GAA5CY,EADgB,EAChBA,YAAaC,EADG,EACHA,eAEboE,EAASC,cAATD,KAHgB,EAIJE,cAAZC,EAJgB,EAIhBA,EAAGC,EAJa,EAIbA,KACLC,EAAU1C,IACZtF,EAAWiI,cACTC,EAAUC,cAOhB,OACE,eAACC,EAAA,EAAD,CACEC,UAAWL,EAAQlC,QADrB,UAGE,gCACE,cAACwC,EAAA,EAAD,CAAYC,QAAQ,KAApB,0BACA,cAACD,EAAA,EAAD,CAAYC,QAAQ,YAApB,qDAEF,cAACC,EAAA,EAAD,CACEC,KAAK,OACLnE,MAAOhB,EACPoF,YAAaZ,EAAE,kCACfa,SAAU,SAAAlI,GAAC,OAAI8C,EAAe9C,EAAEmI,OAAOtE,QACvCuE,SAAUlB,EAAK1C,SAAS,WAE1B,qBACEoD,UAAWL,EAAQvC,cADrB,SAGE,eAACS,EAAD,CACI5B,MAAOyD,EAAKe,SACZH,SAAU,SAAClI,EAAGsI,GAAJ,OAzBSC,EAyBsBD,EAxBjDb,EAAQe,QAASjJ,EAASkJ,SAASD,QAAQ,IAAIlB,EAAKe,SAAS,IAAK,IAAIE,EAAK,WAC3EjB,EAAKoB,eAAeH,GAFO,IAAAA,GAuBvB,UAIE,cAACtC,EAAD,CAAapC,MAAM,KAAK8E,MAAM,OAC9B,cAAC1C,EAAD,CAAapC,MAAM,KAAK8E,MAAM,oB,sGCrClCC,GAAY,SAAC,GAAwC,IAAvChE,EAAsC,EAAtCA,EAAGiE,EAAmC,EAAnCA,YAAmC,IAAtBT,gBAAsB,SAClDb,EAAU1C,KACRwC,EAAMD,cAANC,EACR,OACE,cAACyB,EAAA,EAAD,CACEC,KAAK,QACLjB,QAAQ,YACRF,UAAWL,EAAQyB,OACnBC,QAAS,kBAAMJ,EAAYjE,IAC3BwD,SAAUA,EALZ,SAOS,MAANxD,EAAY,cAAC,KAAD,IACL,MAANA,EAAYyC,EAAE,gBAAQzC,KAKxBsE,GAAc,WAAO,IAAD,EACyCjC,qBAAYhF,GAArEY,EADgB,EAChBA,YAAaiB,EADG,EACHA,0BAA2Bb,EADxB,EACwBA,aAEhD,OACE,cAACkG,GAAA,EAAD,CAAMC,WAAS,EAAC9C,QAAS,EAAzB,SAEE,eAAe+C,MAAM,IAAInJ,KAAK,SAAA0E,GAAC,OAC7B,cAACuE,GAAA,EAAD,CAAMG,MAAI,EAACC,GAAI,EAAf,SACE,cAAC,GAAD,CACE3E,EAAGA,EACHiE,YAAa/E,EACbsE,SACS,MAANxD,GAA6B,KAAhB/B,IACR,KAAK2B,SAASI,KAAO3B,EAAauB,SAASI,IACtC,MAANA,GAA6B,KAAhB/B,KAPD,SAAS+B,SAiBlC4E,GAAmB,WAAO,IAAD,EACuBvC,qBAAYhF,GAAxD6B,EADqB,EACrBA,0BAA2Bb,EADN,EACMA,aAEnC,OACE,cAACkG,GAAA,EAAD,CAAMC,WAAS,EAAC9C,QAAS,EAAzB,SAEIrD,EAAalD,QAAO,SAAA6E,GAAC,OAAI6E,MAAM7E,MAAI1E,KAAI,SAAA0E,GAAC,OACtC,cAACuE,GAAA,EAAD,CAAMG,MAAI,EAACC,GAAI,GAAf,SACE,cAAC,GAAD,CACE3E,EAAGA,EACHiE,YAAa/E,KAHO,SAASc,SA6B5B8E,GAjBO,WAEpB,IAAMnC,EAAU1C,KAGhB,OACE,eAAC8E,GAAA,EAAD,CAAK/B,UAAWL,EAAQqC,aAAcnD,QAHxB,EAGd,UACE,cAACkD,GAAA,EAAD,CAAK/B,UAAWL,EAAQsC,gBAAiBpD,QAJ7B,EAIZ,SACE,cAAC,GAAD,MAEF,cAACkD,GAAA,EAAD,CAAK/B,UAAWL,EAAQuC,qBAAsBrD,QAPlC,EAOZ,SACE,cAAC,GAAD,UAQF5B,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrC6E,aAAc,CACZ3E,QAAS,OACTG,cAAe,MACf2E,OAAQ,QACRzE,eAAgB,gBAElBuE,gBAAiB,CACfG,MAAO,OAETF,qBAAsB,CACpBE,MAAO,MACPD,OAAQ,OACRE,UAAW,SACXC,UAAW,UAEblB,OAAQ,CACNgB,MAAO,OACPD,OAAQ,GACRlD,aAAc,aCjGZsD,GAAWjI,IAAMkI,MAAK,YAA6B,IAA1BvM,EAAyB,EAAzBA,KAAMwM,EAAmB,EAAnBA,MAAOC,EAAY,EAAZA,MAAY,EAClClD,cAAZC,EAD8C,EAC9CA,EAAGC,EAD2C,EAC3CA,KAELrJ,EADgBJ,EAAdC,UACgBuM,GAH8B,EAItBpM,EAAM,GAAGoL,MAAM,KAAKrF,MAAM,EAAE,GAJN,mBAI/CuG,EAJ+C,KAItCrM,EAJsC,KAKhDqJ,EAAU1C,KAEhB,OACE,cAAC,IAAD,CAAM2F,GAAI,IAAIlD,EAAKe,SAAS,UAAUpK,EAAM,GAA5C,SACE,cAACwM,EAAA,EAAD,CAAM3C,QAAQ,WAA0BwC,MAAOA,EAAOI,QAAM,EAA5D,SACE,cAACC,EAAA,EAAD,UACE,eAACC,EAAA,EAAD,CAAahD,UAAWL,EAAQsD,YAAhC,UACE,cAAChD,EAAA,EAAD,CAAYC,QAAQ,KAAK7C,QAAQ,SAAjC,SAA2CsF,IAC3C,eAAC1C,EAAA,EAAD,CAAYC,QAAQ,UAApB,gBAAkC7J,EAAM,GAAGV,GAAG2C,KAAI,SAAA3C,GAAE,OAAI8J,EAAE9J,MAAKa,KAAK,QACpE,uBACA,eAACyJ,EAAA,EAAD,CAAYC,QAAQ,YAAY7C,QAAQ,SAAxC,UAAkDoC,EAAE,UAApD,IAA2DpJ,EAAM,GAAGS,KAAK4I,EAAKe,UAA9E,QACA,cAACR,EAAA,EAAD,CAAYC,QAAQ,UAApB,SAAgD,MAAjB5J,EAAuBmJ,EAAE,4BAAU,iBAP1CpJ,EAAM,QAavC6M,KAEGC,GAAiBC,aAAS,SAAClN,GAAD,MAAgB,CAACA,gBAE3CmN,GAAY,WAAO,IAAD,EACahE,qBAAWhF,GAAtCnE,EADc,EACdA,UAAW+E,EADG,EACHA,YACbqI,EAAkB7G,OAAOC,QAAQxG,GAAWiC,QAChD,SAAA/B,GAAO,OAAIA,EAAQ,GAAG0G,WAAW7B,EAAY0B,kBAGzC4G,EAAWJ,GAAeG,GAChC,OACE,cAAC,IAAD,CACEnB,OAAQ,IACRqB,UAAWF,EAAgBvG,OAC3B0G,SAAU,GACVrB,MAAM,OACNmB,SAAUA,EALZ,SAOKhB,MAeMmB,GAVI,WACjB,OACE,qCACE,cAAC,GAAD,IACA,uBACA,cAAC,GAAD,QAOAzG,GAAYC,aAAY,SAAAC,GAAK,MAAK,CACtC8F,YAAa,CACXpE,QAAS,gB,8BCsCE8E,GAjGE,WAAO,IAAD,EACCC,cAAdC,EADa,EACbA,GAAIC,EADS,EACTA,MADS,EAEapJ,oBAAS,GAFtB,mBAEbqJ,EAFa,KAEHC,EAFG,OAGwD3E,qBAAahF,GAAlFnE,EAHa,EAGbA,UAAWqB,EAHE,EAGFA,SAAUwD,EAHR,EAGQA,aAAcC,EAHtB,EAGsBA,YAAaI,EAHnC,EAGmCA,iBAHnC,EAIiByI,EAAGpC,MAAM,KAAKrF,MAAM,EAAE,GAJvC,mBAIb/F,EAJa,KAIN4B,EAJM,KAIO1B,EAJP,KAKbmJ,EAASF,cAATE,KACFG,EAAUC,cACVmE,EAAeC,iBAAO,IAEtBC,EAAWjO,EAAU2N,GAErBO,EAAe,SAAEN,GAAF,OAAa,SAACO,EAAOC,GACxCN,IAAYM,GAAcR,GACrBQ,GACHzE,EAAQe,QAAR,WAAoBlB,EAAKe,SAAzB,kBAA2CoD,EAA3C,YAAiDC,MAIrDvI,qBAAU,WACRH,EAAiB,GAAD,OAAIyI,EAAJ,YAAUE,MACzB,CAACA,IAEJxI,qBAAU,WAEH4I,EAASxO,GAAGwC,QAAO,SAAAxC,GAAE,OAA0B,MAAtBwO,EAASlN,MAAMtB,MAAaoH,QAExD5D,QAAQC,IACN+K,EAASxO,GAAG2C,KAAI,SAAA3C,GACd,OAA4B,OAAvBwO,EAASlN,MAAMtB,GAAsB,KACnC4O,EAAsB,CAC3BlO,QAAO4B,cAAa1B,QAAOZ,UAE5BwC,QAAO,SAAAuI,GAAC,OAAIA,MACf5K,MAAK,SAAA0O,GAEL,IAAIzI,EAAY,GAChByI,EAAKrO,SAAS,SAAAsO,GACZ1I,EAAS,2BAAOA,GAAc0I,EAAIlN,aAEpCyD,EAAY,2BAAIzD,GAAawE,IAG7BhB,GAAa,SAAA2J,GACX,IAAI/I,EAAaC,KAAKC,MAAMD,KAAKiB,UAAU6H,IAE3C,OADAF,EAAKrO,SAAQ,SAAAsO,GAAG,OAAI9I,EAAWkI,GAAI5M,MAAMwN,EAAI9O,IAAM8O,EAAIvL,cAChDyC,QAKRgJ,SAASb,KACZE,EAAYW,SAASb,IACrBG,EAAaW,QAAQD,SAASb,IAAQe,eAAe,CAACC,SAAU,SAAUC,MAAO,eAGlF,IAEH,IAAMpF,EAAU1C,KAEhB,OAAuC,MAAlCkH,EAASlN,MAAMkN,EAASxO,GAAG,IAE5B,cAACoM,GAAA,EAAD,CAAK/B,UAAWL,EAAQqF,iBAAxB,SACE,cAACC,EAAA,EAAD,CAAkB9D,KAAM,OAM5B,cAACY,GAAA,EAAD,CAAK/B,UAAWL,EAAQqC,aAAxB,SAEImC,EAASlN,MAAMkN,EAASxO,GAAG,IAAI2C,KAAI,SAACjB,EAAM6N,GAAP,OACjC,eAAC,GAAD,CAEEnB,SAAUA,IAAamB,EACvB5E,SAAU8D,EAAac,GACvBC,gBAAiB,CAACC,eAAe,GACjCC,IAAK,SAAAC,GAAOrB,EAAaW,QAAQM,GAAOI,GAL1C,UAOE,cAAC,GAAD,UAAmB/N,EAASF,GAAMG,KAAKkI,EAAKe,YAC5C,cAAC,GAAD,UACE,cAAC,GAAD,CACEpK,MAAOA,EACP2B,IAAKkN,EAAM,EACXhM,WAAYiL,EAASlN,MACrBgB,YAAaA,EACb1B,MAAOA,EACPZ,GAAIO,EAAU2N,GAAIlO,GAClBgE,UAAWwK,EAASlN,MAAMkN,EAASxO,GAAG,IAAIoH,aAfzC,QAAQmI,SA2BnBK,GAAa,SAAC,GAAqE,IAAlElP,EAAiE,EAAjEA,MAAO6C,EAA0D,EAA1DA,WAAYlB,EAA8C,EAA9CA,IAAKzB,EAAyC,EAAzCA,MAAO0B,EAAkC,EAAlCA,YAAatC,EAAqB,EAArBA,GAAIgE,EAAiB,EAAjBA,UAAiB,EAClE6F,cAAZC,EAD8E,EAC9EA,EAAGC,EAD2E,EAC3EA,KAD2E,EAE5DhF,mBAAS,MAFmD,mBAE9E8K,EAF8E,KAExEC,EAFwE,KAIhF3N,EAAY,YACD,uCAAG,sBAAA4B,EAAA,kEAChB+L,EADgB,SACDC,EAAgB,CAACrP,QAAO6C,aAAYlB,MAAKzB,QAAO0B,cAAatC,KAAIgE,cADhE,6EAAH,qDAGfgM,IAaF,GAVApK,qBAAW,WACTzD,IACA,IAAM8N,EAAmBC,aAAY,WACnC/N,MACC,KAEH,OAAO,kBAAMgO,cAAcF,MAE1B,IAEU,MAARJ,EACH,OACE,cAACP,EAAA,EAAD,CAAkB9D,KAAM,GAAIuB,MAAO,KAIvC,IAAMqD,EAAa,SAACxN,GAClB,IAAIyN,EAAM,GACV,OAAQzN,GACN,KAAK,KACH,MACF,KAAK,EACHyN,EAAM,KAAKvG,EAAE,gBACb,MACF,QACEuG,EAAMzN,EAAM,IAAMkH,EAAE,gBAGxB,OAAOuG,GAGT,OACE,8BAEoB,IAAhBR,EAAKzI,OAAe0C,EAAE,4BACpB+F,EAAKlN,KAAI,SAACC,EAAK2M,GAAN,OACP,eAACjF,EAAA,EAAD,CAAYC,QAAQ,YAApB,UACG6F,EAAWxN,EAAIA,KADlB,IACyBA,EAAIK,OAAO8G,EAAKe,UAAY,MAAQlI,EAAIK,OAAO8G,EAAKe,UAAY,GADzF,IAC+FhB,EAAElH,EAAI5C,MADrG,gBAA8CuP,UAUpDe,GAAYnI,YAAW,CAC3BC,KAAM,CACJmI,OAAQ,gCACRC,UAAW,OACX,qBAAsB,CACpBnI,aAAc,GAEhB,WAAY,CACVX,QAAS,QAEX,aAAc,CACZ+I,OAAQ,SAGZrC,SAAU,IAdMjG,CAefuI,MAEGC,GAAmBxI,YAAW,CAClCC,KAAM,CACJI,gBAAiB,qBACjBH,aAAc,gCACduI,cAAe,EACftI,UAAW,GACX,aAAc,CACZA,UAAW,KAGfuI,QAAS,CACP,aAAc,CACZJ,OAAQ,WAGZrC,SAAU,IAfajG,CAgBtB2I,MAEGC,GAAmB5I,aAAW,SAACX,GAAD,MAAY,CAC9CY,KAAM,CACJc,QAAS1B,EAAMuB,QAAQ,OAFFZ,CAIrB6I,MAEE1J,GAAYC,aAAW,SAAAC,GAAK,MAAK,CACrC6E,aAAc,CACZM,UAAW,UAEb0C,iBAAkB,CAChB3H,QAAS,OACTK,eAAgB,c,4DCpLLkJ,GA5BA,WAAO,IAAD,EACCpH,cAAZC,EADW,EACXA,EAAGC,EADQ,EACRA,KACL/H,EAAWiI,cACTzE,EAAkBkE,qBAAahF,GAA/Bc,cAER,OACE,eAAC0L,GAAA,EAAD,CACE5K,MAAOtE,EAASkJ,SAChBiG,YAAY,EAFd,UAIE,cAACC,GAAA,EAAD,CACEhG,MAAOtB,EAAE,gBACTuH,UAAWC,IACXrE,GAAE,WAAMlD,EAAKe,SAAX,WACFxE,MAAK,WAAMyD,EAAKe,SAAX,WACLyG,KAAM,cAAC,KAAD,MAER,cAACH,GAAA,EAAD,CACChG,MAAO5F,EAAcsG,MAAM,KAAK,GAChCuF,UAAWC,IACXrE,GAAE,WAAMlD,EAAKe,SAAX,kBAA6BtF,GAC/Bc,MAAK,WAAMyD,EAAKe,SAAX,kBAA6BtF,GAClC+L,KAAM,cAAC,KAAD,U,SCNPC,GAAa,WAAO,IAChB7H,EAASC,cAATD,KACR,OACE,eAAC,IAAD,WACE,cAAC,IAAD,CAAOA,KAAI,UAAKA,EAAL,sBAAX,SACE,cAAC,GAAD,MAEF,cAAC,IAAD,CAAOA,KAAI,UAAKA,EAAL,WAAX,SACE,cAAC,GAAD,UA8DO8H,GAxDH,WAMV,IAAMzH,EAAU1C,KANA,EAOgBoC,qBAAYhF,GAApCnE,EAPQ,EAORA,UAAWqB,EAPH,EAOGA,SACnB,OAAkB,MAAbrB,GAAiC,MAAZqB,EAEtB,eAAC8P,EAAA,EAAD,CAAWC,SAAS,KAAKC,gBAAc,EAACvH,UAAWL,EAAQqF,iBAA3D,UACE,cAACC,EAAA,EAAD,CAAkB9D,KAAM,KACxB,uBACA,uBACA,cAACqG,EAAA,EAAD,CAAOxH,UAAWL,EAAQ8H,qBAAsBC,UAAW,EAA3D,SACE,cAAC,KAAD,CACEC,KAAMC,KAAKC,MAAQ,IACnBC,SAAU,YAA2B,IAAzBC,EAAwB,EAAxBA,QACV,OADkC,EAAfC,UAEV,cAAC/H,EAAA,EAAD,CAAYC,QAAQ,YAAY+H,MAAM,SAAtC,+CAGL,qCACE,cAAChI,EAAA,EAAD,CAAYC,QAAQ,YAAY+H,MAAM,SAAtC,yCACA,cAAChI,EAAA,EAAD,CAAYC,QAAQ,YAAY+H,MAAM,SAAtC,6EACA,eAAChI,EAAA,EAAD,CAAYC,QAAQ,YAAY+H,MAAM,SAAtC,yBAAkDF,EAAlD,uBAahB,cAAC,IAAD,CAAkB5K,MAAO+K,GAAzB,SACE,cAACb,EAAA,EAAD,CAAWC,SAAS,KAAKC,gBAAc,EAACvH,UAAWL,EAAQ6B,UAA3D,SACE,eAAC,IAAD,WACE,cAAC,IAAD,CAAO2G,OAAK,EAAC7I,KAAK,IAAlB,SACE,cAAC,IAAD,CAAUsD,GAAG,iBAEf,eAAC,IAAD,CAAOtD,KAAK,SAAZ,UACE,cAAC8I,EAAA,EAAD,IACA,cAAC,EAAD,IACA,cAAC,GAAD,IACA,cAAC,GAAD,eAUNF,GAAQG,YAAe,CAC3BC,WAAY,CACVC,WAAY,mCAEdC,QAAS,CACPC,WAAY,CACVC,QAAS,aAKTzL,GAAYC,aAAY,SAAAC,GAAK,MAAK,CACtCqE,UAAW,CACTnE,QAAS,OACTG,cAAe,SACfE,eAAgB,gBAChByE,OAAQ,SAEV6C,iBAAkB,CAChB3H,QAAS,OACTG,cAAe,SACfE,eAAgB,SAChBiL,WAAY,SACZxG,OAAQ,SAEVyG,YAAa,OChHAC,GAZS,SAAAC,GAClBA,GAAeA,aAAuBC,UACxC,8BAAqBjT,MAAK,YAAkD,IAA/CkT,EAA8C,EAA9CA,OAAQC,EAAsC,EAAtCA,OAAQC,EAA8B,EAA9BA,OAAQC,EAAsB,EAAtBA,OAAQC,EAAc,EAAdA,QAC3DJ,EAAOF,GACPG,EAAOH,GACPI,EAAOJ,GACPK,EAAOL,GACPM,EAAQN,O,2BCHRO,GAAwD,OAAzCC,OAAO3R,SAASkJ,SAAS0I,OAAO,EAAE,GAAc,KAAO,KAE5E7J,KACG8J,IAAIC,MACJC,KAAK,CACJC,aACAC,UAAW,CAAC,KAAM,MAClBC,cAAc,EACdC,IAAKT,GACLU,aAAa,EACbC,cAAc,EACdC,OAAO,EAEPC,cAAc,CACZC,aAAa,KAIJzK,GAAf,ECdA0K,IAASC,OAEL,cAAC,EAAD,UACE,cAAC,GAAD,MAIJC,SAASC,eAAe,SAM1B1B,M","file":"static/js/main.07f470ea.chunk.js","sourcesContent":["import moment from 'moment'\n\nconst KmbApi = {\n  co: 'kmb',\n  fetchRouteList: () => (\n    // fetch route data\n    fetch(\n      \"https://data.etabus.gov.hk/v1/transport/kmb/route/\"\n    ).then(response => response.json())\n    .then( ({data}) => {\n      let routeList = {}\n      data.forEach(element => {\n        routeList[[element.route, element.service_type, element.bound].join('+')] = {\n          co: ['kmb'],\n          orig: {\n            en: element.orig_en,\n            zh: element.orig_tc\n          },\n          dest: {\n            en: element.dest_en,\n            zh: element.dest_tc\n          },\n          stops: {\n            kmb: []\n          }\n        }\n      })\n      return routeList\n    }).then( routeList => (\n      // fetch route stop data\n      fetch(\"https://data.etabus.gov.hk/v1/transport/kmb/route-stop/\").then(response => response.json())\n      .then(({data, generated_timestamp}) => {\n        data.forEach(element => {\n          routeList[[element.route, element.service_type, element.bound].join('+')].stops.kmb.push(\n            element.stop\n          )\n        })\n        return [routeList, generated_timestamp]\n      })\n    ))\n  ),\n  fetchStopList: () => {\n    return fetch(\"https://data.etabus.gov.hk/v1/transport/kmb/stop\").then(\n      response => response.json()\n    ).then(({data, generated_timestamp}) => {\n      let stopList = {}\n      data.forEach(element => {\n        stopList[element.stop] = {\n          name: {\n            en: element.name_en,\n            zh: element.name_tc\n          },\n          location: {\n            lat: element.lat,\n            long: element.long\n          }\n        }\n      })\n      return [stopList, generated_timestamp]\n    })\n  },\n  /*\n    @fetchEtas\n    return array of Object with props {\n      eta: (int) minute or null,\n      remark: {\n        zh: string\n        en: string\n      }\n    }\n  */\n  fetchEtas: ({stopId, route, seq, serviceType, bound}) => {\n    return fetch(\n      `https://data.etabus.gov.hk/v1/transport/kmb/eta/${stopId}/${route}/${serviceType}`,\n      { cache: \"no-store\" }\n    ).then( response => response.json() )\n    .then(({data}) => data.filter(e => e.dir === bound && e.seq === seq).map(e => ({\n        eta: e.eta ? Math.round(moment(e.eta).diff(moment()) / 60 / 1000) : e.eta,\n        remark: {\n          zh: e.rmk_tc,\n          en: e.rmk_en\n        },\n        co: 'kmb'\n      }))\n    )\n  }\n}\n\nexport default KmbApi","import moment from 'moment'\n\nconst NwfbApi = {\n  co: 'nwfb',\n  fetchRouteList: () => (\n    fetch(\"https://rt.data.gov.hk/v1/transport/citybus-nwfb/route/nwfb\")\n      .then(response => response.json())\n      .then(({data, generated_timestamp}) => {\n        let routeList = {}\n        data.forEach(element => {\n          // the bound direction is reverted to fit KMB route\n          routeList[[element.route,'1','I'].join('+')] = {\n            orig: {\n              en: element.orig_en,\n              zh: element.orig_tc\n            },\n            dest: {\n              en: element.dest_en,\n              zh: element.dest_tc\n            },\n            co: ['nwfb'],\n            stops: {\n              nwfb: null\n            }\n          }\n          routeList[[element.route,'1','O'].join('+')] = {\n            dest: {\n              en: element.orig_en,\n              zh: element.orig_tc\n            },\n            orig: {\n              en: element.dest_en,\n              zh: element.dest_tc\n            },\n            co: ['nwfb'],\n            stops: {\n              nwfb: null\n            }\n          }\n        })\n        return [routeList, generated_timestamp]\n      })\n  ),\n  fetchRouteStops: ({route, bound, routeList}) => {\n    // fetch route stop first\n    // the bound direction is reverted to fit KMB route\n    const dir = bound === 'I' ? 'outbound' : 'inbound'\n    return fetch(\n      `https://rt.data.gov.hk/v1/transport/citybus-nwfb/route-stop/NWFB/${route}/${dir}`\n    ).then( response => \n      response.json()\n    ).then( ({data}) => \n      data.map(e => e.stop) \n    ).then( routeStops => {\n      // fetch each stop in parallel\n      return Promise.all(routeStops.map(stopId => \n          fetch(`https://rt.data.gov.hk/v1/transport/citybus-nwfb/stop/${stopId}`).then(\n            response => response.json()\n          ).then ( ({data}) => ({\n            stopId: stopId,\n            name: {\n              zh: data.name_tc,\n              en: data.name_en\n            },\n            location: {\n              lat: data.lat,\n              long: data.long\n            }\n          }))\n        )).then( stops => {\n          let stopList = {};\n          stops.forEach(stop => stopList[stop.stopId] = stop)\n          return {routeStops, stopList, co: 'nwfb'}\n        })\n    })\n  },\n  fetchEtas: ({stopId, route, bound }) => {\n    // the bound direction is reverted to fit KMB route\n    return fetch(`https://rt.data.gov.hk/v1/transport/batch/stop-eta/NWFB/${stopId}?lang=zh-hant`, { cache: \"no-store\" }).then(\n      response => response.json()\n    ).then(({data}) => data.filter(eta => eta.route === route && eta.dir !== bound && eta.eta).map(e => ({\n        eta: e.eta ? Math.round(moment(e.eta).diff(moment()) / 60 / 1000) : e.eta,\n        remark: {\n          zh: e.rmk,\n          en: e.rmk\n        },\n        co: 'nwfb'\n      }))\n    )\n  }\n}\n\nexport default NwfbApi","import moment from 'moment'\n\nconst CtbApi = {\n  co: 'ctb',\n  fetchRouteList: () => (\n    fetch(\"https://rt.data.gov.hk/v1/transport/citybus-nwfb/route/ctb\")\n      .then(response => response.json())\n      .then(({data, generated_timestamp}) => {\n        let routeList = {}\n        data.forEach(element => {\n          // the bound direction is reverted to fit KMB route\n          routeList[[element.route,'1','I'].join('+')] = {\n            orig: {\n              en: element.orig_en,\n              zh: element.orig_tc\n            },\n            dest: {\n              en: element.dest_en,\n              zh: element.dest_tc\n            },\n            co: ['ctb'],\n            stops: {\n              ctb: null\n            }\n          }\n          routeList[[element.route,'1','O'].join('+')] = {\n            dest: {\n              en: element.orig_en,\n              zh: element.orig_tc\n            },\n            orig: {\n              en: element.dest_en,\n              zh: element.dest_tc\n            },\n            co: ['ctb'],\n            stops: {\n              ctb: null\n            }\n          }\n        })\n        return [routeList, generated_timestamp]\n      })\n  ),\n  fetchRouteStops: ({route, bound, routeList}) => {\n    // fetch route stop first\n    // the bound direction is reverted to fit KMB route\n    const dir = bound === 'I' ? 'outbound' : 'inbound'\n    return fetch(\n      `https://rt.data.gov.hk/v1/transport/citybus-nwfb/route-stop/CTB/${route}/${dir}`\n    ).then( response => \n      response.json()\n    ).then( ({data}) => \n      data.map(e => e.stop) \n    ).then( routeStops => {\n      // fetch each stop in parallel\n      return Promise.all(routeStops.map(stopId => \n          fetch(`https://rt.data.gov.hk/v1/transport/citybus-nwfb/stop/${stopId}`).then(\n            response => response.json()\n          ).then ( ({data}) => ({\n            stopId: stopId,\n            name: {\n              zh: data.name_tc,\n              en: data.name_en\n            },\n            location: {\n              lat: data.lat,\n              long: data.long\n            }\n          }))\n        )).then( stops => {\n          let stopList = {};\n          stops.forEach(stop => stopList[stop.stopId] = stop)\n          console.log(stopList)\n          return {routeStops, stopList, co: 'ctb'}\n        })\n    })\n  },\n  // the bound direction is reverted to fit KMB route\n  fetchEtas: ({stopId, route, bound }) => {\n    return fetch(`https://rt.data.gov.hk/v1/transport/batch/stop-eta/CTB/${stopId}?lang=zh-hant`, { cache: \"no-store\" }).then(\n      response => response.json()\n    ).then(({data}) => data.filter(eta => eta.route === route && eta.dir !== bound).map(e => ({\n        eta: e.eta ? Math.round(moment(e.eta).diff(moment()) / 60 / 1000) : e.eta,\n        remark: {\n          zh: e.rmk,\n          en: e.rmk\n        },\n        co: 'ctb'\n      }))\n    )\n  }\n}\n\nexport default CtbApi","import KmbApi from './Kmb'\nimport NwfbApi from './Nwfb'\nimport CtbApi from './Ctb'\n\nconst fetchEtas = async ( {route, routeStops, bound, seq, serviceType, co, routeSize}) => {\n  let _etas = []\n  for ( const company_id of co ) {\n    if (company_id === 'kmb' && routeStops.kmb ){\n      _etas = _etas.concat( await KmbApi.fetchEtas({\n        route,\n        stopId: routeStops.kmb[seq-1], \n        seq: (seq === routeSize ? 1000 : seq), \n        serviceType, bound}) \n      )\n    }\n    else if ( company_id === 'ctb' && routeStops.ctb ) {\n      _etas = _etas.concat( await CtbApi.fetchEtas({stopId: routeStops.ctb[seq-1], route, bound }))\n    }\n    else if ( company_id === 'nwfb' && routeStops.nwfb ) {\n      _etas = _etas.concat( await NwfbApi.fetchEtas({stopId: routeStops.nwfb[seq-1], route, bound }))\n    }\n  }\n  return _etas.sort((a,b) => a.eta < b.eta ? -1 : 1).filter(e => !Number.isInteger(e.eta) || e.eta > 1 )\n}\n\nconst fetchRouteStops = async ( {route, serviceType, bound, co} ) => {\n  let api\n  if (co === 'kmb') api = KmbApi\n  else if (co === 'nwfb') api = NwfbApi\n  else if (co === 'ctb') api = CtbApi\n  else {\n    console.error(co+' is not a valid company id')\n    return null\n  }\n  return await api.fetchRouteStops({route, serviceType, bound})\n}\n\nexport { KmbApi, NwfbApi, CtbApi, fetchEtas, fetchRouteStops }","import React, { useEffect, useState } from 'react'\nimport moment from 'moment'\nimport { KmbApi, NwfbApi, CtbApi } from './data-api'\n\nconst AppContext = React.createContext()\n\nexport const AppContextProvider = ( props ) => {\n  const [version, setVersion] = useState(localStorage.getItem('version'))\n  // route list & stop list & route-stop list\n  const [routeList, setRouteList] = useState(null)\n  const [stopList, setStopList] = useState(null)\n  // search route\n  const [searchRoute, setSearchRoute] = useState(\"\")\n  // selected route for bottom navigation shortcut\n  const [selectedRoute, setSelectedRoute] = useState(\"1+1+I\")\n\n  // possible Char for RouteInputPad\n  const [possibleChar, setPossibleChar] = useState([])\n  \n  const renewStorage = () => {\n    fetchRouteList().then(() => {\n      let _routeList = JSON.parse(localStorage.getItem('routeList'))\n      setRouteList(_routeList)\n      setPossibleChar(getPossibleChar('', _routeList))\n    })\n    fetchStopList().then(() => {\n      let _stopList = JSON.parse(localStorage.getItem('stopList'))\n      setStopList(_stopList)\n    }) \n  }\n\n  useEffect(() => {\n    // check app version and flush localstorage if outdated\n    fetch(\n      'https://api.github.com/repos/chunlaw/hk-independent-bus-eta/commits/gh-pages'\n    ).then(\n      response => response.json()\n    ).then(({sha}) => {\n      if ( version !== sha ) {\n        localStorage.clear()\n        setVersion(sha)\n        localStorage.setItem('version', sha)\n      }\n    })\n    renewStorage()\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  useEffect(() => {\n    setPossibleChar(getPossibleChar(searchRoute, routeList))\n  }, [searchRoute, routeList])\n\n  const updateSearchRouteByButton = (buttonValue) => {\n    switch (buttonValue) {\n      case 'b': \n        setSearchRoute(searchRoute.slice(0,-1))\n        break\n      case '-':\n        setSearchRoute('')\n        break\n      default: \n        setSearchRoute(searchRoute+buttonValue)\n    }\n  }\n\n  return (\n    <AppContext.Provider value={{\n        routeList, setRouteList, stopList, setStopList,\n        searchRoute, setSearchRoute, updateSearchRouteByButton,\n        selectedRoute, setSelectedRoute,\n        possibleChar\n      }}>\n      {props.children}\n    </AppContext.Provider>\n  )\n}\n\nexport default AppContext\n\nconst checkSameLocationNaming = (a, b) => a.includes(b) || b.includes(a)\n\nconst fetchRouteList = async () => {\n  if ( localStorage.getItem('routeList') == null || \n    localStorage.getItem('routeListDbTime') < moment().subtract(1, 'days').format(\"YYYY-MM-DDTHH:mm:ssZZ\")\n  ) {\n    let routeList = {}\n    let generated_timestamp = '3000'\n    for ( const api of [KmbApi, NwfbApi, CtbApi] ) {\n        let [_routeList, _generated_timestamp] = await api.fetchRouteList()\n        // merging routes from different service provider\n        for ( const route of Object.entries(_routeList) ) {\n          if ( route[0] in routeList ) {\n            if ( checkSameLocationNaming(route[1].orig.en.toUpperCase(), routeList[route[0]].orig.en.toUpperCase() ) ) {\n              // same route\n              routeList[route[0]].co.push(api.co)\n              routeList[route[0]].stops[api.co] = route[1].stops[api.co]\n            } else {\n              // new route with same route number\n              routeList[route[0]+'+'+api.co] = route[1]\n            }\n          } else {\n            // new route\n            routeList[route[0]] = route[1]\n          }\n        }\n        generated_timestamp = _generated_timestamp < generated_timestamp ? _generated_timestamp : generated_timestamp\n    }\n    // sort the routeList\n    let _routeList = routeList\n    routeList = {}\n    Object.entries(_routeList).sort((a,b) => (a[0] < b[0] ? -1 : 1)).forEach(route => {\n      routeList[route[0]] = route[1]\n    })\n    \n    // save to local storage\n    localStorage.setItem('routeList', JSON.stringify(routeList))\n    localStorage.setItem('routeListDbTime', generated_timestamp)\n  } \n}\n\nconst fetchStopList = async () => {\n  if ( localStorage.getItem('stopList') == null ||\n    localStorage.getItem('stopDbTime') < moment().subtract(1, 'days').format(\"YYYY-MM-DDTHH:mm:ssZZ\")\n  ) {\n    // KMB\n    let [stopList, generated_timestamp] = await KmbApi.fetchStopList()\n    localStorage.setItem('stopList', JSON.stringify(stopList))\n    localStorage.setItem('stopDbTime', generated_timestamp)\n  }\n}\n\nconst getPossibleChar = ( searchRoute, routeList ) => {\n  if ( routeList == null ) return []\n  let possibleChar = {}\n  Object.entries(routeList).forEach(route => {\n    if ( route[0].startsWith(searchRoute.toUpperCase()) ) {\n      possibleChar[route[0].slice(searchRoute.length, searchRoute.length+1)] = true\n    }\n  })\n  return Object.entries(possibleChar).map(k => k[0]).filter(k => k !== '+')\n}","import React, { useContext } from \"react\"\nimport {\n  Input,\n  Tabs,\n  Tab,\n  Toolbar,\n  Typography\n} from \"@material-ui/core\"\nimport { withStyles, makeStyles } from '@material-ui/core/styles'\nimport { useLocation, useHistory } from 'react-router-dom'\nimport { useTranslation } from 'react-i18next'\nimport { useRouteMatch } from 'react-router-dom'\nimport AppContext from '../AppContext'\n\nconst Header = (props) => {\n  const { searchRoute, setSearchRoute } = useContext( AppContext )\n  \n  const { path } = useRouteMatch()\n  const { t, i18n } = useTranslation()\n  const classes = useStyles()\n  let location = useLocation()\n  const history = useHistory()\n\n  const handleLanguageChange = lang => {\n    history.replace( location.pathname.replace('/'+i18n.language+'/', '/'+lang+'/') )\n    i18n.changeLanguage(lang)\n  }\n\n  return (\n    <Toolbar\n      className={classes.toolbar}\n    >\n      <div>\n        <Typography variant=\"h6\">香港</Typography>\n        <Typography variant='subtitle2'>獨立巴士預報</Typography>\n      </div>\n      <Input \n        type=\"text\"\n        value={searchRoute}\n        placeholder={t('搜尋巴士線')}\n        onChange={e => setSearchRoute(e.target.value)}\n        disabled={path.includes('route')}\n      />\n      <div\n        className={classes.tabsContainer}\n      >\n        <LanguageTabs\n            value={i18n.language}\n            onChange={(e, v) => handleLanguageChange(v)}\n          >\n          <LanguageTab value=\"en\" label=\"En\" />\n          <LanguageTab value=\"zh\" label=\"繁\" />\n        </LanguageTabs>\n      </div>\n    </Toolbar>\n  );\n}\n\nconst useStyles = makeStyles(theme => ({\n  tabsContainer: {\n    display: 'flex',\n    [theme.breakpoints.down('sm')]:{\n      flexDirection: \"row-reverse\"\n    }\n  },\n  toolbar: {\n    display: 'flex',\n    justifyContent: 'space-between',\n    zIndex: theme.zIndex.drawer * 2\n  }\n}))\n\nconst LanguageTabs = withStyles({\n  root: {\n    borderBottom: 'none',\n    minHeight: 24\n  },\n  indicator: {\n    backgroundColor: 'transparent'\n  }\n})(Tabs);\n\nconst LanguageTab = withStyles((theme) => ({\n  root: {\n    textTransform: 'none',\n    minWidth: 36,\n    fontWeight: 900,\n    marginRight: theme.spacing(0),\n    fontSize: '15px',\n    opacity: 1,\n    padding: '6px 6px'\n  },\n  selected:{\n    '& > .MuiTab-wrapper':{\n      color: '#3B3C45',\n      backgroundColor: '#FEFBFA'\n    }\n  },\n  wrapper: {\n    color: '#3B3C45',\n    borderRadius: '30px',\n    padding: '2px 10px 0px 10px'\n  },\n}))((props) => <Tab disableRipple {...props} />);\n\nexport default Header;","import React, { useContext } from 'react'\nimport { \n  Box,\n  Button,\n  Grid\n} from '@material-ui/core'\nimport {\n  makeStyles\n} from '@material-ui/styles'\nimport BackspaceOutlinedIcon from '@material-ui/icons/BackspaceOutlined';\n\nimport AppContext from '../AppContext'\nimport { useTranslation } from 'react-i18next';\n\nconst KeyButton = ({k, handleClick, disabled = false}) => {\n  const classes = useStyles()\n  const { t } = useTranslation()\n  return (\n    <Button \n      size=\"large\"\n      variant=\"contained\" \n      className={classes.button}\n      onClick={() => handleClick(k)}\n      disabled={disabled}\n    >\n      {k === 'b' ? <BackspaceOutlinedIcon/> : \n        k === '-' ? t('取消') : k}\n    </Button>\n  )\n}\n\nconst RouteNumPad = () => {\n  const { searchRoute, updateSearchRouteByButton, possibleChar } = useContext( AppContext )\n\n  return (\n    <Grid container spacing={0}>\n    {\n      '789456123-0b'.split('').map( k => (\n        <Grid item xs={4} key={'input-'+k}>\n          <KeyButton\n            k={k}\n            handleClick={updateSearchRouteByButton}\n            disabled={\n              (k === 'b' && searchRoute === '') \n              || ( !'b-'.includes(k) && !possibleChar.includes(k))\n              || ( k === '-' && searchRoute === '' )\n            }\n          />\n        </Grid>\n      ))\n    }\n    </Grid>\n  )\n}\n\nconst RouteAlphabetPad = () => {\n  const { updateSearchRouteByButton, possibleChar } = useContext( AppContext )\n  \n  return (\n    <Grid container spacing={1}>\n      {\n        possibleChar.filter(k => isNaN(k)).map(k => (\n          <Grid item xs={12} key={'input-'+k}>\n            <KeyButton\n              k={k}\n              handleClick={updateSearchRouteByButton}\n            />\n          </Grid>\n        )) \n      }\n    </Grid>\n  )\n}\n\nconst RouteInputPad = () => {\n\n  const classes = useStyles()\n  const padding = 0\n\n  return (\n    <Box className={classes.boxContainer} padding={padding}>\n      <Box className={classes.numPadContainer} padding={padding}>\n        <RouteNumPad />\n      </Box>\n      <Box className={classes.alphabetPadContainer} padding={padding}>\n        <RouteAlphabetPad />\n      </Box>\n    </Box>\n  )\n}\n\nexport default RouteInputPad\n\nconst useStyles = makeStyles(theme => ({\n  boxContainer: {\n    display: 'flex',\n    flexDirection: 'row',\n    height: '180px',\n    justifyContent: 'space-around'\n  },\n  numPadContainer: {\n    width: '60%',\n  },\n  alphabetPadContainer: {\n    width: '20%',\n    height: '100%',\n    overflowX: 'hidden',\n    overflowY: 'scroll'\n  },\n  button: {\n    width: '100%',\n    height: 42,\n    borderRadius: 'unset'\n  }\n}))","import React, { useContext } from 'react'\nimport {\n  Card,\n  CardActionArea,\n  CardContent,\n  Typography\n} from '@material-ui/core'\nimport { makeStyles } from '@material-ui/core/styles'\nimport AppContext from '../AppContext'\nimport { useTranslation } from 'react-i18next'\nimport { FixedSizeList as List, areEqual } from 'react-window'\nimport memorize from 'memoize-one'\nimport RouteInputPad from './RouteInputPad'\nimport { Link } from  'react-router-dom'\n\nconst RouteRow = React.memo(( {data, index, style} ) => {\n  const { t, i18n } = useTranslation()\n  const { routeList } = data\n  const route = routeList[index]\n  const [routeNo, service_type] = route[0].split('+').slice(0,2)\n  const classes = useStyles()\n\n  return (\n    <Link to={'/'+i18n.language+'/route/'+route[0]}>\n      <Card variant=\"outlined\" key={route[0]} style={style} square>\n        <CardActionArea>\n          <CardContent className={classes.cardContent}>\n            <Typography variant=\"h5\" display=\"inline\">{routeNo}</Typography>\n            <Typography variant=\"caption\"> - {route[1].co.map(co => t(co)).join('+')}</Typography>\n            <br/>\n            <Typography variant=\"subtitle2\" display=\"inline\">{t('往')} {route[1].dest[i18n.language]}  </Typography>\n            <Typography variant=\"caption\">{service_type === '2' ? t('特別班次') : '　'}</Typography>\n          </CardContent>\n        </CardActionArea>\n      </Card>\n    </Link>\n  )\n}, areEqual)\n\nconst createItemData = memorize((routeList) => ({routeList}))\n\nconst RouteList = () => {\n  const { routeList, searchRoute } = useContext(AppContext)\n  const targetRouteList = Object.entries(routeList).filter(\n    element => element[0].startsWith(searchRoute.toUpperCase())\n  ) \n\n  const itemData = createItemData(targetRouteList)\n  return (\n    <List\n      height={358}\n      itemCount={targetRouteList.length}\n      itemSize={69}\n      width=\"100%\"\n      itemData={itemData}\n    >\n        {RouteRow}\n    </List>\n  )\n}\n\nconst RouteBoard = () => {\n  return (\n    <>\n      <RouteList />\n      <hr/>\n      <RouteInputPad />\n    </>\n  )\n}\n\nexport default RouteBoard\n\nconst useStyles = makeStyles (theme => ({\n  cardContent: {\n    padding: '8px 16px',\n  }\n}))","import React, { useState, useEffect, useContext, useRef } from 'react'\nimport { useParams, useHistory } from 'react-router-dom'\nimport MuiAccordion from'@material-ui/core/Accordion'\nimport MuiAccordionSummary from'@material-ui/core/AccordionSummary'\nimport MuiAccordionDetails from'@material-ui/core/AccordionDetails'\nimport {\n  Box, CircularProgress, Typography\n} from '@material-ui/core'\nimport { makeStyles, withStyles } from '@material-ui/core/styles'\nimport AppContext from '../AppContext'\nimport { useTranslation } from 'react-i18next'\nimport { \n  fetchRouteStops as fetchRouteStopsViaApi,\n  fetchEtas as fetchEtasViaApi \n} from '../data-api'\n\nconst RouteEta = () => {\n  const { id, panel } = useParams()\n  const [ expanded, setExpanded ] = useState(false)\n  const { routeList, stopList, setRouteList, setStopList, setSelectedRoute } = useContext ( AppContext )\n  const [ route, serviceType, bound ] = id.split('+').slice(0,3)\n  const { i18n } = useTranslation()\n  const history = useHistory()\n  const accordionRef = useRef([])\n\n  const routeObj = routeList[id]\n\n  const handleChange = ( panel ) => (event, newExpanded) => {\n    setExpanded(newExpanded ? panel : false)\n    if ( newExpanded ) {\n      history.replace(`/${i18n.language}/route/${id}/${panel}`)\n    }\n  }\n\n  useEffect(() => {\n    setSelectedRoute(`${id}/${expanded}`)\n  }, [expanded])\n\n  useEffect(() => {\n    // check if stops not fetched\n    if ( routeObj.co.filter(co => routeObj.stops[co] == null).length ) {\n      // fetch in parallel\n      Promise.all(\n        routeObj.co.map(co => {\n          if ( routeObj.stops[co] !== null ) return null;\n          return fetchRouteStopsViaApi({\n            route, serviceType, bound, co\n          })\n        }).filter(v => v)\n      ).then(objs => {\n        // set stop list\n        let _stopList = {}\n        objs.forEach( obj => {\n          _stopList = {..._stopList, ...obj.stopList}\n        } )\n        setStopList({...stopList, ..._stopList})\n\n        // set route list\n        setRouteList(prevRouteList => {\n          let _routeList = JSON.parse(JSON.stringify(prevRouteList))\n          objs.forEach(obj => _routeList[id].stops[obj.co] = obj.routeStops)\n          return _routeList\n        })\n      })\n    }\n\n    if ( parseInt(panel) ) {\n      setExpanded(parseInt(panel))\n      accordionRef.current[parseInt(panel)].scrollIntoView({behavior: 'smooth', block: 'nearest'})\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  const classes = useStyles()\n\n  if ( routeObj.stops[routeObj.co[0]] == null ) {\n    return (\n      <Box className={classes.loadingContainer}>\n        <CircularProgress size={30} />\n      </Box>\n    )\n  }\n\n  return (\n    <Box className={classes.boxContainer}>\n      {\n        routeObj.stops[routeObj.co[0]].map((stop, idx) => (\n          <Accordion \n            key={'stop-'+idx} \n            expanded={expanded === idx}\n            onChange={handleChange(idx)}\n            TransitionProps={{unmountOnExit: true}}\n            ref={el => {accordionRef.current[idx] = el}}\n          >\n            <AccordionSummary>{stopList[stop].name[i18n.language]}</AccordionSummary>\n            <AccordionDetails>\n              <TimeReport \n                route={route}\n                seq={idx + 1}\n                routeStops={routeObj.stops}\n                serviceType={serviceType}\n                bound={bound}\n                co={routeList[id].co}\n                routeSize={routeObj.stops[routeObj.co[0]].length}\n              />\n            </AccordionDetails>\n          </Accordion>\n        ))\n      }\n    </Box>\n  )\n}\n\nexport default RouteEta\n\nconst TimeReport = ( { route, routeStops, seq, bound, serviceType, co, routeSize } ) => {\n  const { t, i18n } = useTranslation()\n  const [ etas, setEtas ] = useState(null)\n\n  const fetchEtas = () => {\n    const fetchData = async () => {\n      setEtas( await fetchEtasViaApi({route, routeStops, seq, bound, serviceType, co, routeSize}) )\n    }\n    fetchData()\n  }\n\n  useEffect( () => {\n    fetchEtas()\n    const fetchEtaInterval = setInterval(() => {\n      fetchEtas()\n    }, 30000)\n\n    return () => clearInterval(fetchEtaInterval)\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  if ( etas == null ) {\n    return (\n      <CircularProgress size={20} style={{}} />\n    )\n  }\n\n  const displayMsg = (eta) => {\n    let ret = ''\n    switch (eta) {\n      case null: \n        break\n      case 0: \n        ret = '- '+t('分鐘')\n        break\n      default:\n        ret = eta + \" \" + t('分鐘')\n        break\n    }\n    return ret\n  }\n  \n  return (\n    <div>\n      {\n        etas.length === 0 ? t('暫無班次') : (\n          etas.map((eta, idx) => (\n            <Typography variant=\"subtitle1\" key={`route-${idx}`}>\n              {displayMsg(eta.eta)} {eta.remark[i18n.language] ? ' - ' + eta.remark[i18n.language] : '' } {t(eta.co)}\n            </Typography>\n          ))\n        )\n      }\n    </div>\n  )\n}\n\nconst Accordion = withStyles({\n  root: {\n    border: '1px solid rgba(0, 0, 0, .125)',\n    boxShadow: 'none',\n    '&:not(:last-child)': {\n      borderBottom: 0,\n    },\n    '&:before': {\n      display: 'none',\n    },\n    '&$expanded': {\n      margin: 'auto',\n    },\n  },\n  expanded: {},\n})(MuiAccordion)\n\nconst AccordionSummary = withStyles({\n  root: {\n    backgroundColor: 'rgba(0, 0, 0, .03)',\n    borderBottom: '1px solid rgba(0, 0, 0, .125)',\n    marginBottom: -1,\n    minHeight: 56,\n    '&$expanded': {\n      minHeight: 56,\n    },\n  },\n  content: {\n    '&$expanded': {\n      margin: '12px 0',\n    },\n  },\n  expanded: {},\n})(MuiAccordionSummary);\n\nconst AccordionDetails = withStyles((theme) => ({\n  root: {\n    padding: theme.spacing(2),\n  },\n}))(MuiAccordionDetails);\n\nconst useStyles = makeStyles(theme => ({\n  boxContainer: {\n    overflowY: 'scroll'\n  },\n  loadingContainer: {\n    display: 'flex',\n    justifyContent: 'center'\n  }\n}))","import React, { useContext } from 'react'\nimport {\n  BottomNavigation,\n  BottomNavigationAction\n} from '@material-ui/core'\nimport SearchIcon from '@material-ui/icons/Search'\nimport TimerIcon from '@material-ui/icons/Timer'\nimport { Link, useLocation } from 'react-router-dom'\nimport { useTranslation } from 'react-i18next'\nimport AppContext from './AppContext'\n\nconst Footer = () => {\n  const { t, i18n } = useTranslation()\n  const location = useLocation()\n  const { selectedRoute } = useContext ( AppContext ) \n  \n  return (\n    <BottomNavigation\n      value={location.pathname}\n      showLabels={true}\n    >\n      <BottomNavigationAction \n        label={t(\"搜尋\")}\n        component={Link}\n        to={`/${i18n.language}/search`}\n        value={`/${i18n.language}/search`}\n        icon={<SearchIcon />} \n      />\n      <BottomNavigationAction\n       label={selectedRoute.split('+')[0]}\n       component={Link}\n       to={`/${i18n.language}/route/${selectedRoute}`}\n       value={`/${i18n.language}/route/${selectedRoute}`}\n       icon={<TimerIcon />} \n      />\n    </BottomNavigation>\n  )\n}\n\nexport default Footer","import './App.css'\nimport { MuiThemeProvider, createMuiTheme } from '@material-ui/core/styles'\nimport React, { useContext } from 'react'\nimport {\n  HashRouter as Router,\n  Redirect,\n  Switch,\n  Route,\n  useRouteMatch\n} from \"react-router-dom\";\nimport {\n  CircularProgress,\n  Container,\n  CssBaseline,\n  Paper,\n  Typography\n} from '@material-ui/core'\nimport {\n  makeStyles\n} from '@material-ui/core/styles'\nimport Header from './components/Header'\nimport RouteBoard from './components/RouteBoard'\nimport RouteEta from './components/RouteEta'\nimport AppContext from './AppContext'\nimport Footer from './Footer'\nimport Countdown from 'react-countdown'\n\nconst PageSwitch = () => {\n  const { path } = useRouteMatch()\n  return (\n    <Switch>\n      <Route path={`${path}/route/:id/:panel?`}>\n        <RouteEta />\n      </Route>\n      <Route path={`${path}/search`}>\n        <RouteBoard />\n      </Route>\n    </Switch>\n  )\n}\n\nconst App = () => {\n  /*\n  navigator.geolocation.getCurrentPosition(position => {\n    console.log(position.coords.latitude, position.coords.longitude)\n  })\n  */\n  const classes = useStyles()\n  const { routeList, stopList } = useContext( AppContext )\n  if ( routeList == null || stopList == null ) {\n    return (\n      <Container maxWidth='xs' disableGutters className={classes.loadingContainer}>\n        <CircularProgress size={40} />\n        <br />\n        <br />\n        <Paper className={classes.loadingTextContainer} elevation={0}>\n          <Countdown \n            date={Date.now() + 20000}\n            renderer={({seconds, completed}) => {\n              if ( completed ) {\n                return <Typography variant=\"subtitle2\" align=\"center\">介面開啟中...</Typography>\n              } else {\n                return (\n                  <>\n                    <Typography variant=\"subtitle2\" align=\"center\">初始設定...</Typography>\n                    <Typography variant=\"subtitle2\" align=\"center\">正在更新巴士路線資料...</Typography>\n                    <Typography variant=\"subtitle2\" align=\"center\">約需{seconds}秒</Typography>\n                  </>\n                )\n              }\n            }}\n          />\n            \n        </Paper>\n      </Container>\n    )\n  } \n\n  return (\n    <MuiThemeProvider theme={Theme}>\n      <Container maxWidth='xs' disableGutters className={classes.container}>\n        <Router>\n          <Route exact path=\"/\">\n            <Redirect to=\"/zh/search\" />\n          </Route>\n          <Route path=\"/:lang\">\n            <CssBaseline />\n            <Header />\n            <PageSwitch />\n            <Footer />\n          </Route>\n        </Router>\n      </Container>\n    </MuiThemeProvider>\n  );\n}\n\nexport default App;\n\nconst Theme = createMuiTheme({\n  typography: {\n    fontFamily: \"Noto Sans TC, Chivo, sans-serif\"\n  },\n  palette: {\n    background: {\n      default: \"yellow\"\n    }\n  }\n})\n\nconst useStyles = makeStyles( theme => ({\n  container: {\n    display: 'flex',\n    flexDirection: 'column',\n    justifyContent: 'space-between',\n    height: '100vh'\n  },\n  loadingContainer: {\n    display: 'flex',\n    flexDirection: 'column',\n    justifyContent: 'center',\n    alignItems: 'center',\n    height: '100vh'\n  },\n  loadingText: {\n\n  }\n}))\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import i18n from \"i18next\";\nimport { initReactI18next } from \"react-i18next\";\nimport resources from \"./i18n/translation.json\";\n\nconst DEFAULT_LANG = window.location.pathname.substr(1,2) === 'en' ? 'en' : 'zh'\n\ni18n\n  .use(initReactI18next)\n  .init({\n    resources,\n    whitelist: ['en', 'zh'],\n    lowerCaseLng: true,\n    lng: DEFAULT_LANG,\n    nsSeparator: false,\n    keySeparator: false,\n    debug: false,\n\n    interpolation:{\n      escapeValue: false\n    }\n  });\n\nexport default i18n;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\nimport { AppContextProvider } from './AppContext'\nimport './i18n'\n\nReactDOM.render(\n  //<React.StrictMode>\n    <AppContextProvider>\n      <App />\n    </AppContextProvider>\n  //</React.StrictMode>,\n  ,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}