{"version":3,"sources":["data-api/Kmb.js","data-api/Nwfb.js","data-api/Ctb.js","data-api/index.js","AppContext.js","Header.js","components/Home.js","components/RouteInputPad.js","components/RouteBoard.js","components/RouteMap.js","components/RouteEta.js","components/Settings.js","Footer.js","App.js","reportWebVitals.js","i18n.js","index.js"],"names":["KmbApi","co","fetchRouteList","fetch","then","response","json","data","reduce","routeList","element","route","service_type","bound","join","orig","en","orig_en","zh","orig_tc","dest","dest_en","dest_tc","stops","serviceType","generated_timestamp","forEach","push","stop","Object","entries","map","fetchStopList","stopList","name","name_en","nameEncodingHandling","name_tc","location","lat","parseFloat","lng","long","fetchRouteStops","fetchEtas","stopId","seq","cache","filter","e","dir","eta","Math","round","moment","diff","remark","rmk_tc","rmk_en","fetchStopEtas","rmk","NwfbApi","acc","concat","routeStops","Promise","all","CtbApi","a","_etas","company_id","kmb","length","ctb","nwfb","sort","b","Number","isInteger","api","v","checkSameRoute","route1","route2","end","name_a","toUpperCase","name_b","includes","convertRouteObj","routeObj","ret","AppContext","React","createContext","AppContextProvider","props","useState","localStorage","getItem","schemaVersion","setSchemaVersion","JSON","parse","setRouteList","setStopList","parseInt","updateTime","setUpdateTime","searchRoute","setSearchRoute","selectedRoute","setSelectedRoute","geoPermission","setGeoPermission","geolocation","setGeoLocation","hotRoute","setHotRoute","savedEtas","setSavedEtas","possibleChar","setPossibleChar","renewDb","companyRoutes","i","j","routes","list","imported","_routeList","routeNo","updateRouteList","_stopList","updateStopList","_updateTime","Date","now","setItem","useEffect","process","text","_schemaVersion","needRenew","navigator","getCurrentPosition","coords","latitude","longitude","getPossibleChar","stringify","Provider","value","updateNewlyFetchedRouteStops","routeId","objs","obj","prevRouteList","updateSearchRouteByButton","buttonValue","slice","updateSelectedRoute","prevHotRoute","updateSavedEtas","key","prevSavedEtas","k","resetUsageRecord","updateGeoPermission","state","children","startsWith","c","isNaN","useStyles","makeStyles","theme","toolbar","color","textDecoration","display","justifyContent","zIndex","drawer","searchRouteInput","maxWidth","textAlign","LanguageTabs","withStyles","root","borderBottom","minHeight","indicator","backgroundColor","Tabs","LanguageTab","textTransform","minWidth","fontWeight","marginRight","spacing","fontSize","opacity","padding","selected","wrapper","borderRadius","Tab","disableRipple","Header","useContext","path","useRouteMatch","useTranslation","t","i18n","classes","useLocation","history","useHistory","Toolbar","className","to","pathname","language","Typography","variant","Input","type","placeholder","onChange","target","disabled","lang","replace","changeLanguage","label","SuccintTimeReport","split","routeKey","etas","setEtas","isMounted","fetchData","fetchEtasViaApi","fetchRouteStopsViaApi","fetchEtaInterval","setInterval","clearInterval","getEtaString","ListItem","button","component","Link","ListItemText","primary","secondary","CircularProgress","size","routeDest","routeEta","Divider","Home","index","self","indexOf","selectedRoutes","getDistance","arr","apply","endsWith","fetchStopEtasViaApi","routeIds","prevSelectedRoutes","s","Paper","List","φ1","PI","φ2","Δφ","Δλ","aa","sin","cos","atan2","sqrt","background","height","overflowY","width","KeyButton","handleClick","Button","onClick","RouteNumPad","Grid","container","item","xs","style","RouteAlphabetPad","RouteInputPad","Box","boxContainer","numPadContainer","alphabetPadContainer","flexDirection","overflowX","RouteRow","memo","Card","square","CardActionArea","CardContent","cardContent","areEqual","createItemData","memorize","RouteList","targetRouteList","itemData","itemCount","itemSize","RouteBoard","ChangeMapCenter","center","zoom","useMap","setView","checkPosition","RouteMap","position","mapContainer","MapContainer","scrollWheelZoom","TileLayer","attribution","url","idx","Marker","Polyline","positions","getPoint","Circle","radius","isFinite","RouteEta","useParams","id","panel","expanded","setExpanded","accordionRef","useRef","handleChange","event","newExpanded","current","scrollIntoView","behavior","block","loadingContainer","align","TransitionProps","unmountOnExit","ref","el","IconButton","aria-label","TimeReport","displayMsg","Accordion","border","boxShadow","margin","MuiAccordion","AccordionSummary","marginBottom","content","MuiAccordionSummary","AccordionDetails","MuiAccordionDetails","Settings","updating","setUpdating","ListItemAvatar","Avatar","format","href","Snackbar","anchorOrigin","vertical","horizontal","open","message","Footer","BottomNavigation","showLabels","BottomNavigationAction","icon","PageSwitch","App","Container","disableGutters","loadingTextContainer","elevation","date","renderer","seconds","completed","Theme","exact","CssBaseline","createMuiTheme","typography","fontFamily","palette","default","alignItems","loadingText","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","DEFAULT_LANG","window","substr","use","initReactI18next","init","resources","whitelist","lowerCaseLng","nsSeparator","keySeparator","debug","interpolation","escapeValue","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.e3225138.chunk.js","sourcesContent":["import moment from 'moment'\n\nconst KmbApi = {\n  co: 'kmb',\n  fetchRouteList: () => (\n    // fetch route data\n    fetch(\n      \"https://data.etabus.gov.hk/v1/transport/kmb/route/\"\n    ).then(\n      response => response.json()\n    ).then( ({data}) => \n      data.reduce( (routeList, element) => {\n        routeList[[element.route, element.service_type, element.bound].join('+')] = {\n          route: element.route,\n          co: 'kmb',\n          bound: element.bound,\n          orig: {\n            en: element.orig_en,\n            zh: element.orig_tc\n          },\n          dest: {\n            en: element.dest_en,\n            zh: element.dest_tc\n          },\n          stops: [],\n          serviceType: element.service_type\n        }\n        return routeList\n      }, {})\n    ).then( routeList => (\n      // fetch route stop data\n      fetch(\"https://data.etabus.gov.hk/v1/transport/kmb/route-stop/\").then(response => response.json())\n      .then(({data, generated_timestamp}) => {\n        data.forEach(element => {\n          routeList[[element.route, element.service_type, element.bound].join('+')].stops.push(\n            element.stop\n          )\n        })\n        return Object.entries(routeList).map(([id, obj]) => obj)\n      })\n    ))\n  ),\n  fetchStopList: () => {\n    return fetch(\"https://data.etabus.gov.hk/v1/transport/kmb/stop\").then(\n      response => response.json()\n    ).then(({data, generated_timestamp}) => {\n      let stopList = {}\n      data.forEach(element => {\n        stopList[element.stop] = {\n          name: {\n            en: element.name_en,\n            zh: nameEncodingHandling( element.name_tc )\n          },\n          location: {\n            lat: parseFloat(element.lat),\n            lng: parseFloat(element.long)\n          }\n        }\n      })\n      \n      return stopList\n    })\n  },\n  fetchRouteStops: ({route, bound, serviceType}) => {\n    // already fetched in the app start\n    return null\n  },\n  /*\n    @fetchEtas\n    return array of Object with props {\n      eta: (int) minute or null,\n      remark: {\n        zh: string\n        en: string\n      }\n    }\n  */\n  fetchEtas: ({stopId, route, seq, serviceType, bound}) => {\n    return fetch(\n      `https://data.etabus.gov.hk/v1/transport/kmb/eta/${stopId}/${route}/${serviceType}`,\n      { cache: \"no-store\" }\n    ).then( response => response.json() )\n    .then(({data}) => data.filter(e => e.dir === bound && e.seq === seq).map(e => ({\n        eta: e.eta ? Math.round(moment(e.eta).diff(moment()) / 60 / 1000) : e.eta,\n        remark: {\n          zh: e.rmk_tc,\n          en: e.rmk_en\n        },\n        co: 'kmb'\n      }))\n    )\n  },\n  fetchStopEtas: ( stopId ) => (\n    fetch(`https://data.etabus.gov.hk/v1/transport/kmb/stop-eta/${stopId}`, { cache: \"no-store\" })\n    .then(response => response.json())\n    .then(({data}) => data.map( e => ({\n      route: e.route,\n      bound: e.dir,\n      seq: e.seq,\n      eta: e.eta ? Math.round(moment(e.eta).diff(moment()) / 60 / 1000) : e.eta,\n      dest: {\n        zh: e.dest_tc,\n        en: e.dest_en\n      },\n      remark: {\n        zh: e.rmk,\n        en: e.rmk\n      },\n      co: 'kmb'\n    })))\n  )\n}\n\nexport default KmbApi\n\nconst nameEncodingHandling = (name) => {\n  if ( name === '瘝嗵眎�𧨾���' ) return '沙田坳道'\n  else if ( name === '暺�憭找�嗵��' ) return '黃大仙站'\n  else return name\n}","import moment from 'moment'\n\nconst NwfbApi = {\n  co: 'nwfb',\n  fetchRouteList: () => (\n    fetch(\"https://rt.data.gov.hk/v1/transport/citybus-nwfb/route/nwfb\")\n      .then(response => response.json())\n      .then(({data}) => (\n        data.reduce((acc, element) => (\n          acc.concat([ {\n            route: element.route,\n            bound: 'O',\n            orig: {\n              en: element.orig_en,\n              zh: element.orig_tc\n            },\n            dest: {\n              en: element.dest_en,\n              zh: element.dest_tc\n            },\n            co: 'nwfb',\n            stops: null,\n            serviceType: 1\n          },{\n            route: element.route,\n            bound: 'I',\n            orig: {\n              en: element.dest_en,\n              zh: element.dest_tc\n            },\n            dest: {\n              en: element.orig_en,\n              zh: element.orig_tc\n            },\n            co: 'nwfb',\n            stops: null,\n            serviceType: 1\n          }])\n        ), [])\n      ))\n  ),\n  fetchRouteStops: ({route, bound}) => {\n    if ( !bound ) return null // route not exist in this company\n    const dir = bound === 'I' ? 'inbound' : 'outbound'\n    return fetch(\n      `https://rt.data.gov.hk/v1/transport/citybus-nwfb/route-stop/NWFB/${route}/${dir}`\n    ).then( response => \n      response.json()\n    ).then( ({data}) => \n      data.map(e => e.stop) \n    ).then( routeStops => {\n      // fetch each stop in parallel\n      return Promise.all(routeStops.map(stopId => \n          fetch(`https://rt.data.gov.hk/v1/transport/citybus-nwfb/stop/${stopId}`).then(\n            response => response.json()\n          ).then ( ({data}) => ({\n            stopId: stopId,\n            name: {\n              zh: data.name_tc,\n              en: data.name_en\n            },\n            location: {\n              lat: parseFloat(data.lat),\n              lng: parseFloat(data.long)\n            }\n          }))\n        )).then( stops => {\n          let stopList = {};\n          stops.forEach(stop => stopList[stop.stopId] = stop)\n          return {routeStops, stopList, co: 'nwfb'}\n        })\n    })\n  },\n  fetchEtas: ({stopId, route, bound }) => (\n    fetch(`https://rt.data.gov.hk/v1/transport/batch/stop-eta/NWFB/${stopId}?lang=zh-hant`, { cache: \"no-store\" }).then(\n      response => response.json()\n    ).then(({data}) => data.filter(eta => eta.eta && eta.route === route && eta.dir === bound && eta.eta).map(e => ({\n        eta: e.eta ? Math.round(moment(e.eta).diff(moment()) / 60 / 1000) : e.eta,\n        remark: {\n          zh: e.rmk,\n          en: e.rmk\n        },\n        co: 'nwfb'\n      }))\n    )\n  )\n}\n\nexport default NwfbApi","import moment from 'moment'\n\nconst CtbApi = {\n  co: 'ctb',\n  fetchRouteList: () => (\n    fetch(\"https://rt.data.gov.hk/v1/transport/citybus-nwfb/route/ctb\")\n      .then(response => response.json())\n      .then(({data}) => (\n        data.reduce((acc, element) => (\n          acc.concat([ {\n            route: element.route,\n            bound: 'O',\n            orig: {\n              en: element.orig_en,\n              zh: element.orig_tc\n            },\n            dest: {\n              en: element.dest_en,\n              zh: element.dest_tc\n            },\n            co: 'ctb',\n            stops: null,\n            serviceType: 1\n          },{\n            route: element.route,\n            bound: 'I',\n            orig: {\n              en: element.dest_en,\n              zh: element.dest_tc\n            },\n            dest: {\n              en: element.orig_en,\n              zh: element.orig_tc\n            },\n            co: 'ctb',\n            stops: null,\n            serviceType: 1\n          }])\n        ), [])\n      ))\n  ),\n  fetchRouteStops: ({route, bound}) => {\n    if ( !bound ) return null // route not exist in this company\n    const dir = bound === 'I' ? 'inbound' : 'outbound'\n    return fetch(\n      `https://rt.data.gov.hk/v1/transport/citybus-nwfb/route-stop/CTB/${route}/${dir}`\n    ).then( response => \n      response.json()\n    ).then( ({data}) => \n      data.map(e => e.stop) \n    ).then( routeStops => {\n      // fetch each stop in parallel\n      return Promise.all(routeStops.map(stopId => \n          fetch(`https://rt.data.gov.hk/v1/transport/citybus-nwfb/stop/${stopId}`).then(\n            response => response.json()\n          ).then ( ({data}) => ({\n            stopId: stopId,\n            name: {\n              zh: data.name_tc,\n              en: data.name_en\n            },\n            location: {\n              lat: parseFloat(data.lat),\n              lng: parseFloat(data.long)\n            }\n          }))\n        )).then( stops => {\n          let stopList = {};\n          stops.forEach(stop => stopList[stop.stopId] = stop)\n          return {routeStops, stopList, co: 'ctb'}\n        })\n    })\n  },\n  fetchEtas: ({stopId, route, bound }) => {\n    return fetch(`https://rt.data.gov.hk/v1/transport/batch/stop-eta/CTB/${stopId}?lang=zh-hant`, { cache: \"no-store\" }).then(\n      response => response.json()\n    ).then(({data}) => data.filter(eta => eta.eta && eta.route === route && eta.dir === bound).map(e => ({\n        eta: e.eta ? Math.round(moment(e.eta).diff(moment()) / 60 / 1000) : e.eta,\n        remark: {\n          zh: e.rmk,\n          en: e.rmk\n        },\n        co: 'ctb'\n      }))\n    )\n  },\n  fetchStopEtas: ( stopId ) => (\n    fetch(`https://rt.data.gov.hk/v1/transport/batch/stop-eta/CTB/${stopId}?lang=zh-hant`, { cache: \"no-store\" })\n    .then(response => response.json())\n    .then(({data}) => data.map( e => ({\n      eta: e.eta ? Math.round(moment(e.eta).diff(moment()) / 60 / 1000) : e.eta,\n      remark: {\n        zh: e.rmk,\n        en: e.rmk\n      },\n      co: 'ctb'\n    })) )\n  )\n}\n\nexport default CtbApi","import KmbApi from './Kmb'\nimport NwfbApi from './Nwfb'\nimport CtbApi from './Ctb'\n\nconst fetchEtas = async ( {route, routeStops, bound, seq, serviceType, co }) => {\n  let _etas = []\n  for ( const company_id of co ) {\n    if (company_id === 'kmb' && routeStops.kmb ){\n      _etas = _etas.concat( await KmbApi.fetchEtas({\n        route,\n        stopId: routeStops.kmb[seq-1], \n        seq: (seq === routeStops.kmb.length ? 1000 : seq), \n        serviceType, bound: bound[company_id]}) \n      )\n    }\n    else if ( company_id === 'ctb' && routeStops.ctb ) {\n      _etas = _etas.concat( await CtbApi.fetchEtas({stopId: routeStops.ctb[seq-1], route, bound: bound[company_id] }))\n    }\n    else if ( company_id === 'nwfb' && routeStops.nwfb ) {\n      _etas = _etas.concat( await NwfbApi.fetchEtas({stopId: routeStops.nwfb[seq-1], route, bound: bound[company_id] }))\n    }\n  }\n\n  return _etas.sort((a,b) => { \n    if ( !a.eta ) return 1\n    else if (!b.eta) return -1\n    return a.eta < b.eta ? -1 : 1\n  }).filter(e => !Number.isInteger(e.eta) || e.eta > 1 )\n}\n\nconst fetchRouteStops = ( {route, bound, stops} ) => (\n  Promise.all([KmbApi, NwfbApi, CtbApi].map(api => \n    !stops[api.co] ? api.fetchRouteStops( { route, bound: bound[api.co] } ) : null\n  ).filter(v => v))\n)\n\nconst checkSameRoute = (route1, route2) => (\n  route1.route === route2.route && route1.co !== route2.co && ['orig', 'dest'].map ( end => {\n    // check if either orig or dest name is the same\n    const name_a = route1[end].en.toUpperCase()\n    const name_b = route2[end].en.toUpperCase()\n    return name_a.includes(name_b) || name_b.includes(name_a)\n  }).includes(true)\n)\n\nconst convertRouteObj = (routeObj) => {\n  let ret = {\n    route: routeObj.route,\n    co: [routeObj.co],\n    bound: {},\n    orig: {\n      en: routeObj.orig.en,\n      zh: routeObj.orig.zh\n    },\n    dest: {\n      en: routeObj.dest.en,\n      zh: routeObj.dest.zh\n    },\n    stops: {},\n    serviceType: routeObj.serviceType\n  }\n  ret.stops[routeObj.co] = routeObj.stops\n  ret.bound[routeObj.co] = routeObj.bound\n  return ret\n}\n\nconst fetchRouteList = () => (\n  Promise.all([KmbApi, NwfbApi, CtbApi].map(api => api.fetchRouteList()))\n  .then( companyRoutes => {\n    let routeList = {}\n    const routes = companyRoutes.reduce((acc, list) => acc.concat(list)).sort((a, b) => {\n      return a.route < b.route ? -1 : 0\n    })\n    let i, j\n    for ( i = 0; i < routes.length; ++i ){\n      // ignore imported routes\n      if ( routes[i].imported ) continue\n      let routeObj = convertRouteObj(routes[i])\n      for ( j = i + 1; j < routes.length; ++j ) {\n        if ( routes[i].route !== routes[j].route ) break\n        if ( routes[j].imported ) continue\n        if ( checkSameRoute(routes[i], routes[j]) ) {\n          routeObj.co.push(routes[j].co)\n          routeObj.stops[routes[j].co] = routes[j].stops\n          routeObj.bound[routes[j].co] = routes[j].bound\n          // mark imported\n          routes[j].imported = true\n        }\n      }\n      \n      routeList[`${routeObj.route}+${routeObj.serviceType}+${routeObj.orig.en}+${routeObj.dest.en}`] = routeObj\n    }\n    \n    // sort the routeList by route no.\n    let _routeList = routeList\n    routeList = {}\n    Object.entries(_routeList).sort((a,b) => (a[0] < b[0] ? -1 : 1)).forEach(([routeNo, route]) => {\n      routeList[routeNo] = route\n    })\n\n    return routeList\n  })\n)\n\nconst fetchStopEtas = ( stopId, routeList ) => (\n  // [KmbApi, NwfbApi, CtbApi].map( api => (\n  Promise.all([KmbApi].map( api => \n    api.fetchStopEtas(stopId)\n  )).then(arr => [].concat.apply([], arr))\n  .then(etas => \n    Object.entries(routeList)\n    .map( ([routeId]) => {\n      for ( const eta of etas) {\n        if (routeId.startsWith(`${eta.route}+`) && routeId.endsWith(`+${eta.dest.en}`)) {\n          return `${routeId}/${eta.seq-1}`\n        } \n      }\n      return null\n    }).filter(routeId => routeId)\n  )\n)\n\nexport { KmbApi, NwfbApi, CtbApi, fetchEtas, fetchRouteStops, fetchRouteList, fetchStopEtas }","import React, { useEffect, useState } from 'react'\nimport { KmbApi, fetchRouteList } from './data-api'\n\nconst AppContext = React.createContext()\n\nexport const AppContextProvider = ( props ) => {\n  const [schemaVersion, setSchemaVersion] = useState(localStorage.getItem('schemaVersion'))\n  // route list & stop list & route-stop list\n  const [routeList, setRouteList] = useState(JSON.parse(localStorage.getItem('routeList')))\n  const [stopList, setStopList] = useState(JSON.parse(localStorage.getItem('stopList')))\n  const [updateTime, setUpdateTime] = useState(parseInt(localStorage.getItem('updateTime')))\n  // search route\n  const [searchRoute, setSearchRoute] = useState(\"\")\n  // selected route for bottom navigation shortcut\n  const [selectedRoute, setSelectedRoute] = useState('1+1+CHUK YUEN ESTATE+STAR FERRY')\n  // Geo Permission for UX\n  const [ geoPermission, setGeoPermission ] = useState( localStorage.getItem('geoPermission') ) \n  const [ geolocation, setGeoLocation ] = useState (JSON.parse(localStorage.getItem('geolocation')) || {lat: 22.302711, lng: 114.177216})\n\n  // hot query count\n  const [ hotRoute, setHotRoute ] = useState( JSON.parse(localStorage.getItem('hotRoute')) || {} )\n  const [ savedEtas, setSavedEtas ] = useState ( JSON.parse(localStorage.getItem('savedEtas')) || [] )\n\n  // possible Char for RouteInputPad\n  const [possibleChar, setPossibleChar] = useState([])\n  \n  const renewDb = () => {\n    fetchRouteList().then( _routeList => updateRouteList(_routeList) ).then(() =>\n      // fetch only KMB stop list as the api return is succinct enough\n      // on-the-fly fetching for other service providers' stops\n      KmbApi.fetchStopList().then( _stopList => {\n        updateStopList(_stopList)\n        const _updateTime = Date.now()\n        setUpdateTime ( _updateTime )\n        localStorage.setItem('updateTime', _updateTime)\n      } )\n    )\n  }\n\n  useEffect(() => {\n    // check app version and flush localstorage if outdated\n    fetch( process.env.PUBLIC_URL + '/schema-version.txt').then(\n      response => response.text()\n    ).then( _schemaVersion => {\n      let needRenew = false\n      if ( schemaVersion !== _schemaVersion ) {\n        setSchemaVersion(_schemaVersion)\n        localStorage.setItem('schemaVersion', _schemaVersion)\n        needRenew = true\n      }\n      needRenew = needRenew || routeList == null || stopList == null || updateTime == null || updateTime < Date.now() - 7 * 24 * 60 * 60 * 1000\n      if (needRenew) {\n        renewDb()\n      }\n    })\n\n    if ( geoPermission === 'granted' ) {\n      navigator.geolocation.getCurrentPosition(({coords: {latitude, longitude}}) => {\n        setGeoLocation({lat: latitude, lng: longitude})\n      })\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  useEffect(() => {\n    if ( geoPermission === 'granted' ) {\n      navigator.geolocation.getCurrentPosition(({coords: {latitude, longitude}}) => {\n        setGeoLocation({lat: latitude, lng: longitude})\n      })\n    }\n  }, [geoPermission])\n\n  useEffect(() => {\n    setPossibleChar(getPossibleChar(searchRoute, routeList))\n  }, [searchRoute, routeList])\n\n  useEffect(() => {\n    localStorage.setItem('savedEtas', JSON.stringify(savedEtas))\n  }, [savedEtas])\n\n  useEffect(() => {\n    localStorage.setItem('stopList', JSON.stringify(stopList))\n  }, [stopList])\n\n  useEffect(() => {\n    localStorage.setItem('routeList', JSON.stringify(routeList))\n  }, [routeList])\n\n  useEffect(() => {\n    localStorage.setItem('geolocation', JSON.stringify(geolocation))\n  }, [geolocation])\n\n  useEffect(() => {\n    localStorage.setItem('geoPermission', geoPermission)\n  }, [geoPermission])\n\n  const updateStopList = (_stopList) => {\n    setStopList(_stopList)\n  }\n\n  const updateRouteList = (_routeList) => {\n    if ( typeof(_routeList) === 'function' ) {\n      _routeList = _routeList(routeList)\n    }\n    setRouteList(_routeList)\n  }\n\n  const updateNewlyFetchedRouteStops = ( routeId, objs ) => {\n    if ( objs.length === 0 ) return\n    // set stop list\n    let _stopList = {}\n    objs.forEach( obj => {\n      _stopList = {..._stopList, ...obj.stopList}\n    } )\n    updateStopList({...stopList, ..._stopList})\n\n    // set route list\n    updateRouteList(prevRouteList => {\n      let _routeList = JSON.parse(JSON.stringify(prevRouteList))\n      objs.forEach(obj => _routeList[routeId].stops[obj.co] = obj.routeStops)\n      return _routeList\n    })\n  }\n\n  const updateSearchRouteByButton = (buttonValue) => {\n    switch (buttonValue) {\n      case 'b': \n        setSearchRoute(searchRoute.slice(0,-1))\n        break\n      case '-':\n        setSearchRoute('')\n        break\n      default: \n        setSearchRoute(searchRoute+buttonValue)\n    }\n  }\n\n  const updateGeoPermission = ( state ) => {\n    setGeoPermission(state)\n  }\n\n  const updateSelectedRoute = ( route, seq = '' ) => {\n    setSelectedRoute ( `${route}/${seq}` )\n    if ( seq ) {\n      setHotRoute( prevHotRoute => {\n        prevHotRoute[route+'/'+seq] = hotRoute[route+'/'+seq] ? hotRoute[route+'/'+seq] + 1 : 1\n        localStorage.setItem('hotRoute', JSON.stringify(prevHotRoute))\n        return prevHotRoute\n      })\n    }\n  }\n\n  const updateSavedEtas = ( key ) => {\n    setSavedEtas ( prevSavedEtas => {\n      if ( prevSavedEtas.includes(key) ) return prevSavedEtas.filter(k => k !== key)\n      else return prevSavedEtas.concat(key)\n    })\n  }\n\n  const resetUsageRecord = () => {\n    setHotRoute({})\n    setGeoLocation(null)\n    setSavedEtas([])\n  }\n\n  return (\n    <AppContext.Provider value={{\n        routeList, stopList, updateNewlyFetchedRouteStops,\n        searchRoute, setSearchRoute, updateSearchRouteByButton,\n        selectedRoute, updateSelectedRoute,\n        possibleChar,\n        // UX\n        hotRoute, geolocation,\n        savedEtas, updateSavedEtas,\n        resetUsageRecord,\n        // settings\n        renewDb, schemaVersion, updateTime,\n        geoPermission, updateGeoPermission \n      }}\n    >\n      {props.children}\n    </AppContext.Provider>\n  )\n}\n\nexport default AppContext\n\nconst getPossibleChar = ( searchRoute, routeList ) => {\n  if ( routeList == null ) return []\n  let possibleChar = {}\n  Object.entries(routeList).forEach(route => {\n    if ( route[0].startsWith(searchRoute.toUpperCase()) ) {\n      let c = route[0].slice(searchRoute.length, searchRoute.length+1)\n      possibleChar[c] = isNaN(possibleChar[c]) ? 1 : ( possibleChar[c] + 1)\n    }\n  })\n  return Object.entries(possibleChar).map(k => k[0]).filter(k => k !== '+')\n}","import React, { useContext } from \"react\"\nimport {\n  Input,\n  Tabs,\n  Tab,\n  Toolbar,\n  Typography\n} from \"@material-ui/core\"\nimport { withStyles, makeStyles } from '@material-ui/core/styles'\nimport { useLocation, useHistory, Link } from 'react-router-dom'\nimport { useTranslation } from 'react-i18next'\nimport { useRouteMatch } from 'react-router-dom'\nimport AppContext from './AppContext'\n\nconst Header = (props) => {\n  const { searchRoute, setSearchRoute } = useContext( AppContext )\n  \n  const { path } = useRouteMatch()\n  const { t, i18n } = useTranslation()\n  const classes = useStyles()\n  let location = useLocation()\n  const history = useHistory()\n\n  const handleLanguageChange = lang => {\n    history.replace( location.pathname.replace('/'+i18n.language+'/', '/'+lang+'/') )\n    i18n.changeLanguage(lang)\n  }\n\n  return (\n    <Toolbar\n      className={classes.toolbar}\n    >\n      <Link\n        to={{\n          pathname: `/${i18n.language}/search`\n        }}\n      >\n        <Typography variant=\"h6\">香港</Typography>\n        <Typography variant='subtitle2'>獨立巴士預報</Typography>\n      </Link> \n      <Input \n        className={classes.searchRouteInput}\n        type=\"text\"\n        value={searchRoute}\n        placeholder={t('巴士線')}\n        onChange={e => setSearchRoute(e.target.value)}\n        disabled={path.includes('route')}\n      />\n      <LanguageTabs\n          value={i18n.language}\n          onChange={(e, v) => handleLanguageChange(v)}\n        >\n        <LanguageTab value=\"en\" label=\"En\" />\n        <LanguageTab value=\"zh\" label=\"繁\" />\n      </LanguageTabs>\n    </Toolbar>\n  );\n}\n\nconst useStyles = makeStyles(theme => ({\n  toolbar: {\n    '& a': {\n      color: 'black',\n      textDecoration: 'none',\n    },\n    display: 'flex',\n    justifyContent: 'space-between',\n    zIndex: theme.zIndex.drawer * 2\n  },\n  searchRouteInput: {\n    maxWidth: '50px',\n    \"& input\": {\n      textAlign: 'center'\n    }\n  }\n}))\n\nconst LanguageTabs = withStyles({\n  root: {\n    borderBottom: 'none',\n    minHeight: 24\n  },\n  indicator: {\n    backgroundColor: 'transparent'\n  }\n})(Tabs);\n\nconst LanguageTab = withStyles((theme) => ({\n  root: {\n    textTransform: 'none',\n    minWidth: 36,\n    fontWeight: 900,\n    marginRight: theme.spacing(0),\n    fontSize: '15px',\n    opacity: 1,\n    padding: '6px 6px'\n  },\n  selected:{\n    '& > .MuiTab-wrapper':{\n      color: '#3B3C45',\n      backgroundColor: '#FEFBFA'\n    }\n  },\n  wrapper: {\n    color: '#3B3C45',\n    borderRadius: '30px',\n    padding: '2px 10px 0px 10px'\n  }\n}))((props) => <Tab disableRipple {...props} />);\n\nexport default Header;","import React, { useContext, useEffect, useState } from 'react'\nimport {\n  CircularProgress,\n  Divider,\n  List,\n  ListItem,\n  ListItemText,\n  Paper\n} from '@material-ui/core'\nimport { Link } from 'react-router-dom'\nimport { makeStyles } from '@material-ui/core/styles'\nimport AppContext from '../AppContext'\nimport { useTranslation } from 'react-i18next'\nimport { \n  fetchEtas as fetchEtasViaApi, \n  fetchRouteStops as fetchRouteStopsViaApi,\n  fetchStopEtas as fetchStopEtasViaApi\n} from '../data-api'\n\nconst SuccintTimeReport = ({routeId} ) => {\n  const { t, i18n } = useTranslation()\n  const { routeList, stopList, updateNewlyFetchedRouteStops } = useContext ( AppContext )\n  const [ routeNo, serviceType ] = routeId.split('+')\n  const [ routeKey, seq ] = routeId.split('/')\n  const { co, stops, dest, bound } = routeList[routeKey]\n  const stop = stopList[stops[co[0]] ? stops[co[0]][seq] : null]\n  const [ etas, setEtas ] = useState(null)\n  const classes = useStyles()\n\n  useEffect(() => {\n    let isMounted = true\n    const fetchData = () => (\n      fetchEtasViaApi({\n        route: routeNo, routeStops: stops, seq: parseInt(seq) + 1, bound, serviceType, co\n      }).then ( _etas => {\n        if (isMounted) setEtas(_etas)\n      })\n    )\n    // fetch stops\n    fetchRouteStopsViaApi({route: routeNo, bound}).then( objs => {\n      updateNewlyFetchedRouteStops(routeKey, objs)\n      fetchData()\n    })\n    const fetchEtaInterval = setInterval(() => {\n      fetchData()\n    }, 30000)\n\n    return () => {\n      isMounted = false\n      clearInterval(fetchEtaInterval)\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  const getEtaString = (eta) => {\n    if ( !eta ) return ''\n    let ret = ''\n    switch (eta.eta) {\n      case null: \n        ret = eta.remark[i18n.language]\n        break\n      case 0: \n        ret = '- '+t('分鐘')\n        break\n      default:\n        ret = eta.eta + \" \" + t('分鐘')\n        break\n    }\n    return ret\n  }\n\n  return (\n    <>\n    <ListItem\n      button\n      component={Link}\n      to={`/${i18n.language}/route/${routeId}`}\n    >\n      <ListItemText \n        primary={routeNo} \n        className={classes.route}\n      />\n      <ListItemText \n        primary={t('往')+' '+dest[i18n.language]}\n        secondary={stop ? stop.name[i18n.language] : <CircularProgress size={15} />} \n        className={classes.routeDest}\n      />\n      <ListItemText\n        primary={etas ? getEtaString(etas[0]) : ''}\n        secondary={etas ? getEtaString(etas[1]) : ''}\n        className={classes.routeEta}\n      />\n    </ListItem>\n    <Divider />\n    </>\n  )\n}\n\nconst Home = () => {\n  const { hotRoute, savedEtas, geoPermission, geolocation, routeList, stopList } = useContext ( AppContext )\n\n  const [selectedRoutes, setSelectedRoute] = useState(\n    savedEtas.concat(\n      Object.entries(hotRoute).filter(([route, count]) => count > 5)\n      .sort((a,b) => b[1] - a[1])\n      .map(([routeId]) => routeId)\n    ).filter((routeId, index, self) => self.indexOf(routeId) === index)\n    .slice(0,20)\n  )\n\n  useEffect (() => {\n    if ( geoPermission === 'granted') {\n      Object.entries(stopList).map(stop => \n        // potentially could be optimized by other distance function\n        stop.concat(getDistance(stop[1].location, geolocation))\n      ).filter(stop => \n        // keep only nearby 200m stops\n        stop[2] < 200\n      ).sort((a, b) => \n        a[2] - b[2]\n      ).slice(0, 3).map(([stopId]) => \n        fetchStopEtasViaApi(stopId, routeList).then(routeIds => {\n          setSelectedRoute(prevSelectedRoutes =>   \n            prevSelectedRoutes.concat(routeIds).filter( (v, i, s) => s.indexOf(v) === i )\n          )\n        })\n      )\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [geolocation])\n\n  const classes = useStyles()\n  return (\n    <Paper className={classes.root}>\n      <List>\n      {\n        selectedRoutes.map( selectedRoute => <SuccintTimeReport key={selectedRoute} routeId={selectedRoute} /> )\n      }\n      </List>\n    </Paper>\n  )\n}\n\nexport default Home\n\nconst getDistance = (a, b) => {\n  const R = 6371e3; // metres\n  const φ1 = a.lat * Math.PI/180; // φ, λ in radians\n  const φ2 = b.lat * Math.PI/180;\n  const Δφ = (b.lat-a.lat) * Math.PI/180;\n  const Δλ = (b.lng-a.lng) * Math.PI/180;\n\n  const aa = Math.sin(Δφ/2) * Math.sin(Δφ/2) +\n            Math.cos(φ1) * Math.cos(φ2) *\n            Math.sin(Δλ/2) * Math.sin(Δλ/2);\n  const c = 2 * Math.atan2(Math.sqrt(aa), Math.sqrt(1-aa));\n  return R * c; // in metres\n}\n\nconst useStyles = makeStyles ( theme => ({\n  root: {\n    background: 'white',\n    height: 'calc(100vh - 120px)',\n    overflowY: 'scroll'\n  },\n  route: {\n    width: '15%'\n  },\n  routeDest: {\n    width: '65%'\n  },\n  routeEta: {\n    width: '20%'\n  }\n}))\n\n","import React, { useContext } from 'react'\nimport { \n  Box,\n  Button,\n  Grid\n} from '@material-ui/core'\nimport {\n  makeStyles\n} from '@material-ui/styles'\nimport BackspaceOutlinedIcon from '@material-ui/icons/BackspaceOutlined';\n\nimport AppContext from '../AppContext'\nimport { useTranslation } from 'react-i18next';\n\nconst KeyButton = ({k, handleClick, disabled = false}) => {\n  const classes = useStyles()\n  const { t } = useTranslation()\n  return (\n    <Button \n      size=\"large\"\n      variant=\"contained\" \n      className={classes.button}\n      onClick={() => handleClick(k)}\n      disabled={disabled}\n    >\n      {k === 'b' ? <BackspaceOutlinedIcon/> : \n        k === '-' ? t('取消') : k}\n    </Button>\n  )\n}\n\nconst RouteNumPad = () => {\n  const { searchRoute, updateSearchRouteByButton, possibleChar } = useContext( AppContext )\n\n  return (\n    <Grid container spacing={0}>\n    {\n      '789456123-0b'.split('').map( k => (\n        <Grid item xs={4} key={'input-'+k}>\n          <KeyButton\n            k={k}\n            handleClick={updateSearchRouteByButton}\n            style={{fontSize: '0.6rem'}}\n            disabled={\n              (k === 'b' && searchRoute === '') \n              || ( !'b-'.includes(k) && !possibleChar.includes(k))\n              || ( k === '-' && searchRoute === '' )\n            }\n          />\n        </Grid>\n      ))\n    }\n    </Grid>\n  )\n}\n\nconst RouteAlphabetPad = () => {\n  const { updateSearchRouteByButton, possibleChar } = useContext( AppContext )\n  \n  return (\n    <Grid container spacing={1}>\n      {\n        possibleChar.filter(k => isNaN(k)).map(k => (\n          <Grid item xs={12} key={'input-'+k}>\n            <KeyButton\n              k={k}\n              handleClick={updateSearchRouteByButton}\n            />\n          </Grid>\n        )) \n      }\n    </Grid>\n  )\n}\n\nconst RouteInputPad = () => {\n\n  const classes = useStyles()\n  const padding = 0\n\n  return (\n    <Box className={classes.boxContainer} padding={padding}>\n      <Box className={classes.numPadContainer} padding={padding}>\n        <RouteNumPad />\n      </Box>\n      <Box className={classes.alphabetPadContainer} padding={padding}>\n        <RouteAlphabetPad />\n      </Box>\n    </Box>\n  )\n}\n\nexport default RouteInputPad\n\nconst useStyles = makeStyles(theme => ({\n  boxContainer: {\n    display: 'flex',\n    flexDirection: 'row',\n    height: '180px',\n    justifyContent: 'space-around'\n  },\n  numPadContainer: {\n    width: '60%',\n  },\n  alphabetPadContainer: {\n    width: '20%',\n    height: '100%',\n    overflowX: 'hidden',\n    overflowY: 'scroll'\n  },\n  button: {\n    width: '100%',\n    height: 42,\n    borderRadius: 'unset'\n  }\n}))","import React, { useContext } from 'react'\nimport {\n  Card,\n  CardActionArea,\n  CardContent,\n  Typography\n} from '@material-ui/core'\nimport { makeStyles } from '@material-ui/core/styles'\nimport AppContext from '../AppContext'\nimport { useTranslation } from 'react-i18next'\nimport { FixedSizeList as List, areEqual } from 'react-window'\nimport memorize from 'memoize-one'\nimport RouteInputPad from './RouteInputPad'\nimport { Link } from  'react-router-dom'\n\nconst RouteRow = React.memo(( {data, index, style} ) => {\n  const { t, i18n } = useTranslation()\n  const { routeList } = data\n  const route = routeList[index]\n  const [routeNo, service_type] = route[0].split('+').slice(0,2)\n  const classes = useStyles()\n\n  return (\n    <Link to={'/'+i18n.language+'/route/'+route[0]}>\n      <Card variant=\"outlined\" key={route[0]} style={style} square>\n        <CardActionArea>\n          <CardContent className={classes.cardContent}>\n            <Typography variant=\"h5\" display=\"inline\">{routeNo}</Typography>\n            <Typography variant=\"caption\"> - {route[1].co.map(co => t(co)).join('+')}</Typography>\n            <br/>\n            <Typography variant=\"subtitle2\" display=\"inline\">{t('往')} {route[1].dest[i18n.language]}  </Typography>\n            <Typography variant=\"caption\">{service_type >= '2' ? t('特別班次') : '　'}</Typography>\n          </CardContent>\n        </CardActionArea>\n      </Card>\n    </Link>\n  )\n}, areEqual)\n\nconst createItemData = memorize((routeList) => ({routeList}))\n\nconst RouteList = () => {\n  const { routeList, searchRoute } = useContext(AppContext)\n  const targetRouteList = Object.entries(routeList).filter(\n    element => element[0].startsWith(searchRoute.toUpperCase())\n  ) \n\n  const itemData = createItemData(targetRouteList)\n  return (\n    <List\n      height={330}\n      itemCount={targetRouteList.length}\n      itemSize={69}\n      width=\"100%\"\n      itemData={itemData}\n    >\n        {RouteRow}\n    </List>\n  )\n}\n\nconst RouteBoard = () => {\n  return (\n    <>\n      <RouteList />\n      <hr/>\n      <RouteInputPad />\n    </>\n  )\n}\n\nexport default RouteBoard\n\nconst useStyles = makeStyles (theme => ({\n  cardContent: {\n    padding: '8px 16px',\n  }\n}))","import { useContext } from 'react'\nimport { MapContainer, TileLayer, Marker, Polyline, Circle, useMap } from 'react-leaflet'\nimport { Box } from '@material-ui/core'\nimport { makeStyles } from '@material-ui/core/styles'\nimport AppContext from '../AppContext'\n\nconst ChangeMapCenter =  ( {center, zoom} ) => {\n  const map = useMap()\n  map.setView( checkPosition(center), 16)\n  return <></>\n}\n\nconst RouteMap = ({stops, stopList, position}) => {\n  const { geolocation, geoPermission } = useContext ( AppContext )\n  const classes = useStyles()\n\n  return (\n    <Box className={`${classes.mapContainer} map`}>\n      <MapContainer center={checkPosition(position)} zoom={16} scrollWheelZoom={false} className={classes.mapContainer}>\n        <ChangeMapCenter center={checkPosition(position)} zoom={16} />\n        <TileLayer\n          attribution='&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\n          url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n        />\n        {\n          // plot stops\n          stops.map((stopId, idx, self) => \n              <Marker key={stopId} position={stopList[stopId].location} />  \n          )\n        }\n        {\n          // plot line\n          stops.slice(1).map((stopId, idx) => \n            <Polyline \n              key={`${stopId}-line`}\n              positions={[\n                getPoint(stopList[stops[idx]].location),\n                getPoint(stopList[stopId].location)\n              ]}\n            />\n          )\n        }\n        { geoPermission !== 'granted' ? <></>:<Circle \n          center={checkPosition(geolocation)}\n          radius={25}\n        />}\n      </MapContainer>\n    </Box>\n  )\n}\n\nexport default RouteMap\n\n// HK location if no valid value\nconst checkPosition = (position) => {\n  if ( position \n    && typeof position.lat === 'number' && isFinite(position.lat)\n    && typeof position.lng === 'number' && isFinite(position.lng) \n  )\n    return position\n  return {lat: 22.302711, lng: 114.177216}\n}\n\nconst getPoint = ({lat, lng}) => [lat, lng]\n\nconst useStyles = makeStyles ( theme => ({\n  mapContainer: {\n    height: '30vh',\n  }\n}) )","import React, { useState, useEffect, useContext, useRef } from 'react'\nimport { useParams, useHistory } from 'react-router-dom'\nimport RouteMap from './RouteMap'\nimport {\n  Accordion as MuiAccordion,\n  AccordionSummary as MuiAccordionSummary, \n  AccordionDetails as MuiAccordionDetails,\n  Box, \n  CircularProgress,\n  IconButton, \n  Typography\n} from '@material-ui/core'\nimport StarIcon from '@material-ui/icons/Star';\nimport StarBorderIcon from '@material-ui/icons/StarBorder';\nimport { makeStyles, withStyles } from '@material-ui/core/styles'\nimport AppContext from '../AppContext'\nimport { useTranslation } from 'react-i18next'\nimport { \n  fetchRouteStops as fetchRouteStopsViaApi,\n  fetchEtas as fetchEtasViaApi \n} from '../data-api'\n\nconst RouteEta = () => {\n  const { id, panel } = useParams()\n  const [ expanded, setExpanded ] = useState(parseInt(panel))\n  const { \n    routeList, stopList, savedEtas,\n    updateNewlyFetchedRouteStops, updateSelectedRoute, updateSavedEtas\n  } = useContext ( AppContext )\n\n  const { route, serviceType, bound, stops, co, dest } = routeList[id]\n  const { t, i18n } = useTranslation()\n  const history = useHistory()\n  const accordionRef = useRef([])\n\n  const handleChange = ( panel ) => (event, newExpanded) => {\n    setExpanded(newExpanded ? panel : false)\n    if ( newExpanded ) {\n      history.replace(`/${i18n.language}/route/${id}/${panel}`)\n      updateSelectedRoute( id, panel )\n      return\n    }\n  }\n\n  useEffect(() => {\n    updateSelectedRoute( id )\n\n    // fetch stops\n    fetchRouteStopsViaApi({route, bound, stops}).then( objs => \n      updateNewlyFetchedRouteStops(id, objs)\n    )\n\n    if ( parseInt(panel) && accordionRef.current[parseInt(panel)] ) {\n      setExpanded(parseInt(panel))\n      accordionRef.current[parseInt(panel)].scrollIntoView({behavior: 'smooth', block: 'start'})\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  const classes = useStyles()\n\n  if ( stops[co[0]] == null ) {\n    return (\n      <Box className={classes.loadingContainer}>\n        <CircularProgress size={30} />\n      </Box>\n    )\n  }\n\n  const toggleSavedRoute = (key) => updateSavedEtas(key)\n\n  return (\n    <>\n      <Typography variant=\"subtitle1\" align='center'>\n        {route}\n      </Typography>\n      <Typography variant=\"caption\" align='center'>\n        {t('往')} {dest[i18n.language]}\n      </Typography>\n      <RouteMap \n        stops={stops[co[0]]}\n        stopList={stopList}\n        position={expanded && stops[co[0]] ? stopList[stops[co[0]][expanded]].location : null}\n      />\n      <Box className={classes.boxContainer}>\n        {\n          stops[co[0]].map((stop, idx) => (\n            <Accordion \n              key={'stop-'+idx} \n              expanded={expanded === idx}\n              onChange={handleChange(idx)}\n              TransitionProps={{unmountOnExit: true}}\n              ref={el => {accordionRef.current[idx] = el}}\n            >\n              <AccordionSummary>{stopList[stop].name[i18n.language]}</AccordionSummary>\n              <AccordionDetails>\n                <TimeReport \n                  route={route}\n                  seq={idx + 1}\n                  routeStops={stops}\n                  serviceType={serviceType}\n                  bound={bound}\n                  co={co}\n                />\n                <IconButton aria-label=\"favourite\" onClick={() => toggleSavedRoute(`${id}/${panel}`)}>\n                  {savedEtas.includes(`${id}/${panel}`) ? <StarIcon/> : <StarBorderIcon />}\n                </IconButton>\n              </AccordionDetails>\n            </Accordion>\n          ))\n        }\n      </Box>\n    </>\n  )\n}\n\nexport default RouteEta\n\nconst TimeReport = ( { route, routeStops, seq, bound, serviceType, co } ) => {\n  const { t, i18n } = useTranslation()\n  const [ etas, setEtas ] = useState(null)\n\n  useEffect( () => {\n    let isMounted = true\n    const fetchData = () => {\n      fetchEtasViaApi({route, routeStops, seq, bound, serviceType, co}).then(_etas => {\n        if (isMounted) setEtas(_etas)\n      })\n    }\n    fetchData()\n    const fetchEtaInterval = setInterval(() => {\n      fetchData()\n    }, 30000)\n\n    return () => {\n      isMounted = false\n      clearInterval(fetchEtaInterval)\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  if ( etas == null ) {\n    return (\n      <CircularProgress size={20} style={{}} />\n    )\n  }\n\n  const displayMsg = (eta) => {\n    let ret = ''\n    switch (eta) {\n      case null: \n        break\n      case 0: \n        ret = '- '+t('分鐘')\n        break\n      default:\n        ret = eta + \" \" + t('分鐘')\n        break\n    }\n    return ret\n  }\n  \n  return (\n    <div>\n      {\n        etas.length === 0 ? t('暫無班次') : (\n          etas.map((eta, idx) => (\n            <Typography variant=\"subtitle1\" key={`route-${idx}`}>\n              {displayMsg(eta.eta)} - { eta.remark[i18n.language] ? eta.remark[i18n.language] : '' } {t(eta.co)}\n            </Typography>\n          ))\n        )\n      }\n    </div>\n  )\n}\n\nconst Accordion = withStyles({\n  root: {\n    border: '1px solid rgba(0, 0, 0, .125)',\n    boxShadow: 'none',\n    '&:not(:last-child)': {\n      borderBottom: 0,\n    },\n    '&:before': {\n      display: 'none',\n    },\n    '&$expanded': {\n      margin: 'auto',\n    },\n  },\n  expanded: {},\n})(MuiAccordion)\n\nconst AccordionSummary = withStyles({\n  root: {\n    backgroundColor: 'rgba(0, 0, 0, .03)',\n    borderBottom: '1px solid rgba(0, 0, 0, .125)',\n    marginBottom: -1,\n    minHeight: 56,\n    '&$expanded': {\n      minHeight: 56,\n    },\n  },\n  content: {\n    '&$expanded': {\n      margin: '12px 0',\n    },\n  },\n  expanded: {},\n})(MuiAccordionSummary);\n\nconst AccordionDetails = withStyles((theme) => ({\n  root: {\n    padding: theme.spacing(2),\n    justifyContent: 'space-between'\n  },\n}))(MuiAccordionDetails);\n\nconst useStyles = makeStyles(theme => ({\n  boxContainer: {\n    overflowY: 'scroll'\n  },\n  loadingContainer: {\n    display: 'flex',\n    justifyContent: 'center'\n  }\n}))","import React, { useContext, useEffect, useState } from 'react'\nimport AppContext from '../AppContext'\nimport {\n  Avatar,\n  Divider,\n  List,\n  ListItem,\n  ListItemAvatar,\n  ListItemText,\n  Paper,\n  Snackbar\n} from '@material-ui/core'\nimport { makeStyles } from '@material-ui/core/styles'\nimport BuildIcon from '@material-ui/icons/Build'\nimport LocationOnIcon from '@material-ui/icons/LocationOn'\nimport LocationOffIcon from '@material-ui/icons/LocationOff'\nimport { useTranslation } from 'react-i18next'\nimport MonetizationOnIcon from '@material-ui/icons/MonetizationOn'\nimport DataUsageIcon from '@material-ui/icons/DataUsage'\nimport DeleteIcon from '@material-ui/icons/Delete';\nimport moment from 'moment'\n\nconst Settings = () => {\n  const { \n    schemaVersion, updateTime, geoPermission, \n    updateGeoPermission, renewDb, resetUsageRecord\n  } = useContext ( AppContext )\n  const [ updating, setUpdating ] = useState(false)\n\n  const { t, i18n } = useTranslation()\n  const classes = useStyles()\n\n  useEffect(() => {\n    setUpdating(false)\n  }, [updateTime])\n\n  return (\n    <Paper className={classes.root}>\n      <List>\n        <ListItem\n          button\n          onClick={() => {setUpdating(true);renewDb()}}\n        >\n          <ListItemAvatar>\n            <Avatar><BuildIcon /></Avatar>\n          </ListItemAvatar>\n          <ListItemText \n            primary={t(\"架構版本\")+\": \"+schemaVersion} \n            secondary={t('更新時間：') + \" \" + moment(updateTime).format('YYYY-MM-DD HH:mm:ss')} \n          />\n        </ListItem>\n        <ListItem\n          button\n          onClick={() => {\n            if ( geoPermission === 'granted' ) {\n              updateGeoPermission('closed')\n            } else {\n              navigator.geolocation.getCurrentPosition(position => {\n                updateGeoPermission('granted')\n              })\n            }\n          }}\n        >\n          <ListItemAvatar>\n            <Avatar>{geoPermission === 'granted' ? <LocationOnIcon /> : <LocationOffIcon />}</Avatar>\n          </ListItemAvatar>\n          <ListItemText \n            primary={t(\"地理位置定位功能\")} \n            secondary={t(geoPermission === 'granted' ? '開啟' : '關閉') } \n          />\n        </ListItem>\n        <ListItem\n          button\n          onClick={() => {resetUsageRecord()}}\n        >\n          <ListItemAvatar>\n            <Avatar><DeleteIcon /></Avatar>\n          </ListItemAvatar>\n          <ListItemText \n            primary={t(\"一鍵清空用戶紀錄\")} \n            secondary={t(\"包括鎖定和常用報時\")}\n          />\n        </ListItem>\n        <Divider />\n        <ListItem\n          button\n          component='a'\n          href={`https://donate.612fund.hk/${i18n.language}/`}\n          target=\"_blank\"\n        >\n          <ListItemAvatar>\n            <Avatar><MonetizationOnIcon /></Avatar>\n          </ListItemAvatar>\n          <ListItemText \n            primary={t(\"捐款支持\")} \n            secondary={t('請捐款到 612 人道支援基金') } \n          />\n        </ListItem>\n        <Divider />\n        <ListItem>\n          <ListItemAvatar>\n            <Avatar><DataUsageIcon /></Avatar>\n          </ListItemAvatar>\n          <ListItemText \n            primary={t(\"資料來源\")} \n            secondary={t('資料一線通') + \"  https://data.gov.hk\" } \n          />\n        </ListItem>\n      </List>\n      <Snackbar\n        anchorOrigin={{vertical: 'bottom', horizontal: 'center'}}\n        open={updating}\n        message={t('資料更新中...')}\n      />\n    </Paper>\n  )\n}\n\nexport default Settings\n\nconst useStyles = makeStyles ( theme => ({\n  root: {\n    background: 'white',\n    height: 'calc(100vh - 120px)'\n  }\n}))","import React, { useContext } from 'react'\nimport {\n  BottomNavigation,\n  BottomNavigationAction\n} from '@material-ui/core'\nimport HomeIcon from '@material-ui/icons/Home'\nimport SearchIcon from '@material-ui/icons/Search'\nimport TimerIcon from '@material-ui/icons/Timer'\nimport SettingsIcon from '@material-ui/icons/Settings';\nimport { Link, useLocation } from 'react-router-dom'\nimport { useTranslation } from 'react-i18next'\nimport AppContext from './AppContext'\n\nconst Footer = () => {\n  const { t, i18n } = useTranslation()\n  const location = useLocation()\n  const { selectedRoute } = useContext ( AppContext ) \n  \n  return (\n    <BottomNavigation\n      value={location.pathname}\n      showLabels={true}\n    >\n      <BottomNavigationAction\n        label={t(\"常用\")}\n        component={Link}\n        to={`/${i18n.language}`}\n        value={`/${i18n.language}`}\n        icon={<HomeIcon />}\n      />\n      <BottomNavigationAction \n        label={t(\"搜尋\")}\n        component={Link}\n        to={`/${i18n.language}/search`}\n        value={`/${i18n.language}/search`}\n        icon={<SearchIcon />} \n      />\n      <BottomNavigationAction\n       label={selectedRoute.split('+')[0]}\n       component={Link}\n       to={`/${i18n.language}/route/${selectedRoute}`}\n       value={`/${i18n.language}/route/${selectedRoute}`}\n       icon={<TimerIcon />} \n      />\n      <BottomNavigationAction\n       label={t(\"設定\")}\n       component={Link}\n       to={`/${i18n.language}/settings`}\n       value={`/${i18n.language}/settings`}\n       icon={<SettingsIcon />} \n      />\n    </BottomNavigation>\n  )\n}\n\nexport default Footer","import './App.css'\nimport { MuiThemeProvider, createMuiTheme } from '@material-ui/core/styles'\nimport React, { useContext } from 'react'\nimport {\n  HashRouter as Router,\n  Redirect,\n  Switch,\n  Route,\n  useRouteMatch\n} from \"react-router-dom\";\nimport {\n  CircularProgress,\n  Container,\n  CssBaseline,\n  Paper,\n  Typography\n} from '@material-ui/core'\nimport {\n  makeStyles\n} from '@material-ui/core/styles'\nimport Header from './Header'\nimport Home from './components/Home'\nimport RouteBoard from './components/RouteBoard'\nimport RouteEta from './components/RouteEta'\nimport Settings from './components/Settings'\nimport AppContext from './AppContext'\nimport Footer from './Footer'\nimport Countdown from 'react-countdown'\n\nconst PageSwitch = () => {\n  const { path } = useRouteMatch()\n  return (\n    <Switch>\n      <Route path={`${path}/route/:id/:panel?`}>\n        <RouteEta />\n      </Route>\n      <Route path={`${path}/settings`}>\n        <Settings />\n      </Route>      \n      <Route path={`${path}/search`}>\n        <RouteBoard />\n      </Route>\n      <Route path={`${path}`}>\n        <Home />\n      </Route>\n    </Switch>\n  )\n}\n\nconst App = () => {\n  /*\n  navigator.geolocation.getCurrentPosition(position => {\n    console.log(position.coords.latitude, position.coords.longitude)\n  })\n  */\n  \n  const classes = useStyles()\n  const { routeList, stopList } = useContext( AppContext )\n  if ( routeList == null || stopList == null ) {\n    return (\n      <Container maxWidth='xs' disableGutters className={classes.loadingContainer}>\n        <CircularProgress size={40} />\n        <br />\n        <br />\n        <Paper className={classes.loadingTextContainer} elevation={0}>\n          <Countdown \n            date={Date.now() + 20000}\n            renderer={({seconds, completed}) => {\n              if ( completed ) {\n                return <Typography variant=\"subtitle2\" align=\"center\">介面開啟中...</Typography>\n              } else {\n                return (\n                  <>\n                    <Typography variant=\"subtitle2\" align=\"center\">初始設定...</Typography>\n                    <Typography variant=\"subtitle2\" align=\"center\">正在更新巴士路線資料...</Typography>\n                    <Typography variant=\"subtitle2\" align=\"center\">約需{seconds}秒</Typography>\n                  </>\n                )\n              }\n            }}\n          />\n            \n        </Paper>\n      </Container>\n    )\n  } \n\n  return (\n    <MuiThemeProvider theme={Theme}>\n      <Container maxWidth='xs' disableGutters className={classes.container}>\n        <Router>\n          <Route exact path=\"/\">\n            <Redirect to=\"/zh/\" />\n          </Route>\n          <Route path=\"/:lang\">\n            <CssBaseline />\n            <Header />\n            <PageSwitch />\n            <Footer />\n          </Route>\n        </Router>\n      </Container>\n    </MuiThemeProvider>\n  );\n}\n\nexport default App;\n\nconst Theme = createMuiTheme({\n  typography: {\n    fontFamily: \"Noto Sans TC, Chivo, sans-serif\"\n  },\n  palette: {\n    background: {\n      default: \"#ffff00\" // yellow\n    }\n  }\n})\n\nconst useStyles = makeStyles( theme => ({\n  container: {\n    display: 'flex',\n    flexDirection: 'column',\n    justifyContent: 'space-between',\n    height: '100vh'\n  },\n  loadingContainer: {\n    display: 'flex',\n    flexDirection: 'column',\n    justifyContent: 'center',\n    alignItems: 'center',\n    height: '100vh'\n  },\n  loadingText: {\n\n  }\n}))\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import i18n from \"i18next\";\nimport { initReactI18next } from \"react-i18next\";\nimport resources from \"./i18n/translation.json\";\n\nconst DEFAULT_LANG = window.location.pathname.substr(1,2) === 'en' ? 'en' : 'zh'\n\ni18n\n  .use(initReactI18next)\n  .init({\n    resources,\n    whitelist: ['en', 'zh'],\n    lowerCaseLng: true,\n    lng: DEFAULT_LANG,\n    nsSeparator: false,\n    keySeparator: false,\n    debug: false,\n\n    interpolation:{\n      escapeValue: false\n    }\n  });\n\nexport default i18n;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\nimport { AppContextProvider } from './AppContext'\nimport './i18n'\n\nReactDOM.render(\n  //<React.StrictMode>\n    <AppContextProvider>\n      <App />\n    </AppContextProvider>\n  //</React.StrictMode>,\n  ,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}