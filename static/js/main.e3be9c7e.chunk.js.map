{"version":3,"sources":["data-api/Kmb.js","data-api/Nwfb.js","data-api/Ctb.js","data-api/index.js","AppContext.js","components/Header.js","components/RouteInputPad.js","components/RouteBoard.js","components/RouteEta.js","components/Settings.js","Footer.js","App.js","reportWebVitals.js","i18n.js","index.js"],"names":["KmbApi","co","fetchRouteList","fetch","then","response","json","data","routeList","forEach","element","route","service_type","bound","join","orig","en","orig_en","zh","orig_tc","dest","dest_en","dest_tc","stops","kmb","generated_timestamp","push","stop","fetchStopList","stopList","name","name_en","name_tc","location","lat","long","fetchEtas","stopId","seq","serviceType","cache","filter","e","dir","map","eta","Math","round","moment","diff","remark","rmk_tc","rmk_en","NwfbApi","nwfb","fetchRouteStops","routeStops","Promise","all","rmk","CtbApi","ctb","console","log","a","routeSize","_etas","company_id","concat","sort","b","Number","isInteger","api","error","AppContext","React","createContext","AppContextProvider","props","useState","localStorage","getItem","schemaVersion","setSchemaVersion","JSON","parse","setRouteList","setStopList","parseInt","updateTime","setUpdateTime","searchRoute","setSearchRoute","selectedRoute","setSelectedRoute","geoPermission","setGeoPermission","possibleChar","setPossibleChar","renewDb","routeLists","companyData","companyRouteList","_generated_timestamp","Object","entries","routeNo","route1","route2","name_a","toUpperCase","name_b","includes","checkSameRoute","_routeList","updateRouteList","_stopList","updateStopList","_updateTime","Date","now","setItem","useEffect","process","text","_schemaVersion","needRenew","getPossibleChar","stringify","Provider","value","updateSearchRouteByButton","buttonValue","slice","updateGeoPermission","state","children","startsWith","length","k","useStyles","makeStyles","theme","tabsContainer","display","breakpoints","down","flexDirection","toolbar","justifyContent","zIndex","drawer","LanguageTabs","withStyles","root","borderBottom","minHeight","indicator","backgroundColor","Tabs","LanguageTab","textTransform","minWidth","fontWeight","marginRight","spacing","fontSize","opacity","padding","selected","color","wrapper","borderRadius","Tab","disableRipple","Header","useContext","path","useRouteMatch","useTranslation","t","i18n","classes","useLocation","history","useHistory","Toolbar","className","Typography","variant","Input","type","placeholder","onChange","target","disabled","language","v","lang","replace","pathname","changeLanguage","label","KeyButton","handleClick","Button","size","button","onClick","RouteNumPad","Grid","container","split","item","xs","RouteAlphabetPad","isNaN","RouteInputPad","Box","boxContainer","numPadContainer","alphabetPadContainer","height","width","overflowX","overflowY","RouteRow","memo","index","style","to","Card","square","CardActionArea","CardContent","cardContent","areEqual","createItemData","memorize","RouteList","targetRouteList","itemData","itemCount","itemSize","RouteBoard","RouteEta","useParams","id","panel","expanded","setExpanded","accordionRef","useRef","routeObj","handleChange","event","newExpanded","fetchRouteStopsViaApi","objs","obj","prevRouteList","current","scrollIntoView","behavior","block","loadingContainer","CircularProgress","idx","TransitionProps","unmountOnExit","ref","el","TimeReport","etas","setEtas","fetchEtasViaApi","fetchData","fetchEtaInterval","setInterval","clearInterval","displayMsg","ret","Accordion","border","boxShadow","margin","MuiAccordion","AccordionSummary","marginBottom","content","MuiAccordionSummary","AccordionDetails","MuiAccordionDetails","Settings","updating","setUpdating","Paper","List","ListItem","ListItemAvatar","Avatar","ListItemText","primary","secondary","format","navigator","geolocation","getCurrentPosition","position","component","href","Snackbar","anchorOrigin","vertical","horizontal","open","message","background","Footer","BottomNavigation","showLabels","BottomNavigationAction","Link","icon","PageSwitch","App","Container","maxWidth","disableGutters","loadingTextContainer","elevation","date","renderer","seconds","completed","align","Theme","exact","CssBaseline","createMuiTheme","typography","fontFamily","palette","default","alignItems","loadingText","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","DEFAULT_LANG","window","substr","use","initReactI18next","init","resources","whitelist","lowerCaseLng","lng","nsSeparator","keySeparator","debug","interpolation","escapeValue","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.e3be9c7e.chunk.js","sourcesContent":["import moment from 'moment'\n\nconst KmbApi = {\n  co: 'kmb',\n  fetchRouteList: () => (\n    // fetch route data\n    fetch(\n      \"https://data.etabus.gov.hk/v1/transport/kmb/route/\"\n    ).then(response => response.json())\n    .then( ({data}) => {\n      let routeList = {}\n      data.forEach(element => {\n        routeList[[element.route, element.service_type, element.bound].join('+')] = {\n          co: ['kmb'],\n          orig: {\n            en: element.orig_en,\n            zh: element.orig_tc\n          },\n          dest: {\n            en: element.dest_en,\n            zh: element.dest_tc\n          },\n          stops: {\n            kmb: []\n          }\n        }\n      })\n      return routeList\n    }).then( routeList => (\n      // fetch route stop data\n      fetch(\"https://data.etabus.gov.hk/v1/transport/kmb/route-stop/\").then(response => response.json())\n      .then(({data, generated_timestamp}) => {\n        data.forEach(element => {\n          routeList[[element.route, element.service_type, element.bound].join('+')].stops.kmb.push(\n            element.stop\n          )\n        })\n        return [routeList, generated_timestamp]\n      })\n    ))\n  ),\n  fetchStopList: () => {\n    return fetch(\"https://data.etabus.gov.hk/v1/transport/kmb/stop\").then(\n      response => response.json()\n    ).then(({data, generated_timestamp}) => {\n      let stopList = {}\n      data.forEach(element => {\n        stopList[element.stop] = {\n          name: {\n            en: element.name_en,\n            zh: element.name_tc\n          },\n          location: {\n            lat: element.lat,\n            long: element.long\n          }\n        }\n      })\n      \n      return stopList\n    })\n  },\n  /*\n    @fetchEtas\n    return array of Object with props {\n      eta: (int) minute or null,\n      remark: {\n        zh: string\n        en: string\n      }\n    }\n  */\n  fetchEtas: ({stopId, route, seq, serviceType, bound}) => {\n    return fetch(\n      `https://data.etabus.gov.hk/v1/transport/kmb/eta/${stopId}/${route}/${serviceType}`,\n      { cache: \"no-store\" }\n    ).then( response => response.json() )\n    .then(({data}) => data.filter(e => e.dir === bound && e.seq === seq).map(e => ({\n        eta: e.eta ? Math.round(moment(e.eta).diff(moment()) / 60 / 1000) : e.eta,\n        remark: {\n          zh: e.rmk_tc,\n          en: e.rmk_en\n        },\n        co: 'kmb'\n      }))\n    )\n  }\n}\n\nexport default KmbApi","import moment from 'moment'\n\nconst NwfbApi = {\n  co: 'nwfb',\n  fetchRouteList: () => (\n    fetch(\"https://rt.data.gov.hk/v1/transport/citybus-nwfb/route/nwfb\")\n      .then(response => response.json())\n      .then(({data, generated_timestamp}) => {\n        let routeList = {}\n        data.forEach(element => {\n          // the bound direction is reverted to fit KMB route\n          routeList[[element.route,'1','I'].join('+')] = {\n            orig: {\n              en: element.orig_en,\n              zh: element.orig_tc\n            },\n            dest: {\n              en: element.dest_en,\n              zh: element.dest_tc\n            },\n            co: ['nwfb'],\n            stops: {\n              nwfb: null\n            }\n          }\n          routeList[[element.route,'1','O'].join('+')] = {\n            dest: {\n              en: element.orig_en,\n              zh: element.orig_tc\n            },\n            orig: {\n              en: element.dest_en,\n              zh: element.dest_tc\n            },\n            co: ['nwfb'],\n            stops: {\n              nwfb: null\n            }\n          }\n        })\n        return [routeList, generated_timestamp]\n      })\n  ),\n  fetchRouteStops: ({route, bound, routeList}) => {\n    // fetch route stop first\n    // the bound direction is reverted to fit KMB route\n    const dir = bound === 'I' ? 'outbound' : 'inbound'\n    return fetch(\n      `https://rt.data.gov.hk/v1/transport/citybus-nwfb/route-stop/NWFB/${route}/${dir}`\n    ).then( response => \n      response.json()\n    ).then( ({data}) => \n      data.map(e => e.stop) \n    ).then( routeStops => {\n      // fetch each stop in parallel\n      return Promise.all(routeStops.map(stopId => \n          fetch(`https://rt.data.gov.hk/v1/transport/citybus-nwfb/stop/${stopId}`).then(\n            response => response.json()\n          ).then ( ({data}) => ({\n            stopId: stopId,\n            name: {\n              zh: data.name_tc,\n              en: data.name_en\n            },\n            location: {\n              lat: data.lat,\n              long: data.long\n            }\n          }))\n        )).then( stops => {\n          let stopList = {};\n          stops.forEach(stop => stopList[stop.stopId] = stop)\n          return {routeStops, stopList, co: 'nwfb'}\n        })\n    })\n  },\n  fetchEtas: ({stopId, route, bound }) => {\n    // the bound direction is reverted to fit KMB route\n    return fetch(`https://rt.data.gov.hk/v1/transport/batch/stop-eta/NWFB/${stopId}?lang=zh-hant`, { cache: \"no-store\" }).then(\n      response => response.json()\n    ).then(({data}) => data.filter(eta => eta.route === route && eta.dir !== bound && eta.eta).map(e => ({\n        eta: e.eta ? Math.round(moment(e.eta).diff(moment()) / 60 / 1000) : e.eta,\n        remark: {\n          zh: e.rmk,\n          en: e.rmk\n        },\n        co: 'nwfb'\n      }))\n    )\n  }\n}\n\nexport default NwfbApi","import moment from 'moment'\n\nconst CtbApi = {\n  co: 'ctb',\n  fetchRouteList: () => (\n    fetch(\"https://rt.data.gov.hk/v1/transport/citybus-nwfb/route/ctb\")\n      .then(response => response.json())\n      .then(({data, generated_timestamp}) => {\n        let routeList = {}\n        data.forEach(element => {\n          // the bound direction is reverted to fit KMB route\n          routeList[[element.route,'1','I'].join('+')] = {\n            orig: {\n              en: element.orig_en,\n              zh: element.orig_tc\n            },\n            dest: {\n              en: element.dest_en,\n              zh: element.dest_tc\n            },\n            co: ['ctb'],\n            stops: {\n              ctb: null\n            }\n          }\n          routeList[[element.route,'1','O'].join('+')] = {\n            dest: {\n              en: element.orig_en,\n              zh: element.orig_tc\n            },\n            orig: {\n              en: element.dest_en,\n              zh: element.dest_tc\n            },\n            co: ['ctb'],\n            stops: {\n              ctb: null\n            }\n          }\n        })\n        return [routeList, generated_timestamp]\n      })\n  ),\n  fetchRouteStops: ({route, bound, routeList}) => {\n    // fetch route stop first\n    // the bound direction is reverted to fit KMB route\n    const dir = bound === 'I' ? 'outbound' : 'inbound'\n    return fetch(\n      `https://rt.data.gov.hk/v1/transport/citybus-nwfb/route-stop/CTB/${route}/${dir}`\n    ).then( response => \n      response.json()\n    ).then( ({data}) => \n      data.map(e => e.stop) \n    ).then( routeStops => {\n      // fetch each stop in parallel\n      return Promise.all(routeStops.map(stopId => \n          fetch(`https://rt.data.gov.hk/v1/transport/citybus-nwfb/stop/${stopId}`).then(\n            response => response.json()\n          ).then ( ({data}) => ({\n            stopId: stopId,\n            name: {\n              zh: data.name_tc,\n              en: data.name_en\n            },\n            location: {\n              lat: data.lat,\n              long: data.long\n            }\n          }))\n        )).then( stops => {\n          let stopList = {};\n          stops.forEach(stop => stopList[stop.stopId] = stop)\n          console.log(stopList)\n          return {routeStops, stopList, co: 'ctb'}\n        })\n    })\n  },\n  // the bound direction is reverted to fit KMB route\n  fetchEtas: ({stopId, route, bound }) => {\n    return fetch(`https://rt.data.gov.hk/v1/transport/batch/stop-eta/CTB/${stopId}?lang=zh-hant`, { cache: \"no-store\" }).then(\n      response => response.json()\n    ).then(({data}) => data.filter(eta => eta.route === route && eta.dir !== bound).map(e => ({\n        eta: e.eta ? Math.round(moment(e.eta).diff(moment()) / 60 / 1000) : e.eta,\n        remark: {\n          zh: e.rmk,\n          en: e.rmk\n        },\n        co: 'ctb'\n      }))\n    )\n  }\n}\n\nexport default CtbApi","import KmbApi from './Kmb'\nimport NwfbApi from './Nwfb'\nimport CtbApi from './Ctb'\n\nconst fetchEtas = async ( {route, routeStops, bound, seq, serviceType, co, routeSize}) => {\n  let _etas = []\n  for ( const company_id of co ) {\n    if (company_id === 'kmb' && routeStops.kmb ){\n      _etas = _etas.concat( await KmbApi.fetchEtas({\n        route,\n        stopId: routeStops.kmb[seq-1], \n        seq: (seq === routeSize ? 1000 : seq), \n        serviceType, bound}) \n      )\n    }\n    else if ( company_id === 'ctb' && routeStops.ctb ) {\n      _etas = _etas.concat( await CtbApi.fetchEtas({stopId: routeStops.ctb[seq-1], route, bound }))\n    }\n    else if ( company_id === 'nwfb' && routeStops.nwfb ) {\n      _etas = _etas.concat( await NwfbApi.fetchEtas({stopId: routeStops.nwfb[seq-1], route, bound }))\n    }\n  }\n  return _etas.sort((a,b) => a.eta < b.eta ? -1 : 1).filter(e => !Number.isInteger(e.eta) || e.eta > 1 )\n}\n\nconst fetchRouteStops = async ( {route, serviceType, bound, co} ) => {\n  let api\n  if (co === 'kmb') api = KmbApi\n  else if (co === 'nwfb') api = NwfbApi\n  else if (co === 'ctb') api = CtbApi\n  else {\n    console.error(co+' is not a valid company id')\n    return null\n  }\n  return await api.fetchRouteStops({route, serviceType, bound})\n}\n\nconst checkSameRoute = (route1, route2) => {\n  const name_a = route1.orig.en.toUpperCase()\n  const name_b = route2.orig.en.toUpperCase()\n  return name_a.includes(name_b) || name_b.includes(name_a)\n}\n\nconst fetchRouteList = () => (\n  Promise.all([KmbApi, NwfbApi, CtbApi].map(api => api.fetchRouteList()))\n  .then( routeLists => {\n    let routeList = {}\n    let generated_timestamp = '3000'\n    \n    routeLists.forEach( companyData => {\n      let [companyRouteList, _generated_timestamp] = companyData\n      // merging routes from different service provider\n      Object.entries(companyRouteList).forEach( ([routeNo, route]) => {\n        const co = route.co[0]\n        if ( routeNo in routeList ) {\n          if ( checkSameRoute(route, routeList[routeNo] ) ) {\n            // same route\n            routeList[routeNo].co.push(co)\n            routeList[routeNo].stops[co] = route.stops[co]\n          } else {\n            // new route with same route number\n            routeList[routeNo+'+'+co] = route\n          }\n        } else {\n          // new route\n          routeList[routeNo] = route\n        }\n      })\n      generated_timestamp = _generated_timestamp < generated_timestamp ? _generated_timestamp : generated_timestamp\n    })\n    \n    // sort the routeList by route no.\n    let _routeList = routeList\n    routeList = {}\n    Object.entries(_routeList).sort((a,b) => (a[0] < b[0] ? -1 : 1)).forEach(([routeNo, route]) => {\n      routeList[routeNo] = route\n    })\n\n    return routeList\n  })\n)\n\nexport { KmbApi, NwfbApi, CtbApi, fetchEtas, fetchRouteStops, fetchRouteList }","import React, { useEffect, useState } from 'react'\nimport { KmbApi, fetchRouteList } from './data-api'\n\nconst AppContext = React.createContext()\n\nexport const AppContextProvider = ( props ) => {\n  const [schemaVersion, setSchemaVersion] = useState(localStorage.getItem('schemaVersion'))\n  // route list & stop list & route-stop list\n  const [routeList, setRouteList] = useState(JSON.parse(localStorage.getItem('routeList')))\n  const [stopList, setStopList] = useState(JSON.parse(localStorage.getItem('stopList')))\n  const [updateTime, setUpdateTime] = useState(parseInt(localStorage.getItem('updateTime')))\n  // search route\n  const [searchRoute, setSearchRoute] = useState(\"\")\n  // selected route for bottom navigation shortcut\n  const [selectedRoute, setSelectedRoute] = useState(\"1+1+I\")\n  // Geo Permission for UX\n  const [ geoPermission, setGeoPermission ] = useState( localStorage.getItem('geoPermission') ) \n\n  // possible Char for RouteInputPad\n  const [possibleChar, setPossibleChar] = useState([])\n  \n  const renewDb = () => {\n    fetchRouteList().then( _routeList => updateRouteList(_routeList) ).then(() =>\n      // fetch only KMB stop list as the api return is succinct enough\n      // on-the-fly fetching for other service providers' stops\n      KmbApi.fetchStopList().then( _stopList => {\n        updateStopList(_stopList)\n        const _updateTime = Date.now()\n        setUpdateTime ( _updateTime )\n        localStorage.setItem('updateTime', _updateTime)\n      } )\n    )\n  }\n\n  useEffect(() => {\n    // check app version and flush localstorage if outdated\n    fetch( process.env.PUBLIC_URL + '/schema-version.txt').then(\n      response => response.text()\n    ).then( _schemaVersion => {\n      let needRenew = false\n      if ( schemaVersion !== _schemaVersion ) {\n        setSchemaVersion(_schemaVersion)\n        localStorage.setItem('schemaVersion', _schemaVersion)\n        needRenew = true\n      }\n      needRenew = needRenew || routeList == null || stopList == null || updateTime == null || updateTime < Date.now() - 7 * 24 * 60 * 60 * 1000\n      if (needRenew) {\n        renewDb()\n      }\n    })\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  useEffect(() => {\n    setPossibleChar(getPossibleChar(searchRoute, routeList))\n  }, [searchRoute, routeList])\n\n  const updateStopList = (_stopList) => {\n    // caching localStorage\n    localStorage.setItem('stopList', JSON.stringify(_stopList))\n    setStopList(_stopList)\n  }\n\n  const updateRouteList = (_routeList) => {\n    if ( typeof(_routeList) === 'function' ) {\n      _routeList = _routeList(routeList)\n    }\n    // caching localStorage\n    localStorage.setItem('routeList', JSON.stringify(_routeList))\n    setRouteList(_routeList)\n  }\n\n  const updateSearchRouteByButton = (buttonValue) => {\n    switch (buttonValue) {\n      case 'b': \n        setSearchRoute(searchRoute.slice(0,-1))\n        break\n      case '-':\n        setSearchRoute('')\n        break\n      default: \n        setSearchRoute(searchRoute+buttonValue)\n    }\n  }\n\n\n  const updateGeoPermission = ( state ) => {\n    setGeoPermission(state)\n    localStorage.setItem('geoPermission', state)\n  }\n\n  return (\n    <AppContext.Provider value={{\n        routeList, updateRouteList, stopList, updateStopList,\n        searchRoute, setSearchRoute, updateSearchRouteByButton,\n        selectedRoute, setSelectedRoute,\n        possibleChar,\n        // settings\n        renewDb, schemaVersion, updateTime,\n        geoPermission, updateGeoPermission \n      }}\n    >\n      {props.children}\n    </AppContext.Provider>\n  )\n}\n\nexport default AppContext\n\nconst getPossibleChar = ( searchRoute, routeList ) => {\n  if ( routeList == null ) return []\n  let possibleChar = {}\n  Object.entries(routeList).forEach(route => {\n    if ( route[0].startsWith(searchRoute.toUpperCase()) ) {\n      possibleChar[route[0].slice(searchRoute.length, searchRoute.length+1)] = true\n    }\n  })\n  return Object.entries(possibleChar).map(k => k[0]).filter(k => k !== '+')\n}","import React, { useContext } from \"react\"\nimport {\n  Input,\n  Tabs,\n  Tab,\n  Toolbar,\n  Typography\n} from \"@material-ui/core\"\nimport { withStyles, makeStyles } from '@material-ui/core/styles'\nimport { useLocation, useHistory } from 'react-router-dom'\nimport { useTranslation } from 'react-i18next'\nimport { useRouteMatch } from 'react-router-dom'\nimport AppContext from '../AppContext'\n\nconst Header = (props) => {\n  const { searchRoute, setSearchRoute } = useContext( AppContext )\n  \n  const { path } = useRouteMatch()\n  const { t, i18n } = useTranslation()\n  const classes = useStyles()\n  let location = useLocation()\n  const history = useHistory()\n\n  const handleLanguageChange = lang => {\n    history.replace( location.pathname.replace('/'+i18n.language+'/', '/'+lang+'/') )\n    i18n.changeLanguage(lang)\n  }\n\n  return (\n    <Toolbar\n      className={classes.toolbar}\n    >\n      <div>\n        <Typography variant=\"h6\">香港</Typography>\n        <Typography variant='subtitle2'>獨立巴士預報</Typography>\n      </div>\n      <Input \n        type=\"text\"\n        value={searchRoute}\n        placeholder={t('搜尋巴士線')}\n        onChange={e => setSearchRoute(e.target.value)}\n        disabled={path.includes('route')}\n      />\n      <div\n        className={classes.tabsContainer}\n      >\n        <LanguageTabs\n            value={i18n.language}\n            onChange={(e, v) => handleLanguageChange(v)}\n          >\n          <LanguageTab value=\"en\" label=\"En\" />\n          <LanguageTab value=\"zh\" label=\"繁\" />\n        </LanguageTabs>\n      </div>\n    </Toolbar>\n  );\n}\n\nconst useStyles = makeStyles(theme => ({\n  tabsContainer: {\n    display: 'flex',\n    [theme.breakpoints.down('sm')]:{\n      flexDirection: \"row-reverse\"\n    }\n  },\n  toolbar: {\n    display: 'flex',\n    justifyContent: 'space-between',\n    zIndex: theme.zIndex.drawer * 2\n  }\n}))\n\nconst LanguageTabs = withStyles({\n  root: {\n    borderBottom: 'none',\n    minHeight: 24\n  },\n  indicator: {\n    backgroundColor: 'transparent'\n  }\n})(Tabs);\n\nconst LanguageTab = withStyles((theme) => ({\n  root: {\n    textTransform: 'none',\n    minWidth: 36,\n    fontWeight: 900,\n    marginRight: theme.spacing(0),\n    fontSize: '15px',\n    opacity: 1,\n    padding: '6px 6px'\n  },\n  selected:{\n    '& > .MuiTab-wrapper':{\n      color: '#3B3C45',\n      backgroundColor: '#FEFBFA'\n    }\n  },\n  wrapper: {\n    color: '#3B3C45',\n    borderRadius: '30px',\n    padding: '2px 10px 0px 10px'\n  },\n}))((props) => <Tab disableRipple {...props} />);\n\nexport default Header;","import React, { useContext } from 'react'\nimport { \n  Box,\n  Button,\n  Grid\n} from '@material-ui/core'\nimport {\n  makeStyles\n} from '@material-ui/styles'\nimport BackspaceOutlinedIcon from '@material-ui/icons/BackspaceOutlined';\n\nimport AppContext from '../AppContext'\nimport { useTranslation } from 'react-i18next';\n\nconst KeyButton = ({k, handleClick, disabled = false}) => {\n  const classes = useStyles()\n  const { t } = useTranslation()\n  return (\n    <Button \n      size=\"large\"\n      variant=\"contained\" \n      className={classes.button}\n      onClick={() => handleClick(k)}\n      disabled={disabled}\n    >\n      {k === 'b' ? <BackspaceOutlinedIcon/> : \n        k === '-' ? t('取消') : k}\n    </Button>\n  )\n}\n\nconst RouteNumPad = () => {\n  const { searchRoute, updateSearchRouteByButton, possibleChar } = useContext( AppContext )\n\n  return (\n    <Grid container spacing={0}>\n    {\n      '789456123-0b'.split('').map( k => (\n        <Grid item xs={4} key={'input-'+k}>\n          <KeyButton\n            k={k}\n            handleClick={updateSearchRouteByButton}\n            disabled={\n              (k === 'b' && searchRoute === '') \n              || ( !'b-'.includes(k) && !possibleChar.includes(k))\n              || ( k === '-' && searchRoute === '' )\n            }\n          />\n        </Grid>\n      ))\n    }\n    </Grid>\n  )\n}\n\nconst RouteAlphabetPad = () => {\n  const { updateSearchRouteByButton, possibleChar } = useContext( AppContext )\n  \n  return (\n    <Grid container spacing={1}>\n      {\n        possibleChar.filter(k => isNaN(k)).map(k => (\n          <Grid item xs={12} key={'input-'+k}>\n            <KeyButton\n              k={k}\n              handleClick={updateSearchRouteByButton}\n            />\n          </Grid>\n        )) \n      }\n    </Grid>\n  )\n}\n\nconst RouteInputPad = () => {\n\n  const classes = useStyles()\n  const padding = 0\n\n  return (\n    <Box className={classes.boxContainer} padding={padding}>\n      <Box className={classes.numPadContainer} padding={padding}>\n        <RouteNumPad />\n      </Box>\n      <Box className={classes.alphabetPadContainer} padding={padding}>\n        <RouteAlphabetPad />\n      </Box>\n    </Box>\n  )\n}\n\nexport default RouteInputPad\n\nconst useStyles = makeStyles(theme => ({\n  boxContainer: {\n    display: 'flex',\n    flexDirection: 'row',\n    height: '180px',\n    justifyContent: 'space-around'\n  },\n  numPadContainer: {\n    width: '60%',\n  },\n  alphabetPadContainer: {\n    width: '20%',\n    height: '100%',\n    overflowX: 'hidden',\n    overflowY: 'scroll'\n  },\n  button: {\n    width: '100%',\n    height: 42,\n    borderRadius: 'unset'\n  }\n}))","import React, { useContext } from 'react'\nimport {\n  Card,\n  CardActionArea,\n  CardContent,\n  Typography\n} from '@material-ui/core'\nimport { makeStyles } from '@material-ui/core/styles'\nimport AppContext from '../AppContext'\nimport { useTranslation } from 'react-i18next'\nimport { FixedSizeList as List, areEqual } from 'react-window'\nimport memorize from 'memoize-one'\nimport RouteInputPad from './RouteInputPad'\nimport { Link } from  'react-router-dom'\n\nconst RouteRow = React.memo(( {data, index, style} ) => {\n  const { t, i18n } = useTranslation()\n  const { routeList } = data\n  const route = routeList[index]\n  const [routeNo, service_type] = route[0].split('+').slice(0,2)\n  const classes = useStyles()\n\n  return (\n    <Link to={'/'+i18n.language+'/route/'+route[0]}>\n      <Card variant=\"outlined\" key={route[0]} style={style} square>\n        <CardActionArea>\n          <CardContent className={classes.cardContent}>\n            <Typography variant=\"h5\" display=\"inline\">{routeNo}</Typography>\n            <Typography variant=\"caption\"> - {route[1].co.map(co => t(co)).join('+')}</Typography>\n            <br/>\n            <Typography variant=\"subtitle2\" display=\"inline\">{t('往')} {route[1].dest[i18n.language]}  </Typography>\n            <Typography variant=\"caption\">{service_type >= '2' ? t('特別班次') : '　'}</Typography>\n          </CardContent>\n        </CardActionArea>\n      </Card>\n    </Link>\n  )\n}, areEqual)\n\nconst createItemData = memorize((routeList) => ({routeList}))\n\nconst RouteList = () => {\n  const { routeList, searchRoute } = useContext(AppContext)\n  const targetRouteList = Object.entries(routeList).filter(\n    element => element[0].startsWith(searchRoute.toUpperCase())\n  ) \n\n  const itemData = createItemData(targetRouteList)\n  return (\n    <List\n      height={358}\n      itemCount={targetRouteList.length}\n      itemSize={69}\n      width=\"100%\"\n      itemData={itemData}\n    >\n        {RouteRow}\n    </List>\n  )\n}\n\nconst RouteBoard = () => {\n  return (\n    <>\n      <RouteList />\n      <hr/>\n      <RouteInputPad />\n    </>\n  )\n}\n\nexport default RouteBoard\n\nconst useStyles = makeStyles (theme => ({\n  cardContent: {\n    padding: '8px 16px',\n  }\n}))","import React, { useState, useEffect, useContext, useRef } from 'react'\nimport { useParams, useHistory } from 'react-router-dom'\nimport MuiAccordion from'@material-ui/core/Accordion'\nimport MuiAccordionSummary from'@material-ui/core/AccordionSummary'\nimport MuiAccordionDetails from'@material-ui/core/AccordionDetails'\nimport {\n  Box, CircularProgress, Typography\n} from '@material-ui/core'\nimport { makeStyles, withStyles } from '@material-ui/core/styles'\nimport AppContext from '../AppContext'\nimport { useTranslation } from 'react-i18next'\nimport { \n  fetchRouteStops as fetchRouteStopsViaApi,\n  fetchEtas as fetchEtasViaApi \n} from '../data-api'\n\nconst RouteEta = () => {\n  const { id, panel } = useParams()\n  const [ expanded, setExpanded ] = useState(false)\n  const { routeList, stopList, updateRouteList, updateStopList, setSelectedRoute } = useContext ( AppContext )\n  const [ route, serviceType, bound ] = id.split('+').slice(0,3)\n  const { i18n } = useTranslation()\n  const history = useHistory()\n  const accordionRef = useRef([])\n\n  const routeObj = routeList[id]\n\n  const handleChange = ( panel ) => (event, newExpanded) => {\n    setExpanded(newExpanded ? panel : false)\n    if ( newExpanded ) {\n      history.replace(`/${i18n.language}/route/${id}/${panel}`)\n      setSelectedRoute(`${id}/${panel}`)\n      return\n    }\n  }\n\n  useEffect(() => {\n    // check if stops not fetched\n    if ( routeObj.co.filter(co => routeObj.stops[co] == null).length ) {\n      // fetch in parallel\n      Promise.all(\n        routeObj.co.map(co => {\n          if ( routeObj.stops[co] !== null ) return null;\n          return fetchRouteStopsViaApi({\n            route, serviceType, bound, co\n          })\n        }).filter(v => v)\n      ).then(objs => {\n        // set stop list\n        let _stopList = {}\n        objs.forEach( obj => {\n          _stopList = {..._stopList, ...obj.stopList}\n        } )\n        updateStopList({...stopList, ..._stopList})\n\n        // set route list\n        updateRouteList(prevRouteList => {\n          let _routeList = JSON.parse(JSON.stringify(prevRouteList))\n          objs.forEach(obj => _routeList[id].stops[obj.co] = obj.routeStops)\n          return _routeList\n        })\n      })\n    }\n\n    if ( parseInt(panel) && accordionRef.current[parseInt(panel)] ) {\n      setExpanded(parseInt(panel))\n      accordionRef.current[parseInt(panel)].scrollIntoView({behavior: 'smooth', block: 'nearest'})\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  const classes = useStyles()\n\n  if ( routeObj.stops[routeObj.co[0]] == null ) {\n    return (\n      <Box className={classes.loadingContainer}>\n        <CircularProgress size={30} />\n      </Box>\n    )\n  }\n\n  return (\n    <Box className={classes.boxContainer}>\n      {\n        routeObj.stops[routeObj.co[0]].map((stop, idx) => (\n          <Accordion \n            key={'stop-'+idx} \n            expanded={expanded === idx}\n            onChange={handleChange(idx)}\n            TransitionProps={{unmountOnExit: true}}\n            ref={el => {accordionRef.current[idx] = el}}\n          >\n            <AccordionSummary>{stopList[stop].name[i18n.language]}</AccordionSummary>\n            <AccordionDetails>\n              <TimeReport \n                route={route}\n                seq={idx + 1}\n                routeStops={routeObj.stops}\n                serviceType={serviceType}\n                bound={bound}\n                co={routeList[id].co}\n                routeSize={routeObj.stops[routeObj.co[0]].length}\n              />\n            </AccordionDetails>\n          </Accordion>\n        ))\n      }\n    </Box>\n  )\n}\n\nexport default RouteEta\n\nconst TimeReport = ( { route, routeStops, seq, bound, serviceType, co, routeSize } ) => {\n  const { t, i18n } = useTranslation()\n  const [ etas, setEtas ] = useState(null)\n\n  const fetchEtas = () => {\n    const fetchData = async () => {\n      setEtas( await fetchEtasViaApi({route, routeStops, seq, bound, serviceType, co, routeSize}) )\n    }\n    fetchData()\n  }\n\n  useEffect( () => {\n    fetchEtas()\n    const fetchEtaInterval = setInterval(() => {\n      fetchEtas()\n    }, 30000)\n\n    return () => clearInterval(fetchEtaInterval)\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  if ( etas == null ) {\n    return (\n      <CircularProgress size={20} style={{}} />\n    )\n  }\n\n  const displayMsg = (eta) => {\n    let ret = ''\n    switch (eta) {\n      case null: \n        break\n      case 0: \n        ret = '- '+t('分鐘')\n        break\n      default:\n        ret = eta + \" \" + t('分鐘')\n        break\n    }\n    return ret\n  }\n  \n  return (\n    <div>\n      {\n        etas.length === 0 ? t('暫無班次') : (\n          etas.map((eta, idx) => (\n            <Typography variant=\"subtitle1\" key={`route-${idx}`}>\n              {displayMsg(eta.eta)} {eta.remark[i18n.language] ? ' - ' + eta.remark[i18n.language] : '' } {t(eta.co)}\n            </Typography>\n          ))\n        )\n      }\n    </div>\n  )\n}\n\nconst Accordion = withStyles({\n  root: {\n    border: '1px solid rgba(0, 0, 0, .125)',\n    boxShadow: 'none',\n    '&:not(:last-child)': {\n      borderBottom: 0,\n    },\n    '&:before': {\n      display: 'none',\n    },\n    '&$expanded': {\n      margin: 'auto',\n    },\n  },\n  expanded: {},\n})(MuiAccordion)\n\nconst AccordionSummary = withStyles({\n  root: {\n    backgroundColor: 'rgba(0, 0, 0, .03)',\n    borderBottom: '1px solid rgba(0, 0, 0, .125)',\n    marginBottom: -1,\n    minHeight: 56,\n    '&$expanded': {\n      minHeight: 56,\n    },\n  },\n  content: {\n    '&$expanded': {\n      margin: '12px 0',\n    },\n  },\n  expanded: {},\n})(MuiAccordionSummary);\n\nconst AccordionDetails = withStyles((theme) => ({\n  root: {\n    padding: theme.spacing(2),\n  },\n}))(MuiAccordionDetails);\n\nconst useStyles = makeStyles(theme => ({\n  boxContainer: {\n    overflowY: 'scroll'\n  },\n  loadingContainer: {\n    display: 'flex',\n    justifyContent: 'center'\n  }\n}))","import React, { useContext, useEffect, useState } from 'react'\nimport AppContext from '../AppContext'\nimport {\n  Avatar,\n  List,\n  ListItem,\n  ListItemAvatar,\n  ListItemText,\n  Paper,\n  Snackbar\n} from '@material-ui/core'\nimport { makeStyles } from '@material-ui/core/styles'\nimport BuildIcon from '@material-ui/icons/Build'\nimport LocationOnIcon from '@material-ui/icons/LocationOn'\nimport LocationOffIcon from '@material-ui/icons/LocationOff'\nimport { useTranslation } from 'react-i18next'\nimport MonetizationOnIcon from '@material-ui/icons/MonetizationOn';\nimport moment from 'moment'\n\nconst Settings = () => {\n  const { schemaVersion, updateTime, geoPermission, updateGeoPermission, renewDb } = useContext ( AppContext )\n  const [ updating, setUpdating ] = useState(false)\n\n  const { t, i18n } = useTranslation()\n  const classes = useStyles()\n\n  useEffect(() => {\n    setUpdating(false)\n  }, [updateTime])\n\n  return (\n    <Paper className={classes.root}>\n      <List>\n        <ListItem\n          button\n          onClick={() => {setUpdating(true);renewDb()}}\n        >\n          <ListItemAvatar>\n            <Avatar><BuildIcon /></Avatar>\n          </ListItemAvatar>\n          <ListItemText \n            primary={t(\"架構版本\")+\": \"+schemaVersion} \n            secondary={t('更新時間：') + \" \" + moment(updateTime).format('YYYY-MM-DD HH:mm:ss')} \n          />\n        </ListItem>\n      </List>\n      <List>\n        <ListItem\n          button\n          onClick={() => {\n            if ( geoPermission === 'granted' ) {\n              updateGeoPermission('closed')\n            } else {\n              navigator.geolocation.getCurrentPosition(position => {\n                updateGeoPermission('granted')\n              })\n            }\n          }}\n        >\n          <ListItemAvatar>\n            <Avatar>{geoPermission === 'granted' ? <LocationOnIcon /> : <LocationOffIcon />}</Avatar>\n          </ListItemAvatar>\n          <ListItemText \n            primary={t(\"地理位置定位功能\")} \n            secondary={t(geoPermission === 'granted' ? '開啟' : '關閉') } \n          />\n        </ListItem>\n      </List>\n      <List>\n      <ListItem\n          button\n          component='a'\n          href={`https://donate.612fund.hk/${i18n.language}/`}\n          target=\"_blank\"\n        >\n          <ListItemAvatar>\n            <Avatar><MonetizationOnIcon /></Avatar>\n          </ListItemAvatar>\n          <ListItemText \n            primary={t(\"捐款支持\")} \n            secondary={t('請捐款到 612 人道支援基金') } \n          />\n        </ListItem>\n      </List>\n      <Snackbar\n        anchorOrigin={{vertical: 'bottom', horizontal: 'center'}}\n        open={updating}\n        message={t('資料更新中...')}\n      />\n    </Paper>\n  )\n}\n\nexport default Settings\n\nconst useStyles = makeStyles ( theme => ({\n  root: {\n    background: 'white',\n    height: 'calc(100vh - 120px)'\n  }\n}))","import React, { useContext } from 'react'\nimport {\n  BottomNavigation,\n  BottomNavigationAction\n} from '@material-ui/core'\nimport SearchIcon from '@material-ui/icons/Search'\nimport TimerIcon from '@material-ui/icons/Timer'\nimport SettingsIcon from '@material-ui/icons/Settings';\nimport { Link, useLocation } from 'react-router-dom'\nimport { useTranslation } from 'react-i18next'\nimport AppContext from './AppContext'\n\nconst Footer = () => {\n  const { t, i18n } = useTranslation()\n  const location = useLocation()\n  const { selectedRoute } = useContext ( AppContext ) \n  \n  return (\n    <BottomNavigation\n      value={location.pathname}\n      showLabels={true}\n    >\n      <BottomNavigationAction \n        label={t(\"搜尋\")}\n        component={Link}\n        to={`/${i18n.language}/search`}\n        value={`/${i18n.language}/search`}\n        icon={<SearchIcon />} \n      />\n      <BottomNavigationAction\n       label={selectedRoute.split('+')[0]}\n       component={Link}\n       to={`/${i18n.language}/route/${selectedRoute}`}\n       value={`/${i18n.language}/route/${selectedRoute}`}\n       icon={<TimerIcon />} \n      />\n      <BottomNavigationAction\n       label={t(\"設定\")}\n       component={Link}\n       to={`/${i18n.language}/settings`}\n       value={`/${i18n.language}/settings`}\n       icon={<SettingsIcon />} \n      />\n    </BottomNavigation>\n  )\n}\n\nexport default Footer","import './App.css'\nimport { MuiThemeProvider, createMuiTheme } from '@material-ui/core/styles'\nimport React, { useContext } from 'react'\nimport {\n  HashRouter as Router,\n  Redirect,\n  Switch,\n  Route,\n  useRouteMatch\n} from \"react-router-dom\";\nimport {\n  CircularProgress,\n  Container,\n  CssBaseline,\n  Paper,\n  Typography\n} from '@material-ui/core'\nimport {\n  makeStyles\n} from '@material-ui/core/styles'\nimport Header from './components/Header'\nimport RouteBoard from './components/RouteBoard'\nimport RouteEta from './components/RouteEta'\nimport Settings from './components/Settings'\nimport AppContext from './AppContext'\nimport Footer from './Footer'\nimport Countdown from 'react-countdown'\n\nconst PageSwitch = () => {\n  const { path } = useRouteMatch()\n  return (\n    <Switch>\n      <Route path={`${path}/route/:id/:panel?`}>\n        <RouteEta />\n      </Route>\n      <Route path={`${path}/settings`}>\n        <Settings />\n      </Route>      \n      <Route path={`${path}/search`}>\n        <RouteBoard />\n      </Route>\n    </Switch>\n  )\n}\n\nconst App = () => {\n  /*\n  navigator.geolocation.getCurrentPosition(position => {\n    console.log(position.coords.latitude, position.coords.longitude)\n  })\n  */\n  \n  const classes = useStyles()\n  const { routeList, stopList } = useContext( AppContext )\n  if ( routeList == null || stopList == null ) {\n    return (\n      <Container maxWidth='xs' disableGutters className={classes.loadingContainer}>\n        <CircularProgress size={40} />\n        <br />\n        <br />\n        <Paper className={classes.loadingTextContainer} elevation={0}>\n          <Countdown \n            date={Date.now() + 20000}\n            renderer={({seconds, completed}) => {\n              if ( completed ) {\n                return <Typography variant=\"subtitle2\" align=\"center\">介面開啟中...</Typography>\n              } else {\n                return (\n                  <>\n                    <Typography variant=\"subtitle2\" align=\"center\">初始設定...</Typography>\n                    <Typography variant=\"subtitle2\" align=\"center\">正在更新巴士路線資料...</Typography>\n                    <Typography variant=\"subtitle2\" align=\"center\">約需{seconds}秒</Typography>\n                  </>\n                )\n              }\n            }}\n          />\n            \n        </Paper>\n      </Container>\n    )\n  } \n\n  return (\n    <MuiThemeProvider theme={Theme}>\n      <Container maxWidth='xs' disableGutters className={classes.container}>\n        <Router>\n          <Route exact path=\"/\">\n            <Redirect to=\"/zh/search\" />\n          </Route>\n          <Route path=\"/:lang\">\n            <CssBaseline />\n            <Header />\n            <PageSwitch />\n            <Footer />\n          </Route>\n        </Router>\n      </Container>\n    </MuiThemeProvider>\n  );\n}\n\nexport default App;\n\nconst Theme = createMuiTheme({\n  typography: {\n    fontFamily: \"Noto Sans TC, Chivo, sans-serif\"\n  },\n  palette: {\n    background: {\n      default: \"#ffff00\" // yellow\n    }\n  }\n})\n\nconst useStyles = makeStyles( theme => ({\n  container: {\n    display: 'flex',\n    flexDirection: 'column',\n    justifyContent: 'space-between',\n    height: '100vh'\n  },\n  loadingContainer: {\n    display: 'flex',\n    flexDirection: 'column',\n    justifyContent: 'center',\n    alignItems: 'center',\n    height: '100vh'\n  },\n  loadingText: {\n\n  }\n}))\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import i18n from \"i18next\";\nimport { initReactI18next } from \"react-i18next\";\nimport resources from \"./i18n/translation.json\";\n\nconst DEFAULT_LANG = window.location.pathname.substr(1,2) === 'en' ? 'en' : 'zh'\n\ni18n\n  .use(initReactI18next)\n  .init({\n    resources,\n    whitelist: ['en', 'zh'],\n    lowerCaseLng: true,\n    lng: DEFAULT_LANG,\n    nsSeparator: false,\n    keySeparator: false,\n    debug: false,\n\n    interpolation:{\n      escapeValue: false\n    }\n  });\n\nexport default i18n;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\nimport { AppContextProvider } from './AppContext'\nimport './i18n'\n\nReactDOM.render(\n  //<React.StrictMode>\n    <AppContextProvider>\n      <App />\n    </AppContextProvider>\n  //</React.StrictMode>,\n  ,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}