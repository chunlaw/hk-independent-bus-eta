(this["webpackJsonphk-independent-bus-eta"]=this["webpackJsonphk-independent-bus-eta"]||[]).push([[0],{114:function(t,e,n){"use strict";n.r(e);var a=n(0),r=n.n(a),c=n(21),o=n.n(c),s=(n(95),n(96),n(144)),i=n(83),u=n(10),l=n(30),b=n(145),j=n(146),d=n(77),h=n(49),p=n(134),x=n(135),O=n(149),f=n(148),g=n(137),m=n(136),v=n(5),k=n(151),C=n(22),S=n.n(C),w=n(35),y=n(23),L=n(36),I=n.n(L),B=n(2),z=r.a.createContext(),N=function(t){var e=Object(a.useState)(null),n=Object(y.a)(e,2),r=n[0],c=n[1],o=Object(a.useState)(null),s=Object(y.a)(o,2),i=s[0],u=s[1],l=Object(a.useState)(""),b=Object(y.a)(l,2),j=b[0],d=b[1],h=Object(a.useState)([]),p=Object(y.a)(h,2),x=p[0],O=p[1];Object(a.useEffect)((function(){E().then((function(){var t=JSON.parse(localStorage.getItem("routeList"));c(t),O(D("",t))})),R().then((function(){var t=JSON.parse(localStorage.getItem("stopList"));u(t)}))}),[]),Object(a.useEffect)((function(){O(D(j,r))}),[j,r]);return Object(B.jsx)(z.Provider,{value:{routeList:r,setRouteList:c,stopList:i,setStopList:u,searchRoute:j,setSearchRoute:d,updateSearchRouteByButton:function(t){switch(t){case"b":d(j.slice(0,-1));break;case"-":d("");break;default:d(j+t)}},possibleChar:x},children:t.children})},T=z,E=function(){var t=Object(w.a)(S.a.mark((function t(){var e,n,a;return S.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(null==localStorage.getItem("routeList")||localStorage.getItem("routeListDbTime")<I()().subtract(1,"days").format("YYYY-MM-DDTHH:mm:ssZZ"))){t.next=18;break}return e={},t.next=4,fetch("https://data.etabus.gov.hk/v1/transport/kmb/route/");case 4:return n=t.sent,t.next=7,n.json();case 7:return(a=t.sent).data.forEach((function(t){e[t.route+"+"+t.service_type+"+"+t.bound+"+kmb"]={orig:{en:t.orig_en,zh:t.orig_tc},dest:{en:t.dest_en,zh:t.dest_tc},stops:[]}})),t.next=11,fetch("https://data.etabus.gov.hk/v1/transport/kmb/route-stop/");case 11:return n=t.sent,t.next=14,n.json();case 14:(a=t.sent).data.forEach((function(t){e[t.route+"+"+t.service_type+"+"+t.bound+"+kmb"].stops.push(t.stop)})),localStorage.setItem("routeList",JSON.stringify(e)),localStorage.setItem("routeListDbTime",a.generated_timestamp);case 18:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),R=function(){var t=Object(w.a)(S.a.mark((function t(){var e,n,a;return S.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(null==localStorage.getItem("stopList")||localStorage.getItem("stopDbTime")<I()().subtract(1,"days").format("YYYY-MM-DDTHH:mm:ssZZ"))){t.next=11;break}return e={},t.next=4,fetch("https://data.etabus.gov.hk/v1/transport/kmb/stop");case 4:return n=t.sent,t.next=7,n.json();case 7:(a=t.sent).data.forEach((function(t){e[t.stop]={name:{en:t.name_en,zh:t.name_tc},location:{lat:t.lat,long:t.long}}})),localStorage.setItem("stopList",JSON.stringify(e)),localStorage.setItem("stopDbTime",a.generated_timestamp);case 11:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),D=function(t,e){if(null==e)return[];var n={};return Object.entries(e).forEach((function(e){e[0].startsWith(t.toUpperCase())&&(n[e[0].slice(t.length,t.length+1)]=!0)})),Object.entries(n).map((function(t){return t[0]})).filter((function(t){return"+"!==t}))},_=Object(m.a)((function(t){return{tabsContainer:Object(h.a)({display:"flex"},t.breakpoints.down("sm"),{flexDirection:"row-reverse"}),toolbar:{display:"flex",justifyContent:"space-between",zIndex:2*t.zIndex.drawer}}})),F=Object(v.a)({root:{borderBottom:"none",minHeight:24},indicator:{backgroundColor:"transparent"}})(f.a),P=Object(v.a)((function(t){return{root:{textTransform:"none",minWidth:36,fontWeight:900,marginRight:t.spacing(0),fontSize:"15px",opacity:1,padding:"6px 6px"},selected:{"& > .MuiTab-wrapper":{color:"#3B3C45",backgroundColor:"#FEFBFA"}},wrapper:{color:"#3B3C45",borderRadius:"30px",padding:"2px 10px 0px 10px"}}}))((function(t){return Object(B.jsx)(g.a,Object(d.a)({disableRipple:!0},t))})),Y=function(t){var e=Object(a.useContext)(T),n=e.searchRoute,r=e.setSearchRoute,c=Object(u.j)().path,o=Object(k.a)(),s=o.t,i=o.i18n,l=_(),b=Object(u.h)(),j=Object(u.g)();return Object(B.jsxs)(p.a,{className:l.toolbar,children:[Object(B.jsxs)("div",{children:[Object(B.jsx)(x.a,{variant:"h6",children:"\u9999\u6e2f"}),Object(B.jsx)(x.a,{variant:"subtitle2",children:"\u7368\u7acb\u5df4\u58eb\u9810\u5831"})]}),Object(B.jsx)(O.a,{type:"text",value:n,placeholder:s("\u641c\u5c0b\u5df4\u58eb\u7dda"),onChange:function(t){return r(t.target.value)},disabled:c.includes("route")}),Object(B.jsx)("div",{className:l.tabsContainer,children:Object(B.jsxs)(F,{value:i.language,onChange:function(t,e){return n=e,j.replace(b.pathname.replace("/"+i.language+"/","/"+n+"/")),void i.changeLanguage(n);var n},children:[Object(B.jsx)(P,{value:"en",label:"En"}),Object(B.jsx)(P,{value:"zh",label:"\u7e41"})]})})]})},H=n(140),J=n(141),M=n(142),W=n(117),Z=n(69),$=n(26),U=n(138),A=n(139),G=n(147),V=n(81),X=n.n(V),q=function(t){var e=t.k,n=t.handleClick,a=t.disabled,r=void 0!==a&&a,c=et(),o=Object(k.a)().t;return Object(B.jsx)(U.a,{variant:"contained",className:c.button,onClick:function(){return n(e)},disabled:r,children:"b"===e?Object(B.jsx)(X.a,{}):"-"===e?o("\u53d6\u6d88"):e})},K=function(){var t=Object(a.useContext)(T),e=t.searchRoute,n=t.updateSearchRouteByButton,r=t.possibleChar;return Object(B.jsx)(A.a,{container:!0,spacing:1,children:"789456123-0b".split("").map((function(t){return Object(B.jsx)(A.a,{item:!0,xs:4,children:Object(B.jsx)(q,{k:t,handleClick:n,disabled:"b"===t&&""===e||!"b-".includes(t)&&!r.includes(t)||"-"===t&&""===e})},"input-"+t)}))})},Q=function(){var t=Object(a.useContext)(T),e=t.updateSearchRouteByButton,n=t.possibleChar;return Object(B.jsx)(A.a,{container:!0,spacing:1,children:n.filter((function(t){return isNaN(t)})).map((function(t){return Object(B.jsx)(A.a,{item:!0,xs:12,children:Object(B.jsx)(q,{k:t,handleClick:e})},"input-"+t)}))})},tt=function(){var t=et();return Object(B.jsxs)(G.a,{className:t.boxContainer,padding:0,children:[Object(B.jsx)(G.a,{className:t.numPadContainer,padding:0,children:Object(B.jsx)(K,{})}),Object(B.jsx)(G.a,{className:t.alphabetPadContainer,padding:0,children:Object(B.jsx)(Q,{})})]})},et=Object(W.a)((function(t){return{boxContainer:{display:"flex",flexDirection:"row",height:"180px",justifyContent:"space-around"},numPadContainer:{width:"60%"},alphabetPadContainer:{width:"20%",height:"100%",overflowX:"hidden",overflowY:"scroll"},button:{width:"100%"}}})),nt=r.a.memo((function(t){var e=t.data,n=t.index,a=t.style,r=Object(k.a)().i18n,c=e.routeList[n];return Object(B.jsx)(l.b,{to:"/"+r.language+"/route/"+c[0],children:Object(B.jsx)(H.a,{variant:"outlined",style:a,children:Object(B.jsx)(J.a,{children:Object(B.jsxs)(M.a,{children:[Object(B.jsx)(x.a,{variant:"h5",children:c[0].replace(/\+.*/,"")}),Object(B.jsxs)(x.a,{variant:"subtitle2",children:[c[1].orig[r.language]," \u2794 ",c[1].dest[r.language]]})]})})},c[0])})}),Z.b),at=Object($.a)((function(t){return{routeList:t}})),rt=function(){var t=Object(a.useContext)(T),e=t.routeList,n=t.searchRoute,r=Object.entries(e).filter((function(t){return t[0].startsWith(n.toUpperCase())})),c=at(r);return Object(B.jsx)(Z.a,{height:300,itemCount:r.length,itemSize:85,width:"100%",itemData:c,children:nt})},ct=function(){ot();return Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)(rt,{}),Object(B.jsx)("hr",{}),Object(B.jsx)(tt,{})]})},ot=Object(W.a)((function(t){return{container:{background:"white"}}})),st=n(150),it=n(152),ut=n(143),lt=function(){var t=Object(u.i)().id,e=Object(a.useState)(null),n=Object(y.a)(e,2),r=n[0],c=n[1],o=Object(a.useState)(!1),s=Object(y.a)(o,2),i=s[0],l=s[1],b=Object(a.useContext)(T),j=b.routeList,d=b.stopList,h=t.split("+"),p=Object(y.a)(h,4),x=p[0],O=p[1],f=p[2],g=p[3];if(Object(a.useEffect)(Object(w.a)(S.a.mark((function t(){var e,n;return S.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("kmb"!==g){t.next=8;break}return t.next=3,fetch("https://data.etabus.gov.hk/v1/transport/kmb/route-eta/".concat(x,"/").concat(O));case 3:return e=t.sent,t.next=6,e.json();case 6:n=t.sent,c(n.data.filter((function(t){return t.dir===f})));case 8:case"end":return t.stop()}}),t)}))),[]),null===r)return Object(B.jsx)("div",{children:"Loading"});return Object(B.jsx)(G.a,{children:j[t].stops.map((function(t,e){return Object(B.jsxs)(jt,{expanded:i===e,onChange:(n=e,function(t,e){l(!!e&&n)}),TransitionProps:{unmountOnExit:!0},children:[Object(B.jsx)(dt,{children:d[t].name.zh}),Object(B.jsx)(ht,{children:Object(B.jsx)(bt,{route:x,stopId:t,serviceType:O})})]},"stop-"+e);var n}))})},bt=function(t){var e=Object(k.a)(),n=e.t,r=e.i18n,c=Object(a.useState)(null),o=Object(y.a)(c,2),s=o[0],i=o[1],u=t.route,l=t.stopId,b=t.serviceType;return Object(a.useEffect)(Object(w.a)(S.a.mark((function t(){var e,n,a;return S.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("https://data.etabus.gov.hk/v1/transport/kmb/eta/".concat(l,"/").concat(u,"/").concat(b));case 2:return e=t.sent,t.next=5,e.json();case 5:n=t.sent,a=[],n.data.forEach((function(t){a.push({eta:Math.trunc(I()(t.eta).diff(I()())/60/1e3),remark:{zh:t.rmk_tc,en:t.rmk_en}})})),console.log(a),i(a);case 10:case"end":return t.stop()}}),t)}))),[]),null==s?Object(B.jsx)(B.Fragment,{}):(console.log(s),Object(B.jsx)("div",{children:0==s.length?n("\u66ab\u7121\u73ed\u6b21"):s.map((function(t){return Object(B.jsxs)(x.a,{variant:"subtitle1",children:[t.eta||"-","\u5206\u9418 - ",t.remark[r.language]]})}))}))},jt=Object(v.a)({root:{border:"1px solid rgba(0, 0, 0, .125)",boxShadow:"none","&:not(:last-child)":{borderBottom:0},"&:before":{display:"none"},"&$expanded":{margin:"auto"}},expanded:{}})(st.a),dt=Object(v.a)({root:{backgroundColor:"rgba(0, 0, 0, .03)",borderBottom:"1px solid rgba(0, 0, 0, .125)",marginBottom:-1,minHeight:56,"&$expanded":{minHeight:56}},content:{"&$expanded":{margin:"12px 0"}},expanded:{}})(it.a),ht=Object(v.a)((function(t){return{root:{padding:t.spacing(2)}}}))(ut.a),pt=function(){var t=Object(u.j)().path;return Object(B.jsxs)(u.d,{children:[Object(B.jsx)(u.b,{path:"".concat(t,"/route/:id?"),children:Object(B.jsx)(lt,{})}),Object(B.jsx)(u.b,{children:Object(B.jsx)(ct,{})})]})},xt=function(){return navigator.geolocation.getCurrentPosition((function(t){console.log(t.coords.latitude,t.coords.longitude)})),null==Object(a.useContext)(T).routeList?Object(B.jsx)(B.Fragment,{children:"Loading"}):Object(B.jsx)(s.a,{theme:Ot,children:Object(B.jsx)(b.a,{maxWidth:"xs",disableGutters:!0,children:Object(B.jsxs)(l.a,{children:[Object(B.jsx)(u.b,{exact:!0,path:"/",children:Object(B.jsx)(u.a,{to:"/zh/"})}),Object(B.jsxs)(u.b,{path:"/:lang",children:[Object(B.jsx)(j.a,{}),Object(B.jsx)(Y,{}),Object(B.jsx)(pt,{})]})]})})})},Ot=Object(i.a)({typography:{fontFamily:"Noto Sans TC, Chivo, sans-serif"},palette:{background:{default:"yellow"}}}),ft=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,154)).then((function(e){var n=e.getCLS,a=e.getFID,r=e.getFCP,c=e.getLCP,o=e.getTTFB;n(t),a(t),r(t),c(t),o(t)}))},gt=n(70),mt=n(42),vt=n(82),kt="zh"===window.location.pathname.substr(1,2)?"zh":"en";gt.a.use(mt.e).init({resources:vt,whitelist:["en","zh"],lowerCaseLng:!0,lng:kt,nsSeparator:!1,keySeparator:!1,debug:!1,interpolation:{escapeValue:!1}});gt.a;o.a.render(Object(B.jsx)(r.a.StrictMode,{children:Object(B.jsx)(N,{children:Object(B.jsx)(xt,{})})}),document.getElementById("root")),ft()},82:function(t){t.exports=JSON.parse('{"en":{"translation":{}}}')},95:function(t,e,n){},96:function(t,e,n){}},[[114,1,2]]]);
//# sourceMappingURL=main.46350a5d.chunk.js.map