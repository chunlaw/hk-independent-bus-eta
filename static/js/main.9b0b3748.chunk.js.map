{"version":3,"sources":["data-api/Kmb.js","data-api/Nwfb.js","data-api/Ctb.js","data-api/index.js","AppContext.js","components/Header.js","components/RouteInputPad.js","components/RouteBoard.js","components/RouteEta.js","App.js","reportWebVitals.js","i18n.js","index.js"],"names":["KmbApi","co","fetchRouteList","fetch","then","response","json","data","routeList","forEach","element","route","service_type","bound","join","orig","en","orig_en","zh","orig_tc","dest","dest_en","dest_tc","stops","kmb","generated_timestamp","push","stop","fetchStopList","stopList","name","name_en","name_tc","location","lat","long","fetchEtas","stopId","seq","serviceType","filter","e","dir","map","eta","Math","trunc","moment","diff","remark","rmk_tc","rmk_en","NwfbApi","nwfb","fetchRouteStops","routeStops","Promise","all","rmk","CtbApi","ctb","console","log","a","routeSize","_etas","company_id","concat","sort","b","api","error","AppContext","React","createContext","AppContextProvider","props","useState","setRouteList","setStopList","searchRoute","setSearchRoute","possibleChar","setPossibleChar","useEffect","_routeList","JSON","parse","localStorage","getItem","getPossibleChar","_stopList","Provider","value","updateSearchRouteByButton","buttonValue","slice","children","subtract","format","_generated_timestamp","Object","entries","toUpperCase","setItem","stringify","startsWith","length","k","useStyles","makeStyles","theme","tabsContainer","display","breakpoints","down","flexDirection","toolbar","justifyContent","zIndex","drawer","LanguageTabs","withStyles","root","borderBottom","minHeight","indicator","backgroundColor","Tabs","LanguageTab","textTransform","minWidth","fontWeight","marginRight","spacing","fontSize","opacity","padding","selected","color","wrapper","borderRadius","Tab","disableRipple","Header","useContext","path","useRouteMatch","useTranslation","t","i18n","classes","useLocation","history","useHistory","Toolbar","className","Typography","variant","Input","type","placeholder","onChange","target","disabled","includes","language","v","lang","replace","pathname","changeLanguage","label","KeyButton","handleClick","Button","button","onClick","RouteNumPad","Grid","container","split","item","xs","RouteAlphabetPad","isNaN","RouteInputPad","Box","boxContainer","numPadContainer","alphabetPadContainer","height","width","overflowX","overflowY","RouteRow","memo","index","style","routeNo","to","Card","square","CardActionArea","CardContent","areEqual","createItemData","memorize","RouteList","targetRouteList","itemData","itemCount","itemSize","RouteBoard","RouteEta","id","useParams","expanded","setExpanded","routeObj","fetchRouteStopsViaApi","objs","obj","prevRouteList","loadingContainer","CircularProgress","size","idx","panel","event","newExpanded","TransitionProps","unmountOnExit","TimeReport","etas","setEtas","fetchEtasViaApi","fetchData","fetchEtaInterval","setInterval","clearInterval","displayMsg","ret","Accordion","border","boxShadow","margin","MuiAccordion","AccordionSummary","marginBottom","content","MuiAccordionSummary","AccordionDetails","MuiAccordionDetails","PageSwitch","App","Theme","Container","maxWidth","disableGutters","basename","process","exact","CssBaseline","createMuiTheme","typography","fontFamily","palette","background","default","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","DEFAULT_LANG","window","substr","use","initReactI18next","init","resources","whitelist","lowerCaseLng","lng","nsSeparator","keySeparator","debug","interpolation","escapeValue","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.9b0b3748.chunk.js","sourcesContent":["import moment from 'moment'\n\nconst KmbApi = {\n  co: 'kmb',\n  fetchRouteList: () => (\n    fetch(\n      \"https://data.etabus.gov.hk/v1/transport/kmb/route/\"\n    ).then(response => response.json())\n    .then( ({data}) => {\n      let routeList = {}\n      data.forEach(element => {\n        routeList[[element.route, element.service_type, element.bound].join('+')] = {\n          co: ['kmb'],\n          orig: {\n            en: element.orig_en,\n            zh: element.orig_tc\n          },\n          dest: {\n            en: element.dest_en,\n            zh: element.dest_tc\n          },\n          stops: {\n            kmb: []\n          }\n        }\n      })\n      return routeList\n    }).then( routeList => (\n      fetch(\"https://data.etabus.gov.hk/v1/transport/kmb/route-stop/\").then(response => response.json())\n      .then(({data, generated_timestamp}) => {\n        data.forEach(element => {\n          routeList[[element.route, element.service_type, element.bound].join('+')].stops.kmb.push(\n            element.stop\n          )\n        })\n        return [routeList, generated_timestamp]\n      })\n    ))\n  ),\n  fetchStopList: () => {\n    return fetch(\"https://data.etabus.gov.hk/v1/transport/kmb/stop\").then(\n      response => response.json()\n    ).then(({data, generated_timestamp}) => {\n      let stopList = {}\n      data.forEach(element => {\n        stopList[element.stop] = {\n          name: {\n            en: element.name_en,\n            zh: element.name_tc\n          },\n          location: {\n            lat: element.lat,\n            long: element.long\n          }\n        }\n      })\n      return [stopList, generated_timestamp]\n    })\n  },\n  /*\n    @fetchEtas\n    return array of Object with props {\n      eta: (int) minute or null,\n      remark: {\n        zh: string\n        en: string\n      }\n    }\n  */\n  fetchEtas: ({stopId, route, seq, serviceType, bound}) => {\n    return fetch(\n      `https://data.etabus.gov.hk/v1/transport/kmb/eta/${stopId}/${route}/${serviceType}`\n    ).then( response => response.json() )\n    .then(({data}) => data.filter(e => e.dir === bound && e.seq === seq).map(e => ({\n        eta: e.eta ? Math.trunc(moment(e.eta).diff(moment()) / 60 / 1000) : e.eta,\n        remark: {\n          zh: e.rmk_tc,\n          en: e.rmk_en\n        }\n      }))\n    )\n  }\n}\n\nexport default KmbApi","import moment from 'moment'\n\nconst NwfbApi = {\n  co: 'nwfb',\n  fetchRouteList: () => (\n    fetch(\"https://rt.data.gov.hk/v1/transport/citybus-nwfb/route/nwfb\")\n      .then(response => response.json())\n      .then(({data, generated_timestamp}) => {\n        let routeList = {}\n        data.forEach(element => {\n          routeList[[element.route,'1','O'].join('+')] = {\n            orig: {\n              en: element.orig_en,\n              zh: element.orig_tc\n            },\n            dest: {\n              en: element.dest_en,\n              zh: element.dest_tc\n            },\n            co: ['nwfb'],\n            stops: {\n              nwfb: null\n            }\n          }\n          routeList[[element.route,'1','I'].join('+')] = {\n            dest: {\n              en: element.orig_en,\n              zh: element.orig_tc\n            },\n            orig: {\n              en: element.dest_en,\n              zh: element.dest_tc\n            },\n            co: ['nwfb'],\n            stops: {\n              nwfb: null\n            }\n          }\n        })\n        return [routeList, generated_timestamp]\n      })\n  ),\n  fetchRouteStops: ({route, bound, routeList}) => {\n    // fetch route stop first\n    const dir = bound === 'I' ? 'inbound' : 'outbound'\n    return fetch(\n      `https://rt.data.gov.hk/v1/transport/citybus-nwfb/route-stop/NWFB/${route}/${dir}`\n    ).then( response => \n      response.json()\n    ).then( ({data}) => \n      data.map(e => e.stop) \n    ).then( routeStops => {\n      // fetch each stop in parallel\n      return Promise.all(routeStops.map(stopId => \n          fetch(`https://rt.data.gov.hk/v1/transport/citybus-nwfb/stop/${stopId}`).then(\n            response => response.json()\n          ).then ( ({data}) => ({\n            stopId: stopId,\n            name: {\n              zh: data.name_tc,\n              en: data.name_en\n            },\n            location: {\n              lat: data.lat,\n              long: data.long\n            }\n          }))\n        )).then( stops => {\n          let stopList = {};\n          stops.forEach(stop => stopList[stop.stopId] = stop)\n          return {routeStops, stopList, co: 'nwfb'}\n        })\n    })\n  },\n  fetchEtas: ({stopId, route, bound }) => {\n    return fetch(`https://rt.data.gov.hk/v1/transport/batch/stop-eta/NWFB/${stopId}?lang=zh-hant`).then(\n      response => response.json()\n    ).then(({data}) => data.filter(eta => eta.route === route && eta.dir === bound && eta.eta).map(e => ({\n        eta: e.eta ? Math.trunc(moment(e.eta).diff(moment()) / 60 / 1000) : e.eta,\n        remark: {\n          zh: e.rmk,\n          en: e.rmk\n        }\n      }))\n    )\n  }\n}\n\nexport default NwfbApi","import moment from 'moment'\n\nconst CtbApi = {\n  co: 'ctb',\n  fetchRouteList: () => (\n    fetch(\"https://rt.data.gov.hk/v1/transport/citybus-nwfb/route/ctb\")\n      .then(response => response.json())\n      .then(({data, generated_timestamp}) => {\n        let routeList = {}\n        data.forEach(element => {\n          routeList[[element.route,'1','O'].join('+')] = {\n            orig: {\n              en: element.orig_en,\n              zh: element.orig_tc\n            },\n            dest: {\n              en: element.dest_en,\n              zh: element.dest_tc\n            },\n            co: ['ctb'],\n            stops: {\n              ctb: null\n            }\n          }\n          routeList[[element.route,'1','I'].join('+')] = {\n            dest: {\n              en: element.orig_en,\n              zh: element.orig_tc\n            },\n            orig: {\n              en: element.dest_en,\n              zh: element.dest_tc\n            },\n            co: ['ctb'],\n            stops: {\n              ctb: null\n            }\n          }\n        })\n        return [routeList, generated_timestamp]\n      })\n  ),\n  fetchRouteStops: ({route, bound, routeList}) => {\n    // fetch route stop first\n    const dir = bound === 'I' ? 'inbound' : 'outbound'\n    return fetch(\n      `https://rt.data.gov.hk/v1/transport/citybus-nwfb/route-stop/CTB/${route}/${dir}`\n    ).then( response => \n      response.json()\n    ).then( ({data}) => \n      data.map(e => e.stop) \n    ).then( routeStops => {\n      // fetch each stop in parallel\n      return Promise.all(routeStops.map(stopId => \n          fetch(`https://rt.data.gov.hk/v1/transport/citybus-nwfb/stop/${stopId}`).then(\n            response => response.json()\n          ).then ( ({data}) => ({\n            stopId: stopId,\n            name: {\n              zh: data.name_tc,\n              en: data.name_en\n            },\n            location: {\n              lat: data.lat,\n              long: data.long\n            }\n          }))\n        )).then( stops => {\n          let stopList = {};\n          stops.forEach(stop => stopList[stop.stopId] = stop)\n          console.log(stopList)\n          return {routeStops, stopList, co: 'ctb'}\n        })\n    })\n  },\n  fetchEtas: ({stopId, route, bound }) => {\n    return fetch(`https://rt.data.gov.hk/v1/transport/batch/stop-eta/CTB/${stopId}?lang=zh-hant`).then(\n      response => response.json()\n    ).then(({data}) => data.filter(eta => eta.route === route && eta.dir === bound).map(e => ({\n        eta: e.eta ? Math.trunc(moment(e.eta).diff(moment()) / 60 / 1000) : e.eta,\n        remark: {\n          zh: e.rmk,\n          en: e.rmk\n        }\n      }))\n    )\n  }\n}\n\nexport default CtbApi","import KmbApi from './Kmb'\nimport NwfbApi from './Nwfb'\nimport CtbApi from './Ctb'\n\nconst fetchEtas = async ( {route, routeStops, bound, seq, serviceType, co, routeSize}) => {\n  let _etas = []\n  for ( const company_id of co ) {\n    if (company_id === 'kmb' && routeStops.kmb ){\n      _etas = _etas.concat( await KmbApi.fetchEtas({\n        route,\n        stopId: routeStops.kmb[seq-1], \n        seq: (seq === routeSize ? 1000 : seq), \n        serviceType, bound}) \n      )\n    }\n    else if ( company_id === 'ctb' && routeStops.ctb ) {\n      _etas = _etas.concat( await CtbApi.fetchEtas({stopId: routeStops.ctb[seq-1], route, bound }))\n    }\n    else if ( company_id === 'nwfb' && routeStops.nwfb ) {\n      _etas = _etas.concat( await NwfbApi.fetchEtas({stopId: routeStops.nwfb[seq-1], route, bound }))\n    }\n  }\n  return _etas.sort((a,b) => a.eta < b.eta ? -1 : 1)\n}\n\nconst fetchRouteStops = async ( {route, serviceType, bound, co} ) => {\n  let api\n  if (co === 'kmb') api = KmbApi\n  else if (co === 'nwfb') api = NwfbApi\n  else if (co === 'ctb') api = CtbApi\n  else {\n    console.error(co+' is not a valid company id')\n    return null\n  }\n  return await api.fetchRouteStops({route, serviceType, bound})\n}\n\nexport { KmbApi, NwfbApi, CtbApi, fetchEtas, fetchRouteStops }","import React, { useEffect, useState } from 'react'\nimport moment from 'moment'\nimport { KmbApi, NwfbApi, CtbApi } from './data-api'\n\nconst AppContext = React.createContext()\n\nexport const AppContextProvider = ( props ) => {\n  // route list & stop list & route-stop list\n  const [routeList, setRouteList] = useState(null)\n  const [stopList, setStopList] = useState(null)\n  // search route\n  const [searchRoute, setSearchRoute] = useState(\"\")\n\n  // possible Char for RouteInputPad\n  const [possibleChar, setPossibleChar] = useState([])\n  \n  useEffect(() => {\n    fetchRouteList().then(() => {\n      let _routeList = JSON.parse(localStorage.getItem('routeList'))\n      setRouteList(_routeList)\n      setPossibleChar(getPossibleChar('', _routeList))\n    })\n    fetchStopList().then(() => {\n      let _stopList = JSON.parse(localStorage.getItem('stopList'))\n      setStopList(_stopList)\n    }) \n  }, [])\n\n  useEffect(() => {\n    setPossibleChar(getPossibleChar(searchRoute, routeList))\n  }, [searchRoute, routeList])\n\n  const updateSearchRouteByButton = (buttonValue) => {\n    switch (buttonValue) {\n      case 'b': \n        setSearchRoute(searchRoute.slice(0,-1))\n        break\n      case '-':\n        setSearchRoute('')\n        break\n      default: \n        setSearchRoute(searchRoute+buttonValue)\n    }\n  }\n\n  return (\n    <AppContext.Provider value={{\n        routeList, setRouteList, stopList, setStopList,\n        searchRoute, setSearchRoute, updateSearchRouteByButton,\n        possibleChar\n      }}>\n      {props.children}\n    </AppContext.Provider>\n  )\n}\n\nexport default AppContext\n\nconst fetchRouteList = async () => {\n  if ( localStorage.getItem('routeList') == null || \n    localStorage.getItem('routeListDbTime') < moment().subtract(1, 'days').format(\"YYYY-MM-DDTHH:mm:ssZZ\")\n  ) {\n    let routeList = {}\n    let generated_timestamp = '3000'\n    for ( const api of [KmbApi, NwfbApi, CtbApi] ) {\n        let [_routeList, _generated_timestamp] = await api.fetchRouteList()\n        // merging routes from different service provider\n        for ( const route of Object.entries(_routeList) ) {\n          if ( route[0] in routeList ) {\n            if ( route[1].orig.en.toUpperCase() === routeList[route[0]].orig.en.toUpperCase() ) {\n              // same route\n              routeList[route[0]].co.push(api.co)\n              routeList[route[0]].stops[api.co] = route[1].stops[api.co]\n            } else {\n              // new route with same route number\n              routeList[route[0]+'+'+api.co] = route[1]\n            }\n          } else {\n            // new route\n            routeList[route[0]] = route[1]\n          }\n        }\n        generated_timestamp = _generated_timestamp < generated_timestamp ? _generated_timestamp : generated_timestamp\n    }\n    // sort the routeList\n    let _routeList = routeList\n    routeList = {}\n    Object.entries(_routeList).sort((a,b) => (a[0] < b[0] ? -1 : 1)).forEach(route => {\n      routeList[route[0]] = route[1]\n    })\n    \n    // save to local storage\n    localStorage.setItem('routeList', JSON.stringify(routeList))\n    localStorage.setItem('routeListDbTime', generated_timestamp)\n  } \n}\n\nconst fetchStopList = async () => {\n  if ( localStorage.getItem('stopList') == null ||\n    localStorage.getItem('stopDbTime') < moment().subtract(1, 'days').format(\"YYYY-MM-DDTHH:mm:ssZZ\")\n  ) {\n    // KMB\n    let [stopList, generated_timestamp] = await KmbApi.fetchStopList()\n    localStorage.setItem('stopList', JSON.stringify(stopList))\n    localStorage.setItem('stopDbTime', generated_timestamp)\n  }\n}\n\nconst getPossibleChar = ( searchRoute, routeList ) => {\n  if ( routeList == null ) return []\n  let possibleChar = {}\n  Object.entries(routeList).forEach(route => {\n    if ( route[0].startsWith(searchRoute.toUpperCase()) ) {\n      possibleChar[route[0].slice(searchRoute.length, searchRoute.length+1)] = true\n    }\n  })\n  return Object.entries(possibleChar).map(k => k[0]).filter(k => k !== '+')\n}","import React, { useContext } from \"react\"\nimport {\n  Input,\n  Tabs,\n  Tab,\n  Toolbar,\n  Typography\n} from \"@material-ui/core\"\nimport { withStyles, makeStyles } from '@material-ui/core/styles'\nimport { useLocation, useHistory } from 'react-router-dom'\nimport { useTranslation } from 'react-i18next'\nimport { useRouteMatch } from 'react-router-dom'\nimport AppContext from '../AppContext'\n\nconst Header = (props) => {\n  const { searchRoute, setSearchRoute } = useContext( AppContext )\n  \n  const { path } = useRouteMatch()\n  const { t, i18n } = useTranslation()\n  const classes = useStyles()\n  let location = useLocation()\n  const history = useHistory()\n\n  const handleLanguageChange = lang => {\n    history.replace( location.pathname.replace('/'+i18n.language+'/', '/'+lang+'/') )\n    i18n.changeLanguage(lang)\n  }\n\n  return (\n    <Toolbar\n      className={classes.toolbar}\n    >\n      <div>\n        <Typography variant=\"h6\">香港</Typography>\n        <Typography variant='subtitle2'>獨立巴士預報</Typography>\n      </div>\n      <Input \n        type=\"text\"\n        value={searchRoute}\n        placeholder={t('搜尋巴士線')}\n        onChange={e => setSearchRoute(e.target.value)}\n        disabled={path.includes('route')}\n      />\n      <div\n        className={classes.tabsContainer}\n      >\n        <LanguageTabs\n            value={i18n.language}\n            onChange={(e, v) => handleLanguageChange(v)}\n          >\n          <LanguageTab value=\"en\" label=\"En\" />\n          <LanguageTab value=\"zh\" label=\"繁\" />\n        </LanguageTabs>\n      </div>\n    </Toolbar>\n  );\n}\n\nconst useStyles = makeStyles(theme => ({\n  tabsContainer: {\n    display: 'flex',\n    [theme.breakpoints.down('sm')]:{\n      flexDirection: \"row-reverse\"\n    }\n  },\n  toolbar: {\n    display: 'flex',\n    justifyContent: 'space-between',\n    zIndex: theme.zIndex.drawer * 2\n  }\n}))\n\nconst LanguageTabs = withStyles({\n  root: {\n    borderBottom: 'none',\n    minHeight: 24\n  },\n  indicator: {\n    backgroundColor: 'transparent'\n  }\n})(Tabs);\n\nconst LanguageTab = withStyles((theme) => ({\n  root: {\n    textTransform: 'none',\n    minWidth: 36,\n    fontWeight: 900,\n    marginRight: theme.spacing(0),\n    fontSize: '15px',\n    opacity: 1,\n    padding: '6px 6px'\n  },\n  selected:{\n    '& > .MuiTab-wrapper':{\n      color: '#3B3C45',\n      backgroundColor: '#FEFBFA'\n    }\n  },\n  wrapper: {\n    color: '#3B3C45',\n    borderRadius: '30px',\n    padding: '2px 10px 0px 10px'\n  },\n}))((props) => <Tab disableRipple {...props} />);\n\nexport default Header;","import React, { useContext } from 'react'\nimport { \n  Box,\n  Button,\n  Grid\n} from '@material-ui/core'\nimport {\n  makeStyles\n} from '@material-ui/styles'\nimport BackspaceOutlinedIcon from '@material-ui/icons/BackspaceOutlined';\n\nimport AppContext from '../AppContext'\nimport { useTranslation } from 'react-i18next';\n\nconst KeyButton = ({k, handleClick, disabled = false}) => {\n  const classes = useStyles()\n  const { t } = useTranslation()\n  return (\n    <Button \n      variant=\"contained\" \n      className={classes.button}\n      onClick={() => handleClick(k)}\n      disabled={disabled}\n    >\n      {k === 'b' ? <BackspaceOutlinedIcon/> : \n        k === '-' ? t('取消') : k}\n    </Button>\n  )\n}\n\nconst RouteNumPad = () => {\n  const { searchRoute, updateSearchRouteByButton, possibleChar } = useContext( AppContext )\n\n  return (\n    <Grid container spacing={1}>\n    {\n      '789456123-0b'.split('').map( k => (\n        <Grid item xs={4} key={'input-'+k}>\n          <KeyButton\n            k={k}\n            handleClick={updateSearchRouteByButton}\n            disabled={\n              (k === 'b' && searchRoute === '') \n              || ( !'b-'.includes(k) && !possibleChar.includes(k))\n              || ( k === '-' && searchRoute === '' )\n            }\n          />\n        </Grid>\n      ))\n    }\n    </Grid>\n  )\n}\n\nconst RouteAlphabetPad = () => {\n  const { updateSearchRouteByButton, possibleChar } = useContext( AppContext )\n  \n  return (\n    <Grid container spacing={1}>\n      {\n        possibleChar.filter(k => isNaN(k)).map(k => (\n          <Grid item xs={12} key={'input-'+k}>\n            <KeyButton\n              k={k}\n              handleClick={updateSearchRouteByButton}\n            />\n          </Grid>\n        )) \n      }\n    </Grid>\n  )\n}\n\nconst RouteInputPad = () => {\n\n  const classes = useStyles()\n  const padding = 0\n\n  return (\n    <Box className={classes.boxContainer} padding={padding}>\n      <Box className={classes.numPadContainer} padding={padding}>\n        <RouteNumPad />\n      </Box>\n      <Box className={classes.alphabetPadContainer} padding={padding}>\n        <RouteAlphabetPad />\n      </Box>\n    </Box>\n  )\n}\n\nexport default RouteInputPad\n\nconst useStyles = makeStyles(theme => ({\n  boxContainer: {\n    display: 'flex',\n    flexDirection: 'row',\n    height: '180px',\n    justifyContent: 'space-around'\n  },\n  numPadContainer: {\n    width: '60%',\n  },\n  alphabetPadContainer: {\n    width: '20%',\n    height: '100%',\n    overflowX: 'hidden',\n    overflowY: 'scroll'\n  },\n  button: {\n    width: '100%'\n  }\n}))","import React, { useContext } from 'react'\nimport {\n  Card,\n  CardActionArea,\n  CardContent,\n  Typography\n} from '@material-ui/core'\nimport AppContext from '../AppContext'\nimport { useTranslation } from 'react-i18next'\nimport { FixedSizeList as List, areEqual } from 'react-window'\nimport memorize from 'memoize-one'\nimport RouteInputPad from './RouteInputPad'\nimport { Link } from  'react-router-dom'\n\nconst RouteRow = React.memo(( {data, index, style} ) => {\n  const { t, i18n } = useTranslation()\n  const { routeList } = data\n  const route = routeList[index]\n  const [routeNo, service_type] = route[0].split('+').slice(0,2)\n\n  return (\n    <Link to={'/'+i18n.language+'/route/'+route[0]}>\n      <Card variant=\"outlined\" key={route[0]} style={style} square>\n        <CardActionArea>\n          <CardContent>\n            <Typography variant=\"h5\" display=\"inline\">{routeNo}</Typography>\n            <Typography variant=\"caption\"> - {route[1].co.map(co => t(co)).join('+')}</Typography>\n            <Typography variant=\"subtitle2\">{route[1].orig[i18n.language]} ➔ {route[1].dest[i18n.language]}</Typography>\n            <Typography variant=\"caption\">{service_type === '2' ? t('特別班次') : '　'}</Typography>\n          </CardContent>\n        </CardActionArea>\n      </Card>\n    </Link>\n  )\n}, areEqual)\n\nconst createItemData = memorize((routeList) => ({routeList}))\n\nconst RouteList = () => {\n  const { routeList, searchRoute } = useContext(AppContext)\n  const targetRouteList = Object.entries(routeList).filter(\n    element => element[0].startsWith(searchRoute.toUpperCase())\n  ) \n\n  const itemData = createItemData(targetRouteList)\n  return (\n    <List\n      height={300}\n      itemCount={targetRouteList.length}\n      itemSize={104}\n      width=\"100%\"\n      itemData={itemData}\n    >\n        {RouteRow}\n    </List>\n  )\n}\n\nconst RouteBoard = () => {\n  return (\n    <>\n      <RouteList />\n      <hr/>\n      <RouteInputPad />\n    </>\n  )\n}\n\nexport default RouteBoard","import React, { useState, useEffect, useContext } from 'react'\nimport { useParams } from 'react-router-dom'\nimport MuiAccordion from'@material-ui/core/Accordion'\nimport MuiAccordionSummary from'@material-ui/core/AccordionSummary'\nimport MuiAccordionDetails from'@material-ui/core/AccordionDetails'\nimport {\n  Box, CircularProgress, Typography\n} from '@material-ui/core'\nimport { makeStyles, withStyles } from '@material-ui/core/styles'\nimport AppContext from '../AppContext'\nimport { useTranslation } from 'react-i18next'\nimport { \n  fetchRouteStops as fetchRouteStopsViaApi,\n  fetchEtas as fetchEtasViaApi \n} from '../data-api'\nimport { LocalConvenienceStoreOutlined } from '@material-ui/icons'\n\nconst RouteEta = () => {\n  const { id } = useParams()\n  const [ expanded, setExpanded ] = useState(false)\n  const { routeList, stopList, setRouteList, setStopList } = useContext ( AppContext )\n  const [ route, serviceType, bound ] = id.split('+').slice(0,3)\n  const { i18n } = useTranslation()\n\n  const routeObj = routeList[id]\n\n  const handleChange = ( panel ) => (event, newExpanded) => {\n    setExpanded(newExpanded ? panel : false)\n  }\n\n  useEffect(() => {\n    // check if stops not fetched\n    if ( routeObj.co.filter(co => routeObj.stops[co] == null).length ) {\n      // fetch in parallel\n      Promise.all(\n        routeObj.co.map(co => {\n          if ( routeObj.stops[co] !== null ) return null;\n          return fetchRouteStopsViaApi({\n            route, serviceType, bound, co\n          })\n        }).filter(v => v)\n      ).then(objs => {\n        // set stop list\n        let _stopList = {}\n        objs.forEach( obj => {\n          _stopList = {..._stopList, ...obj.stopList}\n        } )\n        setStopList({...stopList, ..._stopList})\n\n        // set route list\n        setRouteList(prevRouteList => {\n          let _routeList = JSON.parse(JSON.stringify(prevRouteList))\n          objs.forEach(obj => _routeList[id].stops[obj.co] = obj.routeStops)\n          return _routeList\n        })\n      })\n    }\n  },[])\n\n  const classes = useStyles()\n\n  if ( routeObj.stops[routeObj.co[0]] == null ) {\n    return (\n      <Box className={classes.loadingContainer}>\n        <CircularProgress size={30} />\n      </Box>\n    )\n  }\n\n  return (\n    <Box className={classes.boxContainer}>\n      {\n        routeObj.stops[routeObj.co[0]].map((stop, idx) => (\n          <Accordion \n            key={'stop-'+idx} \n            expanded={expanded === idx}\n            onChange={handleChange(idx)}\n            TransitionProps={{unmountOnExit: true}}\n          >\n            <AccordionSummary>{stopList[stop].name[i18n.language]}</AccordionSummary>\n            <AccordionDetails>\n              <TimeReport \n                route={route}\n                seq={idx + 1}\n                routeStops={routeObj.stops}\n                serviceType={serviceType}\n                bound={bound}\n                co={routeList[id].co}\n                routeSize={routeObj.stops[routeObj.co[0]].length}\n              />\n            </AccordionDetails>\n          </Accordion>\n        ))\n      }\n    </Box>\n  )\n}\n\nexport default RouteEta\n\nconst TimeReport = ( { route, routeStops, seq, bound, serviceType, co, routeSize } ) => {\n  const { t, i18n } = useTranslation()\n  const [ etas, setEtas ] = useState(null)\n\n  const fetchEtas = () => {\n    const fetchData = async () => {\n      setEtas( await fetchEtasViaApi({route, routeStops, seq, bound, serviceType, co, routeSize}) )\n    }\n    fetchData()\n  }\n\n  useEffect( () => {\n    fetchEtas()\n    const fetchEtaInterval = setInterval(() => {\n      fetchEtas()\n    }, 30000)\n\n    return () => clearInterval(fetchEtaInterval)\n  }, [])\n\n  if ( etas == null ) {\n    return (\n      <CircularProgress size={20} style={{}} />\n    )\n  }\n\n  const displayMsg = (eta) => {\n    let ret = ''\n    switch (eta) {\n      case null: \n        break\n      case 0: \n        ret = '- '+t('分鐘')\n        break\n      default:\n        ret = eta + t('分鐘')\n        break\n    }\n    return ret\n  }\n  \n  return (\n    <div>\n      {\n        etas.length === 0 ? t('暫無班次') : (\n          etas.map((eta, idx) => (\n            <Typography variant=\"subtitle1\" key={`route-${idx}`}>\n              {displayMsg(eta.eta)} {eta.remark[i18n.language] ? ' - ' + eta.remark[i18n.language] : '' }\n            </Typography>\n          ))\n        )\n      }\n    </div>\n  )\n}\n\nconst Accordion = withStyles({\n  root: {\n    border: '1px solid rgba(0, 0, 0, .125)',\n    boxShadow: 'none',\n    '&:not(:last-child)': {\n      borderBottom: 0,\n    },\n    '&:before': {\n      display: 'none',\n    },\n    '&$expanded': {\n      margin: 'auto',\n    },\n  },\n  expanded: {},\n})(MuiAccordion)\n\nconst AccordionSummary = withStyles({\n  root: {\n    backgroundColor: 'rgba(0, 0, 0, .03)',\n    borderBottom: '1px solid rgba(0, 0, 0, .125)',\n    marginBottom: -1,\n    minHeight: 56,\n    '&$expanded': {\n      minHeight: 56,\n    },\n  },\n  content: {\n    '&$expanded': {\n      margin: '12px 0',\n    },\n  },\n  expanded: {},\n})(MuiAccordionSummary);\n\nconst AccordionDetails = withStyles((theme) => ({\n  root: {\n    padding: theme.spacing(2),\n  },\n}))(MuiAccordionDetails);\n\nconst useStyles = makeStyles(theme => ({\n  boxContainer: {\n    height: '500px',\n    overflowY: 'scroll'\n  },\n  loadingContainer: {\n    display: 'flex',\n    justifyContent: 'center'\n  }\n}))","import './App.css'\nimport { MuiThemeProvider, createMuiTheme } from '@material-ui/core/styles'\nimport React, { useContext } from 'react'\nimport {\n  BrowserRouter as Router,\n  Redirect,\n  Switch,\n  Route,\n  useRouteMatch\n} from \"react-router-dom\";\nimport {\n  Container,\n  CssBaseline\n} from '@material-ui/core'\nimport Header from './components/Header'\nimport RouteBoard from './components/RouteBoard'\nimport RouteEta from './components/RouteEta'\nimport AppContext from './AppContext'\n\nconst PageSwitch = () => {\n  const { path } = useRouteMatch()\n  return (\n    <Switch>\n      <Route path={`${path}/route/:id?`}>\n        <RouteEta />\n      </Route>\n      <Route >\n        <RouteBoard />\n      </Route>\n    </Switch>\n  )\n}\n\nconst App = () => {\n  /*\n  navigator.geolocation.getCurrentPosition(position => {\n    console.log(position.coords.latitude, position.coords.longitude)\n  })\n  */\n  const { routeList, stopList } = useContext( AppContext )\n  if ( routeList == null || stopList == null ) {\n    return (\n      <>Loading</>\n    )\n  } \n  return (\n    <MuiThemeProvider theme={Theme}>\n      <Container maxWidth='xs' disableGutters>\n        <Router basename={process.env.PUBLIC_URL}>\n          <Route exact path=\"/\">\n            <Redirect to=\"/zh/\" />\n          </Route>\n          <Route path=\"/:lang\">\n            <CssBaseline />\n            <Header />\n            <PageSwitch />\n          </Route>\n        </Router>\n      </Container>\n    </MuiThemeProvider>\n  );\n}\n\nexport default App;\n\nconst Theme = createMuiTheme({\n  typography: {\n    fontFamily: \"Noto Sans TC, Chivo, sans-serif\"\n  },\n  palette: {\n    background: {\n      default: \"yellow\"\n    }\n  }\n})\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import i18n from \"i18next\";\nimport { initReactI18next } from \"react-i18next\";\nimport resources from \"./i18n/translation.json\";\n\nconst DEFAULT_LANG = window.location.pathname.substr(1,2) === 'zh' ? 'zh' : 'en'\n\ni18n\n  .use(initReactI18next)\n  .init({\n    resources,\n    whitelist: ['en', 'zh'],\n    lowerCaseLng: true,\n    lng: DEFAULT_LANG,\n    nsSeparator: false,\n    keySeparator: false,\n    debug: false,\n\n    interpolation:{\n      escapeValue: false\n    }\n  });\n\nexport default i18n;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\nimport { AppContextProvider } from './AppContext'\nimport './i18n'\n\nReactDOM.render(\n  //<React.StrictMode>\n    <AppContextProvider>\n      <App />\n    </AppContextProvider>\n  //</React.StrictMode>,\n  ,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}